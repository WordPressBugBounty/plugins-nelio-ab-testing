(()=>{var e,t={7596(e,t,n){"use strict";window.wp.coreData;const i=window.wp.domReady,a=n.n(i)(),r=window.nab.data,s=window.ReactJSXRuntime,o=window.wp.element,l=window.nab.experimentLibrary,c=window.wp.data;function d(e,t){return(0,c.useSelect)(e,t)}const v=window.nab.editor,b=window.wp.compose,u=window.wp.i18n,p=window.wp.url;function g(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(n=g(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}const m=function(){for(var e,t,n=0,i="",a=arguments.length;n<a;n++)(e=arguments[n])&&(t=g(e))&&(i&&(i+=" "),i+=t);return i},x=window.lodash,j=window.nab.utils,_={activeResolution:"desktop",areControlsVisible:!0,isPreviewInScope:!1,isSaving:!1};function h(){const[e,t]=(0,r.usePageAttribute)("javascript-editor/javascriptEditorState",_);return(0,o.useEffect)(()=>{_===e&&t(_)},[e,t]),[e,n=>t(Object.assign(Object.assign({},e),n))]}function f(){return w}function w(e){const t=(0,c.select)(r.store).getPageAttribute("javascript-editor/javascriptEditorState")||_;t&&(0,c.dispatch)(r.store).setPageAttribute("javascript-editor/javascriptEditorState",Object.assign(Object.assign({},t),{isSaving:e}))}const y=window.wp.components,C=(Object.assign(e=>(0,s.jsx)(y.BaseControl,Object.assign({__nextHasNoMarginBottom:!0},e)),y.BaseControl),Object.assign(e=>(0,s.jsx)(y.CheckboxControl,Object.assign({__nextHasNoMarginBottom:!0},e)),y.CheckboxControl),Object.assign(e=>(0,s.jsx)(y.FormTokenField,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),y.FormTokenField),Object.assign(e=>(0,s.jsx)(y.RangeControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),y.RangeControl),Object.assign(e=>(0,s.jsx)(y.TextControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),y.TextControl),Object.assign(e=>(0,s.jsx)(y.TextareaControl,Object.assign({__nextHasNoMarginBottom:!0},e)),y.TextareaControl),Object.assign(e=>(0,s.jsx)(y.ToggleControl,Object.assign({__nextHasNoMarginBottom:!0},e)),y.ToggleControl),Object.assign(e=>(0,s.jsx)(y.__experimentalToggleGroupControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),y.__experimentalToggleGroupControl),window.nab.components),O=({isSaving:e,save:t})=>{const[n]=h(),i=k();return(0,s.jsxs)("div",{className:"nab-javascript-editor-sidebar__actions",children:[(0,s.jsx)("div",{className:"nab-javascript-editor-sidebar__back-to-experiment",children:(0,s.jsx)("a",{className:"nab-javascript-editor-sidebar__back-to-experiment-link",href:i,title:(0,u._x)("Back to test…","command","nelio-ab-testing"),children:(0,s.jsx)(y.Dashicon,{icon:"arrow-left-alt2"})})}),(0,s.jsxs)("div",{className:"nab-javascript-editor-sidebar__save-info",children:[!n.isPreviewInScope&&!e&&(0,s.jsx)(C.Tooltip,{text:(0,u._x)("Preview unavailable: this page is outside the test scope","text","nelio-ab-testing"),children:(0,s.jsx)(y.Button,{className:"nab-css-editor-sidebar__header-actions__css-toggle",icon:"warning",onClick:()=>{},disabled:!0})}),e&&(0,s.jsxs)("span",{className:"nab-javascript-editor-sidebar__saving-label",children:[(0,s.jsx)(y.Dashicon,{icon:"cloud"}),(0,u._x)("Saving…","text","nelio-ab-testing")]}),(0,s.jsx)(y.Button,{variant:"primary",disabled:e,onClick:t,children:(0,u._x)("Save and Preview","command","nelio-ab-testing")})]})]})},k=()=>d(e=>{var t;return null===(t=e(v.store).getExperimentAttribute("links"))||void 0===t?void 0:t.edit},[]),S=({value:e,onChange:t})=>(0,s.jsx)(C.CodeEditor,{className:"nab-javascript-editor-sidebar__editor",language:"javascript",placeholder:D,value:e,onChange:t,config:{completions:[R],globals:["utils","done"],rules:{"detect-done":{level:"error",module:N}}}}),N={meta:{type:"problem",docs:{description:(0,u._x)("Ensure done() is called","user","nelio-ab-testing")},messages:{missingDone:(0,u._x)("The function done() must be called at least once.","text","nelio-ab-testing")},schema:[]},defaultOptions:[],create(e){let t=!1;return{CallExpression(e){"Identifier"===e.callee.type&&"done"===e.callee.name&&(t=!0)},"Program:exit"(){e.sourceCode.getText().trim()&&!t&&e.report({loc:{line:1,column:0},messageId:"missingDone"})}}}};function R(e){const t=e.matchBefore(/utils\.\w*/);if(t)return{from:t.text.replace(/\w*$/,"").length+t.from,options:[{label:"domReady",type:"function",apply:(0,u.sprintf)("domReady(() => {\n  // %s\n});",(0,u._x)("Write your code here…","user","nelio-ab-testing")),detail:"(callback:Function) => void",info:(0,u._x)("Runs callback when DOM is ready. You may need to use the function if you want to target certain elements on the page, since this code may run before any elements are loaded in the DOM.","text","nelio-ab-testing")},{label:"elementReady",type:"function",apply:(0,u.sprintf)("elementReady(\n  %1$s,\n  ( el, setCss ) => {\n    // %2$s\n  }\n);",JSON.stringify((0,u._x)(".some-selector","text","nelio-ab-testing")),(0,u._x)("Write your code here…","user","nelio-ab-testing")),detail:"(selector:string, callback:Function) => void",info:(0,u._x)("Runs callback as soon as the element is found in the DOM or DOM is ready and the element is in it.","text","nelio-ab-testing")},{label:"appendStyle",type:"function",apply:(0,u.sprintf)("appendStyle( `\n  %s {\n    color: inherit;\n  }\n` );",(0,u._x)(".some-selector","text","nelio-ab-testing")),detail:"(css:string) => void",info:(0,u._x)("Inserts a “style” tag into the document’s “head” section containing the provided CSS rules.","text","nelio-ab-testing")},{label:"showContent",type:"function",apply:"showContent();",detail:"() => void",info:(0,u._x)("Shows the variant right away, but doesn’t start tracking yet. To enable tracking, you should call “done” instead.","text","nelio-ab-testing")}]};const n=e.matchBefore(/\w*/);return n&&(n.from!==n.to||e.explicit)?{from:n.from,options:[{label:"done",type:"function",apply:"done();",detail:"() => void",info:(0,u._x)("Shows the variant and enables event tracking.","text","nelio-ab-testing")},{label:"utils",type:"variable",apply:"utils",detail:"Object",info:(0,u._x)("Contains several helper functions.","text","nelio-ab-testing")}]}:null}const D=[(0,u._x)("Write your JavaScript snippet here. Here are some useful tips:","user","nelio-ab-testing"),"\n","\n- ",(0,u.sprintf)(/* translators: %s: Variable name. */ /* translators: %s: Variable name. */
(0,u._x)("Declare global variable “%s”","text","nelio-ab-testing"),"abc"),"\n  window.abc = abc;","\n","\n- ",(0,u._x)("Run callback when dom is ready","text","nelio-ab-testing"),"\n  utils.domReady( callback );","\n","\n- ",(0,u._x)("Run callback when selected element is in dom","text","nelio-ab-testing"),"\n  utils.elementReady( selector, callback );","\n","\n- ",(0,u._x)("Show variant:","text","nelio-ab-testing"),"\n  utils.showContent();","\n","\n- ",(0,u._x)("Show variant and track events","text","nelio-ab-testing"),"\n  done();"].join(""),I=()=>{const[e,t]=h();return(0,s.jsxs)("div",{className:"nab-javascript-editor-sidebar__footer-actions",children:[(0,s.jsx)("div",{className:m({"nab-javascript-editor-sidebar__visibility-toggle":!0,"nab-javascript-editor-sidebar__visibility-toggle--hide":!!e.areControlsVisible,"nab-javascript-editor-sidebar__visibility-toggle--show":!e.areControlsVisible}),children:(0,s.jsx)(y.Button,{variant:"link",onClick:()=>t({areControlsVisible:!e.areControlsVisible}),children:e.areControlsVisible?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.Dashicon,{icon:"admin-collapse"}),(0,s.jsx)("span",{className:"nab-javascript-editor-sidebar__visibility-toggle-label",children:(0,u._x)("Hide Controls","command","nelio-ab-testing")})]}):(0,s.jsx)(y.Dashicon,{icon:"admin-collapse"})})}),(0,s.jsxs)("div",{className:"nab-javascript-editor-sidebar__resolutions",children:[(0,s.jsx)("div",{className:m({"nab-javascript-editor-sidebar__resolution":!0,"nab-javascript-editor-sidebar__resolution--is-active":"desktop"===e.activeResolution}),children:(0,s.jsxs)(y.Button,{variant:"link",onClick:()=>t({activeResolution:"desktop"}),children:[(0,s.jsx)(y.Dashicon,{icon:"desktop"}),(0,s.jsx)("span",{className:"screen-reader-text",children:(0,u._x)("Enter desktop preview mode","command","nelio-ab-testing")})]})}),(0,s.jsx)("div",{className:m({"nab-javascript-editor-sidebar__resolution":!0,"nab-javascript-editor-sidebar__resolution--is-active":"tablet"===e.activeResolution}),children:(0,s.jsxs)(y.Button,{variant:"link",onClick:()=>t({activeResolution:"tablet"}),children:[(0,s.jsx)(y.Dashicon,{icon:"tablet"}),(0,s.jsx)("span",{className:"screen-reader-text",children:(0,u._x)("Enter tablet preview mode","command","nelio-ab-testing")})]})}),(0,s.jsx)("div",{className:m({"nab-javascript-editor-sidebar__resolution":!0,"nab-javascript-editor-sidebar__resolution--is-active":"mobile"===e.activeResolution}),children:(0,s.jsxs)(y.Button,{variant:"link",onClick:()=>t({activeResolution:"mobile"}),children:[(0,s.jsx)(y.Dashicon,{icon:"smartphone"}),(0,s.jsx)("span",{className:"screen-reader-text",children:(0,u._x)("Enter mobile preview mode","command","nelio-ab-testing")})]})})]})]})},E=({className:e,alternativeId:t,isSaving:n,save:i})=>{const[a,r]=P(t);return(0,s.jsxs)("div",{className:m(["nab-javascript-editor-sidebar",e]),children:[(0,s.jsx)(O,{isSaving:n,save:i}),(0,s.jsx)(S,{value:a,onChange:r}),(0,s.jsx)(I,{})]})},P=e=>{var t;const n=d(t=>t(v.store).getAlternative(e),[e]),i=(null===(t=null==n?void 0:n.attributes)||void 0===t?void 0:t.code)||"",{setAlternative:a}=(0,c.useDispatch)(v.store);return[i,e=>{n&&a(n.id,Object.assign(Object.assign({},n),{attributes:(0,j.omitUndefineds)(Object.assign(Object.assign({},n.attributes),{code:e}))}))}]},B=["nab-javascript-previewer"],T=({className:e,iframeId:t,isSaving:n,previewUrl:i})=>{const a=(0,o.useRef)(null),[r]=h();return(0,o.useEffect)(()=>{const e=a.current;if(!e)return;const t=()=>{try{if(!i)return;if(!e.contentWindow)return;const t=new URL(i),n=new URL(e.contentWindow.location.href);B.reduce((e,i)=>{var a;return n.searchParams.get(i)?e:t.searchParams.has(i)?(n.searchParams.set(i,null!==(a=t.searchParams.get(i))&&void 0!==a?a:""),!0):e},!1)&&e&&(e.contentWindow.location.href=n.toString())}catch(e){}};return e.addEventListener("load",t),()=>e.removeEventListener("load",t)}),(0,s.jsx)("div",{className:m([e,"nab-javascript-preview"]),children:(0,s.jsx)("iframe",{id:t,ref:a,className:m({"nab-javascript-preview__iframe":!0,[`nab-javascript-preview__iframe--${r.activeResolution}`]:!0,"nab-javascript-preview__iframe--is-saving":n}),title:(0,u._x)("JavaScript Preview","text","nelio-ab-testing"),src:i})})},M="javascript-editor-sidebar-width",A=document.createElement("style");function V(e){e=isNaN(e)?320:e,e=Math.min(e,window.innerWidth-320),e=Math.max(e,320),A.textContent=`:root{--nab-javascript-editor-sidebar-width: ${e}px;}`,(0,j.setValue)(M,e)}a(()=>{document.head.appendChild(A),V(Number.parseInt((0,j.getValue)(M,"")))});const H=({alternativeId:e})=>{const t=`nab-javascript-previewer__iframe-${(0,b.useInstanceId)(H)}`,[n]=h(),i=$(e),a=F(),[r,l]=z(t),c=(0,o.useRef)(null),[d,v]=(0,o.useState)(!1);return(0,s.jsxs)("div",{className:m({"nab-javascript-editor":!0,"nab-javascript-editor--is-dragging":d}),children:[(0,s.jsx)(E,{className:m({"nab-javascript-editor__sidebar":!0,"nab-javascript-editor__sidebar--is-collapsed":!n.areControlsVisible}),alternativeId:e,isSaving:r,save:l}),(0,s.jsx)(W,{dividerRef:c,onDragStart:()=>v(!0),onDrag:V,onDragEnd:()=>v(!1),onDoubleClick:()=>{v(!0),setTimeout(()=>{A.textContent="",setTimeout(()=>v(!1),200),(0,j.clearValue)(M)},0)}}),(0,s.jsx)(T,{className:m({"nab-javascript-editor__preview":!0,"nab-javascript-editor__preview--is-fullscreen":!n.areControlsVisible}),iframeId:t,isSaving:r,previewUrl:a,value:i},"nab-javascript-editor__preview")]})},W=({dividerRef:e,onDragStart:t,onDrag:n,onDragEnd:i,onDoubleClick:a})=>(0,s.jsx)("div",{ref:e,className:"nab-javascript-editor__resizer",role:"separator","aria-orientation":"vertical","aria-label":(0,u._x)("Resize Editor","command","nelio-ab-testing"),tabIndex:0,onPointerDown:e=>{e.currentTarget.setPointerCapture(e.pointerId),null==t||t()},onPointerMove:e=>{e.currentTarget.hasPointerCapture(e.pointerId)&&(null==n||n(e.clientX))},onPointerUp:e=>{e.currentTarget.hasPointerCapture(e.pointerId)&&e.currentTarget.releasePointerCapture(e.pointerId),null==i||i()},onDoubleClick:a}),$=e=>d(t=>{var n,i;return(null===(i=null===(n=t(v.store).getAlternative(e))||void 0===n?void 0:n.attributes)||void 0===i?void 0:i.code)||""},[e]),F=()=>d(e=>{const{getAlternative:t}=e(v.store),n=t("control");if(!n)return;const{getAlternatives:i,getExperimentId:a}=e(v.store),r=(0,p.getQueryArgs)(document.location.href).alternative||"",s=i(),o=a(),l=(0,x.indexOf)((0,x.map)(s,"id"),r),c=n.links&&n.links.preview||"/",d=(0,p.removeQueryArgs)(c,"nab-preview","experiment","alternative","timestamp","nabnonce");return(0,p.addQueryArgs)(d,{"nab-javascript-previewer":`${o}:${l}`})},[]),z=e=>{const t=d(e=>{var t;return!!(null===(t=e(r.store).getPageAttribute("javascript-editor/javascriptEditorState"))||void 0===t?void 0:t.isSaving)},[]),n=f(),{saveExperiment:i}=(0,c.useDispatch)(v.store);return[t,()=>{n(!0),i().then(()=>{var t;const i=document.getElementById(e);null===(t=null==i?void 0:i.contentWindow)||void 0===t||t.location.reload(),setTimeout(()=>n(!1),5e3)})}]},U=({experimentId:e,alternativeId:t})=>{const n=d(t=>t(r.store).getExperiment(e),[e]);return n?(0,s.jsx)(o.StrictMode,{children:(0,s.jsx)(v.EditorProvider,{experiment:n,children:(0,s.jsx)(H,{alternativeId:t})})}):null};var J;window.nab=Object.assign(Object.assign({},(J=window)&&"object"==typeof J&&"nab"in J?window.nab:{}),{initJavaScriptEditorPage:function(e,t){(0,l.registerCoreExperiments)();const n=document.getElementById(e);if(!n)return;const{experimentId:i,alternativeId:a}=t;var r,c;r=(0,s.jsx)(U,{experimentId:i,alternativeId:a}),(c=n)&&(o.createRoot?(0,o.createRoot)(c).render(r):(0,o.render)(r,c))}})}},n={};function i(e){var a=n[e];if(void 0!==a)return a.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,i),r.exports}e=[],i.O=(t,n,a,r)=>{if(!n){var s=1/0;for(d=0;d<e.length;d++){for(var[n,a,r]=e[d],o=!0,l=0;l<n.length;l++)(!1&r||s>=r)&&Object.keys(i.O).every(e=>i.O[e](n[l]))?n.splice(l--,1):(o=!1,r<s&&(s=r));if(o){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,a,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a=i.O(void 0,[1091],()=>i(7596));a=i.O(a);var r=nab="undefined"==typeof nab?{}:nab;for(var s in a)r[s]=a[s];a.__esModule&&Object.defineProperty(r,"__esModule",{value:!0})})();