(()=>{var e={4396(e,t){"use strict";function n(e){return e}t.L8=void 0,t.L8=function(e){return e?function(t){return e(t),t}:n}}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{"use strict";n.r(i),n.d(i,{data:()=>o});var e={};n.r(e),n.d(e,{areUniqueResultsAvailable:()=>Te,areUniqueResultsVisible:()=>xe,canLimitSiteQuota:()=>ae,getActivePlugins:()=>W,getAdminUrl:()=>ne,getAlternativePageViews:()=>ye,getAlternativeResultsInExperiment:()=>de,getConversionRatesOfAlternativesInGoal:()=>Se,getConversions:()=>fe,getCurrency:()=>A,getDaysRunning:()=>he,getDefaultGoal:()=>j,getECommercePlugin:()=>P,getECommerceSetting:()=>oe,getEntityRecord:()=>O,getExperiment:()=>x,getExperimentAttribute:()=>T,getExperimentResults:()=>ce,getExperimentResultsStatus:()=>be,getKindEntities:()=>w,getMediaUrl:()=>R,getMenu:()=>J,getPageAttribute:()=>U,getPageViews:()=>pe,getPluginSetting:()=>se,getProducts:()=>I,getQuota:()=>je,getRestUrl:()=>re,getResultsOfAlternatives:()=>Oe,getRevenuesOfAlternativesInGoal:()=>we,getSiteLanguage:()=>K,getSubscriptionId:()=>_,getTemplateContexts:()=>Z,getTemplates:()=>ee,getThemes:()=>te,getToday:()=>z,getTotalPageViews:()=>ve,getTotalRevenue:()=>me,getUniquePageViews:()=>ge,getWinnerAlternative:()=>Ee,getWinnersInExperiment:()=>le,hasCapability:()=>ie,hasMenus:()=>X,isLocked:()=>C,isSubscribedTo:()=>ue});var t={};n.r(t),n.d(t,{changeLastAppliedAlternative:()=>Ie,lock:()=>Ve,receiveECommerceSettings:()=>He,receiveEntityRecords:()=>Ae,receiveExperiment:()=>_e,receiveExperimentResult:()=>qe,receiveFSCurrency:()=>Re,receiveFSProducts:()=>Ue,receiveFSSubscriptionId:()=>Ce,receiveKindEntitiesQuery:()=>Pe,receiveMediaUrl:()=>ke,receiveMenus:()=>Ge,receivePluginSettings:()=>Ye,receivePlugins:()=>Le,receiveSiteQuota:()=>Ke,receiveTemplateContexts:()=>Be,receiveTemplates:()=>Fe,receiveThemes:()=>Qe,setPageAttribute:()=>$e,setSiteLanguage:()=>Ne,setToday:()=>Me,unlock:()=>De,updateAiSettings:()=>ze});var s={};n.r(s),n.d(s,{applyAlternative:()=>kt,createTestFromHypothesis:()=>ft,generateTestHypotheses:()=>yt,pauseExperiment:()=>Ct,purchaseQuota:()=>qt,searchTestCandidates:()=>gt,setPublicResultStatus:()=>$t,stopExperiment:()=>Ut});var r={};n.r(r),n.d(r,{getActivePlugins:()=>rn,getAlternativePageViews:()=>Zt,getConversionRatesOfAlternativesInGoal:()=>nn,getCurrency:()=>Yt,getDaysRunning:()=>en,getEntityRecord:()=>Lt,getExperiment:()=>Bt,getExperimentResults:()=>Xt,getExperimentResultsStatus:()=>tn,getKindEntities:()=>Nt,getMediaUrl:()=>Kt,getMenu:()=>an,getPageViews:()=>Jt,getProducts:()=>Qt,getQuota:()=>pn,getSubscriptionId:()=>Ht,getTemplateContexts:()=>un,getTemplates:()=>cn,getThemes:()=>ln,hasMenus:()=>on});var o={};n.r(o),n.d(o,{store:()=>gn,useAdminUrl:()=>bn,useExperimentAttribute:()=>fn,usePageAttribute:()=>mn,usePluginSetting:()=>hn});const a=window.wp.data;function u(e,t){return(0,a.useSelect)(e,t)}function c(e){return(0,a.resolveSelect)(e)}const l=window.nab.date,d=window.lodash,p={config:[],data:{}},v={},g={currency:"USD",products:[],subscriptionId:""},y={},f={isLocked:!1,sidebarDimensions:{top:0,height:"100vh",applyFix:!0}},m={},h={today:"2013-01-01",language:"en_US",menus:{},nelio:{adminUrl:"/wp-admin/",apiUrl:"",areAutoTutorialsEnabled:!0,areSubscriptionControlsDisabled:!1,capabilities:[],goalTracking:"all-pages",homeUrl:"/",isCookieTestingEnabled:!1,maxCombinations:24,minConfidence:95,minSampleSize:100,restUrl:"",segmentEvaluation:"site",siteId:"",subscription:!1,themeSupport:{menus:!1,widgets:!1}},plugins:[],templateContexts:{},templates:{},themes:{},ecommerce:{woocommerce:{currency:"USD",currencyPosition:"before",currencySymbol:"$",decimalSeparator:".",numberOfDecimals:2,orderStatuses:[],thousandsSeparator:","},edd:{currency:"USD",currencyPosition:"before",currencySymbol:"$",decimalSeparator:".",numberOfDecimals:2,orderStatuses:[],thousandsSeparator:","}}},b=window.nab.utils;function E(e){const t=(0,b.createAlternative)("control"),n=(0,b.createAlternative)();return(null==e?void 0:e.length)?"control"!==e[0].id?[t,...e]:1===e.length?[e[0],n]:e:[t,n]}const S=(0,a.combineReducers)({entities:function(e=p,t){var n;return null!==(n=function(e,t){switch(t.type){case"RECEIVE_TYPE_QUERY":return(0,d.isEqual)(e.config,t.kindEntities)?e:Object.assign(Object.assign({},e),{config:t.kindEntities});case"RECEIVE_ITEMS":{const n=t.items.filter(n=>{var i;return!(0,d.isEqual)(null===(i=e.data[t.kind])||void 0===i?void 0:i[n.id],n)});return n.length?Object.assign(Object.assign({},e),{data:Object.assign(Object.assign({},e.data),{[t.kind]:Object.assign(Object.assign({},e.data[t.kind]),(0,d.keyBy)(n,"id"))})}):e}}}(e,t))&&void 0!==n?n:e},experiments:function(e=v,t){var n;return null!==(n=function(e,t){var n,i;switch(t.type){case"RECEIVE_EXPERIMENT":{const i=Object.assign(Object.assign({},t.experiment),{alternatives:E(t.experiment.alternatives),goals:null!==(n=t.experiment.goals)&&void 0!==n?n:[(0,b.createGoal)()],segments:t.experiment.segments||b.EMPTY_ARRAY});return(0,d.isEqual)(e[t.key],i)?e:Object.assign(Object.assign({},e),{[t.key]:i})}case"CHANGE_LAST_APPLIED_ALTERNATIVE":const s=e[t.experimentId];if(!s)return e;const r=Object.assign(Object.assign({},s),{alternatives:s.alternatives.map((i=t.alternativeId,function(e){const t=Object.assign(Object.assign({},e),{isLastApplied:e.id===i});return(0,d.isEqual)(e,t)?e:t}))});return(0,d.isEqual)(e[t.experimentId],r)?e:Object.assign(Object.assign({},e),{[t.experimentId]:r})}}(e,t))&&void 0!==n?n:e},fastspring:function(e=g,t){var n;return null!==(n=function(e,t){switch(t.type){case"RECEIVE_FS_CURRENCY":return Object.assign(Object.assign({},e),{currency:t.currency});case"RECEIVE_FS_PRODUCTS":return Object.assign(Object.assign({},e),{products:t.products});case"RECEIVE_FS_SUBSCRIPTION_ID":return Object.assign(Object.assign({},e),{subscriptionId:t.subscriptionId})}}(e,t))&&void 0!==n?n:e},media:function(e=y,t){var n;return null!==(n=function(e,t){if("RECEIVE_MEDIA_URL"===t.type)return Object.assign(Object.assign({},e),{[t.id]:t.url})}(e,t))&&void 0!==n?n:e},page:function(e=f,t){var n;return null!==(n=function(e,t){switch(t.type){case"SET_PAGE_ATTRIBUTE":{const{name:n,value:i}=t;return n?(0,d.isEqual)(e[n],i)?e:Object.assign(Object.assign({},e),{[n]:i}):e}case"LOCK_UI":return Object.assign(Object.assign({},e),{isLocked:!0});case"UNLOCK_UI":return Object.assign(Object.assign({},e),{isLocked:!1})}}(e,t))&&void 0!==n?n:e},results:function(e=m,t){var n;return null!==(n=function(e,t){if("RECEIVE_RESULT"===t.type)return(0,d.isEqual)(e[t.key],t.result)?e:Object.assign(Object.assign({},e),{[t.key]:t.result})}(e,t))&&void 0!==n?n:e},settings:function(e=h,t){var n;return null!==(n=function(e,t){switch(t.type){case"SET_TODAY":return Object.assign(Object.assign({},e),{today:t.today});case"SET_SITE_LANGUAGE":return Object.assign(Object.assign({},e),{language:t.language});case"RECEIVE_MENUS":{const n=t.menus.filter(t=>!(0,d.isEqual)(e.menus[t.id],t));return n.length?Object.assign(Object.assign({},e),{menus:Object.assign(Object.assign({},e.menus),(0,d.keyBy)(n,"id"))}):e}case"RECEIVE_PLUGINS":return(0,d.isEqual)(e.plugins,t.plugins)?e:Object.assign(Object.assign({},e),{plugins:t.plugins||b.EMPTY_ARRAY});case"RECEIVE_TEMPLATE_CONTEXTS":return(0,d.isEqual)(e.templateContexts,t.templateContexts)?e:Object.assign(Object.assign({},e),{templateContexts:t.templateContexts});case"RECEIVE_TEMPLATES":return(0,d.isEqual)(e.templates,t.templates)?e:Object.assign(Object.assign({},e),{templates:t.templates});case"RECEIVE_THEMES":{const n=(0,d.keyBy)(t.themes,"id");return(0,d.isEqual)(e.themes,n)?e:Object.assign(Object.assign({},e),{themes:n})}case"RECEIVE_PLUGIN_SETTINGS":return(0,d.isEqual)(e.nelio,t.settings)?e:Object.assign(Object.assign({},e),{nelio:t.settings});case"RECEIVE_ECOMMERCE_SETTINGS":{const n=Object.assign(Object.assign({},e.ecommerce),{[t.ecommerce]:Object.assign(Object.assign({},t.settings),{orderStatuses:(0,d.sortBy)(t.settings.orderStatuses,"label")})});return(0,d.isEqual)(e.ecommerce,n)?e:Object.assign(Object.assign({},e),{ecommerce:n})}case"UPDATE_AI_SETTINGS":return e.nelio.aiSettings?Object.assign(Object.assign({},e),{nelio:Object.assign(Object.assign({},e.nelio),{aiSettings:t.settings})}):e}}(e,t))&&void 0!==n?n:e},siteQuota:function(e=undefined,t){var n;return null!==(n=function(e,t){if("RECEIVE_SITE_QUOTA"===t.type)return(0,d.isEqual)(e,t.quota)?e:t.quota}(e,t))&&void 0!==n?n:e}});function w(e){return e.entities.config}function O(e,t,n){var i;return null===(i=e.entities.data[t])||void 0===i?void 0:i[n]}function x(e,t){return t?e.experiments[t]:void 0}const T=function(e,t,n){const i=x(e,t);if(i)return i[n]};function j(e,t){const n=x(e,t);if(n)return n.goals[0]}function P(e,t,n){return function(e,t,n){var i,s;const r=x(e,t);if(!r)return!1;n=null!=n?n:null===(i=j(e,t))||void 0===i?void 0:i.id;const o=r.goals.find(e=>e.id===n);if(!o)return!1;const a=null!==(s=null==o?void 0:o.conversionActions)&&void 0!==s?s:[];return 0<a.length&&a.every(({type:e})=>"nab/wc-order"===e)}(e,t,n)?"woocommerce":function(e,t,n){var i,s;const r=x(e,t);if(!r)return!1;n=null!=n?n:null===(i=j(e,t))||void 0===i?void 0:i.id;const o=r.goals.find(e=>e.id===n);if(!o)return!1;const a=null!==(s=null==o?void 0:o.conversionActions)&&void 0!==s?s:[];return 0<a.length&&a.every(({type:e})=>"nab/edd-order"===e)}(e,t,n)?"edd":void 0}function A(e){return e.fastspring.currency}function I(e){return e.fastspring.products}function _(e){return e.fastspring.subscriptionId||void 0}function R(e,t){return e.media[t]}const U=function(e,t){return e.page[t]};function C(e){return U(e,"isLocked")}function k(e,t){const{segments:n}=t,i={results:{}};return(0,d.keyBy)(n.map((n,s)=>{var r,o,a,u,c,l,d,p,v,g,y;return Object.assign(Object.assign({winners:$((null===(o=null===(r=e.segments)||void 0===r?void 0:r[`s${s+1}`])||void 0===o?void 0:o.results)||{},t.goals),wasEnoughData:V((null===(u=null===(a=e.segments)||void 0===a?void 0:a[`s${s+1}`])||void 0===u?void 0:u.results)||{},t.goals),alternatives:D((null===(c=e.segments)||void 0===c?void 0:c[`s${s+1}`])||i,t)},(null===(d=null===(l=e.segments)||void 0===l?void 0:l[`s${s+1}`])||void 0===d?void 0:d.uniqueResults)&&{winnersUnique:$((null===(v=null===(p=e.segments)||void 0===p?void 0:p[`s${s+1}`])||void 0===v?void 0:v.uniqueResults)||{},t.goals),wasEnoughDataUnique:V((null===(y=null===(g=e.segments)||void 0===g?void 0:g[`s${s+1}`])||void 0===y?void 0:y.uniqueResults)||{},t.goals)}),{id:n.id})}),"id")}function $(e,t){const n={},i=t.length;for(let s=0;s<i;++s){const i=t[s];if(!i)continue;const r=i.id,o=e[`g${s}`]||!1;o&&"win"===o.status&&(n[r]={alternative:o.winner,confidence:o.confidence})}return n}function V(e,t){const n={},i=t.length;for(let s=0;s<i;++s){const i=t[s];if(!i)continue;const r=i.id,o=e[`g${s}`];n[r]="low-data"!==(null==o?void 0:o.status)}return n}function D(e,t){const{alternatives:n}=t,i="finished"===t.status?(0,l.getDate)(t.endDate||""):new Date,s=(0,l.date)("Y-m-d",i);return Object.assign({control:q({},"control","","",[])},(0,d.keyBy)(n.map((n,i)=>q(e[`a${i}`]||{},n.id,t.startDate||"",s,t.goals)),"id"))}function q(e,t,n,i,s){return{id:t,visits:e.v||0,values:M(e.cv,s),conversions:N(e.c,s),conversionRates:L(e.cr,s),improvementFactors:G(e.i,s),uniqueVisits:e.uv||0,uniqueValues:M(e.ucv,s),uniqueConversions:N(e.uc,s),uniqueConversionRates:L(e.ucr,s),uniqueImprovementFactors:G(e.ui,s),timeline:B(e.t,n,i,s)}}function M(e,t){const n={},i=t.length;for(let s=0;s<i;++s){const i=t[s];i&&(n[i.id]=(null==e?void 0:e[`g${s}`])||0)}return n}function N(e,t){const n={},i=t.length;for(let s=0;s<i;++s){const i=t[s];i&&(n[i.id]=(null==e?void 0:e[`g${s}`])||0)}return n}function L(e,t){const n={},i=t.length;for(let s=0;s<i;++s){const i=t[s];if(!i)continue;const r=i.id,o=(null==e?void 0:e[`g${s}`])||0;n[r]=Math.round(100*o)/100||0}return n}function G(e,t){const n={},i=t.length;for(let s=0;s<i;++s){const i=t[s];if(!i)continue;const r=i.id,o=(null==e?void 0:e[`g${s}`])||0;n[r]=Math.round(100*o)/100||0}return n}function B(e,t,n,i){const s=[],r=(0,l.getDate)(t);let o;do{o=(0,l.format)("Y-m-d",r);const t=Q(F(e,o),i);s.push(t),r.setDate(r.getDate()+1)}while(n>o);return s}function F(e,t){const n=(0,d.find)(e,{d:t})||{};return Object.assign(Object.assign({v:0},n),{d:t})}function Q(e,t){const n={visits:e.v||0,date:e.d,conversions:{},values:{},uniqueVisits:e.uv||0,uniqueConversions:{},uniqueValues:{}},i=t.length;for(let s=0;s<i;++s){const i=t[s];if(!i)continue;const r=i.id;n.conversions[r]=e[`g${s}`]||0,n.values[r]=e[`val${s}`]||0,n.uniqueConversions[r]=e[`ug${s}`]||0,n.uniqueValues[r]=e[`uval${s}`]||0}return n}const Y=window.wp.url;var H=n(4396);function z(e){return e.settings.today}function K(e){return e.settings.language}function W(e){return e.settings.plugins}function X(e){return!!(0,d.keys)(e.settings.menus).length}function J(e,t){return e.settings.menus[t]}function Z(e){return e.settings.templateContexts}function ee(e){return e.settings.templates}const te=(0,a.createSelector)(e=>(0,d.values)(e.settings.themes).filter(b.isDefined),e=>[e.settings.themes]);function ne(e,t,n){const i=se(e,"adminUrl");return(0,Y.addQueryArgs)(`${i}${t}`,n)}function ie(e,t){return e.settings.nelio.capabilities.includes(t)}const se=function(e,t){return e.settings.nelio[t]};function re(e,t="/"){const n=e.settings.nelio.restUrl;return(0,H.L8)()(n.includes("rest_route=")?n.replace("rest_route=",`rest_route=${t}`):`${n}${t}`)}const oe=function(e,t,n){return e.settings.ecommerce[t][n]};function ae(e){return ue(e,"professional","or-above")}function ue(e,t,n="or-above"){const i=se(e,"subscription");return"exactly"===n?(0,b.isPlan)(i,"exactly",t):(0,b.isPlan)(i,"exactly-or-above",t)}function ce(e,t){return t?e.results[t]:void 0}const le=(0,b.createIndexedSelector)((e,t)=>{var n,i;const s=ce(e,t);if(!s)return;const r=xe(e,t),o=null!==(n=U(e,"editor/activeSegment"))&&void 0!==n?n:"default",a=r?"winnersUnique":"winners";return"default"===o?s[a]:null===(i=s.segments[o])||void 0===i?void 0:i[a]},(e,t)=>{var n;return{key:t,dependants:[ce(e,t),null!==(n=U(e,"editor/activeSegment"))&&void 0!==n?n:"default",xe(e,t)]}}),de=(0,b.createIndexedSelector)((e,t)=>{var n,i;const s=ce(e,t);if(!s)return;const r=null!==(n=U(e,"editor/activeSegment"))&&void 0!==n?n:"default";return"default"===r?(0,d.values)(s.alternatives):(0,d.values)(null===(i=s.segments[r])||void 0===i?void 0:i.alternatives)},(e,t)=>{var n;return{key:t,dependants:[ce(e,t),null!==(n=U(e,"editor/activeSegment"))&&void 0!==n?n:"default"]}});function pe(e,t){return xe(e,t)?ge(e,t):ve(e,t)}function ve(e,t){var n,i;const s=ce(e,t);if(!(null==s?void 0:s.alternatives))return 0;const r=null!==(n=U(e,"editor/activeSegment"))&&void 0!==n?n:"default";return("default"===r?(0,d.values)(s.alternatives):(0,d.values)(null===(i=s.segments[r])||void 0===i?void 0:i.alternatives)).reduce((e,t)=>e+t.visits,0)}function ge(e,t){var n,i;const s=ce(e,t);if(!(null==s?void 0:s.alternatives))return 0;const r=null!==(n=U(e,"editor/activeSegment"))&&void 0!==n?n:"default";return("default"===r?(0,d.values)(s.alternatives):(0,d.values)(null===(i=s.segments[r])||void 0===i?void 0:i.alternatives)).reduce((e,t)=>e+t.uniqueVisits,0)}function ye(e,t,n){var i,s;const r=ce(e,t);if(!(null==r?void 0:r.alternatives))return 0;const o=null!==(i=U(e,"editor/activeSegment"))&&void 0!==i?i:"default",a="default"===o?r.alternatives[n]:null===(s=r.segments[o])||void 0===s?void 0:s.alternatives[n];return a?xe(e,t)?a.uniqueVisits:a.visits:0}function fe(e,t,n){var i,s,r,o;const a=ce(e,t);if(!a||!a.alternatives)return 0;const u=null!==(s=null!=n?n:null===(i=j(e,t))||void 0===i?void 0:i.id)&&void 0!==s?s:"";if(!u)return 0;const c=xe(e,t),l=null!==(r=U(e,"editor/activeSegment"))&&void 0!==r?r:"default";return("default"===l?(0,d.values)(a.alternatives):(0,d.values)(null===(o=a.segments[l])||void 0===o?void 0:o.alternatives)).reduce((e,t)=>e+((c?t.uniqueConversions[u]:t.conversions[u])||0),0)}function me(e,t,n){var i,s,r,o;const a=ce(e,t);if(!a||!a.alternatives)return 0;const u=null!==(s=null!=n?n:null===(i=j(e,t))||void 0===i?void 0:i.id)&&void 0!==s?s:"";if(!u)return 0;const c=xe(e,t),l=null!==(r=U(e,"editor/activeSegment"))&&void 0!==r?r:"default";return("default"===l?(0,d.values)(a.alternatives):(0,d.values)(null===(o=a.segments[l])||void 0===o?void 0:o.alternatives)).reduce((e,t)=>{var n;return e+(null!==(n=c?t.uniqueValues[u]:t.values[u])&&void 0!==n?n:0)},0)}function he(e,t){const n=x(e,t);if(!(null==n?void 0:n.startDate))return 0;const i=n.startDate;let s="";return"finished"===n.status&&(s=n.endDate||""),function(e,t){"string"==typeof e&&(e=new Date(e)),"string"==typeof t&&(t=new Date(t));const n=new Date;e&&!isNaN(e.getTime())||(e=n),t&&!isNaN(t.getTime())||(t=n);const i=Math.abs(t.getTime()-e.getTime());return Math.ceil(i/864e5)}(i,s)}function be(e,t,n){var i,s,r,o,a,u;const c=ce(e,t);if(!c)return;const l=null!==(s=null!=n?n:null===(i=j(e,t))||void 0===i?void 0:i.id)&&void 0!==s?s:"";if(!l)return;const d=se(e,"minConfidence");if(!d)return;const p=xe(e,t),v=null!==(r=U(e,"editor/activeSegment"))&&void 0!==r?r:"default",g=p?"winnersUnique":"winners",y="default"===v?null===(o=c[g])||void 0===o?void 0:o[l]:null===(u=null===(a=c.segments[v])||void 0===a?void 0:a[g])||void 0===u?void 0:u[l];return y?y.confidence>=d?"winner":"possible-winner":"testing"}function Ee(e,t,n){var i,s,r,o,a,u;const c=ce(e,t);if(!c)return;const l=null!==(s=null!=n?n:null===(i=j(e,t))||void 0===i?void 0:i.id)&&void 0!==s?s:"";if(!l)return;const d=se(e,"minConfidence");if(!d)return;const p=xe(e,t),v=null!==(r=U(e,"editor/activeSegment"))&&void 0!==r?r:"default",g=p?"winnersUnique":"winners",y="default"===v?null===(o=c[g])||void 0===o?void 0:o[l]:null===(u=null===(a=c.segments[v])||void 0===a?void 0:a[g])||void 0===u?void 0:u[l];return!y||y.confidence<d?void 0:y.alternative}const Se=(0,b.createIndexedSelector)((e,t,n)=>{var i,s,r;const o=ce(e,t);if(!o)return;const a=null!=n?n:null===(i=j(e,t))||void 0===i?void 0:i.id;if(!a)return;const u=xe(e,t),c=null!==(s=U(e,"editor/activeSegment"))&&void 0!==s?s:"default";return("default"===c?(0,d.values)(o.alternatives):(0,d.values)(null===(r=o.segments[c])||void 0===r?void 0:r.alternatives)).map(e=>u?e.uniqueConversionRates[a]||0:e.conversionRates[a]||0)},(e,t,n)=>{var i;return{key:`${t}-${n}`,dependants:[ce(e,t),null!==(i=U(e,"editor/activeSegment"))&&void 0!==i?i:"default",xe(e,t)]}}),we=(0,b.createIndexedSelector)((e,t,n)=>{var i,s,r,o;const a=ce(e,t);if(!a)return;const u=null!==(s=null!=n?n:null===(i=j(e,t))||void 0===i?void 0:i.id)&&void 0!==s?s:"";if(!u)return;const c=xe(e,t),l=null!==(r=U(e,"editor/activeSegment"))&&void 0!==r?r:"default";return("default"===l?(0,d.values)(a.alternatives):(0,d.values)(null===(o=a.segments[l])||void 0===o?void 0:o.alternatives)).map(e=>c?e.uniqueValues[u]||0:e.values[u]||0)},(e,t,n)=>{var i;return{key:`${t}-${n}`,dependants:[ce(e,t),null!==(i=U(e,"editor/activeSegment"))&&void 0!==i?i:"default",xe(e,t)]}}),Oe=(0,b.createIndexedSelector)((e,t)=>{var n,i;const s=ce(e,t);if(!s)return;const r=null!==(n=U(e,"editor/activeSegment"))&&void 0!==n?n:"default";return"default"===r?s.alternatives:null===(i=s.segments[r])||void 0===i?void 0:i.alternatives},(e,t)=>{var n;return{key:t,dependants:[ce(e,t),null!==(n=U(e,"editor/activeSegment"))&&void 0!==n?n:"default"]}});function xe(e,t){var n;return null!==(n=U(e,"results/shouldShowUniqueResults"))&&void 0!==n&&n&&Te(e,t)}function Te(e,t){const n=ce(e,t);return(0,d.values)(null==n?void 0:n.alternatives).some(e=>e.uniqueVisits>0)}function je(e){return e.siteQuota}function Pe(e){return{type:"RECEIVE_TYPE_QUERY",kindEntities:(0,d.castArray)(e)}}function Ae(e,t){return{type:"RECEIVE_ITEMS",items:(0,d.castArray)(t),kind:e}}function Ie(e,t){return{type:"CHANGE_LAST_APPLIED_ALTERNATIVE",experimentId:e,alternativeId:t}}function _e(e,t){return{type:"RECEIVE_EXPERIMENT",key:e,experiment:t}}function Re(e){return{type:"RECEIVE_FS_CURRENCY",currency:e}}function Ue(e){return{type:"RECEIVE_FS_PRODUCTS",products:(0,d.castArray)(e)}}function Ce(e){return{type:"RECEIVE_FS_SUBSCRIPTION_ID",subscriptionId:e}}function ke(e,t){return{type:"RECEIVE_MEDIA_URL",id:e,url:t}}function $e(e,t){return{type:"SET_PAGE_ATTRIBUTE",name:e,value:t}}function Ve(){return{type:"LOCK_UI"}}function De(){return{type:"UNLOCK_UI"}}function qe(e,t){return{type:"RECEIVE_RESULT",key:e,result:t}}function Me(e){return{type:"SET_TODAY",today:e}}function Ne(e){return{type:"SET_SITE_LANGUAGE",language:e}}function Le(e){return{type:"RECEIVE_PLUGINS",plugins:(0,d.castArray)(e)}}function Ge(e){return{type:"RECEIVE_MENUS",menus:(0,d.castArray)(e)}}function Be(e){return{type:"RECEIVE_TEMPLATE_CONTEXTS",templateContexts:e}}function Fe(e){return{type:"RECEIVE_TEMPLATES",templates:e}}function Qe(e){return{type:"RECEIVE_THEMES",themes:(0,d.castArray)(e)}}function Ye(e){return{type:"RECEIVE_PLUGIN_SETTINGS",settings:e}}function He(e,t){return{type:"RECEIVE_ECOMMERCE_SETTINGS",ecommerce:e,settings:t}}function ze(e){return{type:"UPDATE_AI_SETTINGS",settings:e}}function Ke(e){return{type:"RECEIVE_SITE_QUOTA",quota:e}}const We=window.wp.apiFetch;var Xe=n.n(We);const Je=window.wp.date,Ze=e=>{const{url:t,path:n}=e,i=(0,Je.format)("YmjHi").substring(0,11)+"0";return Xe()(Object.assign(Object.assign(Object.assign(Object.assign({},e),t&&{url:et(e)?(0,Y.addQueryArgs)(t,{nabts:i}):t}),n&&{path:(0,Y.addQueryArgs)(n,{nabts:i})}),{parse:!0}))},et=e=>{var t,n;return!!(null===(t=e.url)||void 0===t?void 0:t.includes("/wp-json/"))||!!(null===(n=e.url)||void 0===n?void 0:n.includes("rest_route"))||!!Object.keys(e).includes("rest_route")},tt=window.wp.htmlEntities,nt=window.wp.i18n,it={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let st;const rt=new Uint8Array(16),ot=[];for(let e=0;e<256;++e)ot.push((e+256).toString(16).slice(1));const at=function(e,t,n){if(it.randomUUID&&!t&&!e)return it.randomUUID();const i=(e=e||{}).random??e.rng?.()??function(){if(!st){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");st=crypto.getRandomValues.bind(crypto)}return st(rt)}();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=i[e];return t}return function(e,t=0){return(ot[e[t+0]]+ot[e[t+1]]+ot[e[t+2]]+ot[e[t+3]]+"-"+ot[e[t+4]]+ot[e[t+5]]+"-"+ot[e[t+6]]+ot[e[t+7]]+"-"+ot[e[t+8]]+ot[e[t+9]]+"-"+ot[e[t+10]]+ot[e[t+11]]+ot[e[t+12]]+ot[e[t+13]]+ot[e[t+14]]+ot[e[t+15]]).toLowerCase()}(i)},ut=({isWooCommerceEnabled:e})=>["page","post","attachment","nelio_popup","nelio_form","elementor_library","e-floating-buttons","nab_elementor_popup","sc_product","wp_block",...e?["product","product_variation"]:[]];var ct=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function o(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}u((i=i.apply(e,t||[])).next())})},lt=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n};const dt=100,pt=50,vt=1500;function gt(e,t){return ct(this,void 0,void 0,function*(){const n=(0,a.select)(gn).getPageAttribute("ai/testGenerationState");if(!n||"intro"!==n.type)return;try{if(t){const e=(0,a.select)(gn).getPluginSetting("aiSettings");if("ready"===(null==e?void 0:e.type))throw new Error("cant-override-settings");yield At(()=>function(e,t){return ct(this,void 0,void 0,function*(){yield bt({id:t,type:"analyzing-site",what:"saving-ai-settings"});const n=yield Ze({path:"/nab/v1/ai/settings",method:"PUT",data:{settings:e}});yield(0,a.dispatch)(gn).updateAiSettings(n)})}(t,n.id))}}catch(e){return void(yield bt({id:n.id,type:"error",reason:_t(e)}))}const i=(0,a.select)(gn).getPluginSetting("aiSettings");if("ready"!==(null==i?void 0:i.type))throw new Error("invalid-ai-settings");const s=yield At(()=>function(e){return ct(this,void 0,void 0,function*(){yield bt({id:e,type:"analyzing-site",what:"ab-testing"});try{const e=yield function(){return ct(this,void 0,void 0,function*(){try{return Ze({path:"/nab/v1/ai/latest-experiments"})}catch(e){return[]}})}();return{type:"data",base:{experiments:e.filter(e=>"nab/heatmap"!==e.type),heatmaps:e.filter(e=>"nab/heatmap"===e.type)},aiAnalysis:{experiments:e.filter(e=>"nab/heatmap"!==e.type).map(e=>({id:e.id,type:e.type,status:e.status,name:e.name,description:e.description,startDate:e.startDate||void 0,endDate:e.endDate||void 0,alternatives:(0,d.map)(e.alternatives,(e,t)=>({name:jt(t,e.attributes.name),attributes:(0,d.omit)(e.attributes,"name")})),goals:(0,d.map)(e.goals,(e,t)=>({name:Pt(t,e.attributes.name),actions:e.conversionActions.map(e=>({type:e.type,attributes:e.attributes}))}))})),heatmaps:e.filter(e=>"nab/heatmap"===e.type).map(e=>({id:e.id,type:e.type,status:e.status,name:e.name,description:e.description,startDate:e.startDate||void 0,endDate:e.endDate||void 0,trackingMode:e.trackingMode,trackedPostId:e.trackedPostId,trackedPostType:e.trackedPostType,trackedUrl:e.trackedUrl}))}}}catch(e){return{type:"error",error:e}}})}(n.id));if("error"!==s.type){try{const t=yield function(e,t,n){return ct(this,void 0,void 0,function*(){var i;yield bt({id:n,type:"analyzing-site",what:"previous-candidates"});const s=yield Ze({path:"/nab/v1/ai/test-candidates",method:"GET"});if(!s.length)return;const r=(0,d.toPairs)((0,d.mapValues)((0,d.groupBy)(s,"type"),e=>e.map(e=>e.id))).filter(e=>"string"==typeof e[0]),o=(yield Promise.allSettled(r.map(([e,t])=>function(e,t){return ct(this,void 0,void 0,function*(){const n=t.join(",");if("product"===e&&(yield wt()))return(yield Ze({path:`/wc/v3/products?include=${n}`})).map(Ot);const i="page"===e||"post"===e?`${e}s`:e;return(yield Ze({path:`/wp/v2/${i}?include=${n}`})).map(Et({analytics:[]}))})}(e,t)))).filter(e=>"fulfilled"===e.status).map(e=>e.value),u=(0,d.groupBy)(o.filter(e=>{var t;return"product"!==(null===(t=e[0])||void 0===t?void 0:t.type)}).flatMap(e=>e),"type"),c=Object.assign({product:null!==(i=o.find(e=>{var t;return"product"===(null===(t=e[0])||void 0===t?void 0:t.type)}))&&void 0!==i?i:[]},u),l={status:"pending"},p=s.map(e=>{var n,{type:i,id:s}=e,r=lt(e,["type","id"]);const o=null===(n=c[i])||void 0===n?void 0:n.find(e=>e.id===s),a=o&&r.hypotheses?{status:"ready",hypotheses:r.hypotheses.map(e=>Object.assign(Object.assign({},e),{controlUrl:o.url,relatedTests:t.filter(t=>{var n;return(null===(n=t.ai)||void 0===n?void 0:n.basedOnNelioAIHypothesis)===e.id}).map(e=>e.id)})),isVisible:!1}:l;return o?Object.assign(Object.assign(Object.assign({},o),r),{hypothesisState:a}):void 0}).filter(b.isDefined);return p.length?{siteAnalysis:{content:c,metaInformation:{language:(0,a.select)(gn).getSiteLanguage(),blog:void 0,woocommerce:void 0,abTesting:e,urlAnalytics:[]}},candidates:p}:void 0})}(s.aiAnalysis,s.base.experiments,n.id);if(t){const i=yield mt({candidates:t.candidates,experiments:s.base.experiments,siteAnalysis:t.siteAnalysis,stateId:n.id,validExperimentTypes:e});return void(yield bt({id:n.id,type:"hypothesis-selection",siteAnalysis:t.siteAnalysis,candidates:i,testing:s.base}))}}catch(e){}try{const t=yield function(e,t){return ct(this,void 0,void 0,function*(){const n=yield At(()=>function(e){return ct(this,void 0,void 0,function*(){const t=(0,a.select)(gn).getPluginSetting("aiSettings");if("ready"!==(null==t?void 0:t.type))return[];if(!t.analytics.enabled)return[];try{return yield bt({id:e,type:"analyzing-site",what:"google-analytics"}),(yield Ze({path:"/nab/v1/ai/top-viewed-items"})).filter(e=>"url"!==e.type)}catch(e){return[]}})}(t)),i={analytics:n,abTesting:e},s=yield At(()=>function(e,t){return ct(this,void 0,void 0,function*(){const n=(0,a.select)(gn).getPluginSetting("aiSettings");if("ready"!==(null==n?void 0:n.type))return[];if(!n.privacy.postTypes.includes("page"))return[];try{return yield bt({id:t,type:"analyzing-site",what:"pages"}),St({context:e,postType:"page",experimentTypes:["nab/page"],maxItems:dt})}catch(e){return[]}})}(i,t)),r=yield At(()=>function(e,t){return ct(this,void 0,void 0,function*(){const n=(0,a.select)(gn).getPluginSetting("aiSettings");if("ready"!==(null==n?void 0:n.type))return{};yield bt({id:t,type:"analyzing-site",what:"custom-posts"});try{const t=yield c(gn).getKindEntities(),i=ut({isWooCommerceEnabled:yield wt()}),s=t.filter(e=>"entity"===e.kind).map(e=>e.name).filter(e=>!e.startsWith("nab_")).filter(e=>!i.includes(e)).filter(e=>n.privacy.postTypes.includes(e));if(!s.length)return{};const r=yield Promise.allSettled(s.map(t=>St({postType:t,experimentTypes:["nab/custom-post-type"],context:e,maxItems:pt})));return(0,d.groupBy)(r.filter(e=>"fulfilled"===e.status).flatMap(e=>e.value),"type")}catch(e){return{}}})}(i,t)),o=yield At(()=>function(e,t){return ct(this,void 0,void 0,function*(){const n=(0,a.select)(gn).getPluginSetting("aiSettings");if("ready"===(null==n?void 0:n.type)&&n.privacy.postTypes.includes("post")){yield bt({id:t,type:"analyzing-site",what:"blog"});try{const t=window.wpApiSettings,n=yield fetch(`${t.root.replace(/\/$/,"")}/wp/v2/posts?status=publish&per_page=1&after=${Tt()}`,{method:"GET",headers:{"X-WP-Nonce":t.nonce,"Content-Type":"application/json"},credentials:"same-origin"}),i=Number.parseInt(n.headers.get("X-WP-Total")||"")||0;return{posts:yield St({context:e,postType:"post",experimentTypes:["nab/post","nab/headline"],maxItems:pt}),info:{totalPostsInLastYear:i,averagePostsPerMonth:i/12}}}catch(e){return}}})}(i,t)),u=yield At(()=>function(e){return ct(this,void 0,void 0,function*(){if(!(yield wt()))return;const t=(0,a.select)(gn).getPluginSetting("aiSettings");if("ready"!==(null==t?void 0:t.type))return;if(!t.privacy.isWooCommerceEnabled)return;yield bt({id:e,type:"analyzing-site",what:"ecommerce"});const n=yield function(){return ct(this,void 0,void 0,function*(){var e,t;try{const n=yield Ze({path:`/wc-analytics/leaderboards?leaderboard=products&after=${Tt()}&before=${(new Date).toISOString()}&per_page=10`}),i=document.createElement("div");return(null!==(t=null===(e=n[0])||void 0===e?void 0:e.rows)&&void 0!==t?t:[]).map(e=>{var t,n,s,r;i.innerHTML=(null===(t=e[0])||void 0===t?void 0:t.display)||"";const o=(null!==(s=null===(n=i.querySelector("a"))||void 0===n?void 0:n.href)&&void 0!==s?s:"").match(/\bproducts=([0-9]+)\b/)||[];return{id:Number.parseInt(o[1]||"0")||0,quantity:(null===(r=e[1])||void 0===r?void 0:r.value)||0}}).filter(e=>!!e.id&&!!e.quantity)}catch(e){return[]}})}(),i=yield function(){return ct(this,void 0,void 0,function*(){const e=(0,a.select)(gn).getPluginSetting("aiSettings");if("ready"!==(null==e?void 0:e.type))return[];if(e.privacy.isWooCommerceEnabled&&e.privacy.includeWooCommerceOrderInfo)return[];try{return(yield Ze({path:"/wc/v3/orders?per_page=50"})).map(e=>({date:e.date_created,total:e.total,status:e.status,products:e.line_items.map(e=>e.product_id)}))}catch(e){return[]}})}(),s=yield xt("random"),r=(0,d.uniq)(i.flatMap(e=>e.products)).filter(e=>!s.some(t=>t.id===e)),o=yield xt(r);return{products:[...s,...o],info:{bestSellers:n,latestOrders:i}}})}(t));return{content:Object.assign(Object.assign({},(0,d.mapValues)(r,e=>(null==e?void 0:e.length)?e:void 0)),{page:s.length?s:void 0,post:null==o?void 0:o.posts,product:null==u?void 0:u.products}),metaInformation:{language:(0,a.select)(gn).getSiteLanguage(),blog:null==o?void 0:o.info,woocommerce:null==u?void 0:u.info,abTesting:e,urlAnalytics:n.filter(e=>"url"===e.type).map(e=>({url:e.url,monthlyViews:e.monthlyViews}))}}})}(s.aiAnalysis,n.id),i=yield function(e,t,n){return ct(this,void 0,void 0,function*(){yield bt({id:n,type:"searching-candidates",step:"just-started"});const i=()=>{const e=(0,a.select)(gn).getPageAttribute("ai/testGenerationState");return!!e&&"searching-candidates"===e.type};setTimeout(()=>i()&&bt({id:n,type:"searching-candidates",step:"keep-waiting"}),12e3),setTimeout(()=>i()&&bt({id:n,type:"searching-candidates",step:"quite-slow"}),24e3);const s=yield Ze({path:"/nab/v1/ai/test-candidates",method:"POST",data:{analysis:Object.assign(Object.assign({},e),{content:(0,d.mapValues)(e.content,e=>null==e?void 0:e.map(e=>(0,d.omit)(e,"contentSummary")))})}}),r={status:"pending"};return s.map(({type:n,id:i,rationale:s,priority:o,hypotheses:a,hypothesisGeneration:u})=>{var c;const l=null===(c=e.content[n])||void 0===c?void 0:c.find(e=>e.id===i),d=l&&a?{status:"ready",hypotheses:a.map(e=>Object.assign(Object.assign({},e),{controlUrl:l.url,relatedTests:t.filter(t=>{var n;return(null===(n=t.ai)||void 0===n?void 0:n.basedOnNelioAIHypothesis)===e.id}).map(e=>e.id)})),isVisible:!1}:r;return l?Object.assign(Object.assign({},l),{rationale:s,priority:o,hypothesisState:d,hypothesisGeneration:u}):void 0}).filter(b.isDefined)})}(t,s.base.experiments,n.id),r=yield mt({candidates:i,experiments:s.base.experiments,siteAnalysis:t,stateId:n.id,validExperimentTypes:e});yield bt({id:n.id,type:"hypothesis-selection",siteAnalysis:t,candidates:r,testing:s.base})}catch(e){yield bt({id:n.id,type:"error",reason:_t(e)})}}else yield bt({id:n.id,type:"error",reason:_t(s.error)})})}function yt(e,t){return ct(this,void 0,void 0,function*(){const n=(0,a.select)(gn).getPluginSetting("aiSettings");if("ready"!==(null==n?void 0:n.type))return;const i=(0,a.select)(gn).getPageAttribute("ai/testGenerationState");i&&"hypothesis-selection"===i.type&&("ready"!==e.hypothesisState.status?"pending"===e.hypothesisState.status&&(e=yield It(Object.assign(Object.assign({},e),{hypothesisState:{status:"generating"}})),yield ht({candidate:e,experiments:i.testing.experiments,language:i.siteAnalysis.metaInformation.language,validExperimentTypes:t})):yield It(Object.assign(Object.assign({},e),{hypothesisState:Object.assign(Object.assign({},e.hypothesisState),{isVisible:!0})})))})}function ft(e,t){return ct(this,void 0,void 0,function*(){var n;const i=(0,a.select)(gn).getPluginSetting("aiSettings");if("ready"!==(null==i?void 0:i.type))return;const s=(0,a.select)(gn).getPageAttribute("ai/testGenerationState");if(s&&"hypothesis-selection"===s.type){yield bt(Object.assign(Object.assign({},s),{type:"creating-test"}));try{const i=t.find(t=>t.name===e.testType);if(!i)throw new Error("invalid-experiment-type");const r=yield function(e){return ct(this,void 0,void 0,function*(){var t,n;const i="tested-post-with-consistency"===(null===(t=e.supports)||void 0===t?void 0:t.scope)||"tested-product-with-consistency"===(null===(n=e.supports)||void 0===n?void 0:n.scope);return Ze({path:"/nab/v1/experiment",method:"post",data:{type:e.name,addTestedPostScopeRule:i}})})}(i),o=i.supports.automaticGoalSetup?{id:at(),attributes:{name:(0,nt._x)("Default Goal","text","nelio-ab-testing")},conversionActions:null!==(n=i.supports.automaticGoalSetup(r.alternatives[0]))&&void 0!==n?n:[]}:void 0,a="urls"===i.supports.scope||"urls-or-php"===i.supports.scope?[{id:at(),attributes:{type:"exact",value:e.controlUrl}}]:void 0,u=yield function(e){return ct(this,void 0,void 0,function*(){return Ze({path:`/nab/v1/experiment/${e.id}`,method:"PUT",data:e})})}(Object.assign(Object.assign({},r),{scope:null!=a?a:r.scope,name:e.name,description:e.description,ai:{version:1,basedOnNelioAIHypothesis:e.id},alternatives:[{id:"control",attributes:{postId:e.control.id,postType:e.control.type},links:(0,b.createAlternative)().links},...e.variants.map(e=>{const t=(0,b.createAlternative)();return Object.assign(Object.assign({},t),{attributes:Object.assign(Object.assign({},t.attributes),{name:e.name}),ai:{isReady:!1,name:e.name,changes:e.changes}})})],goals:[o,...e.goals.map(e=>({id:at(),attributes:{name:e.name},ai:{name:e.name,description:e.description},conversionActions:[]}))].filter(b.isDefined)}));yield bt(Object.assign(Object.assign({},s),{experiment:u,type:"done"}))}catch(e){yield bt({id:s.id,type:"error",reason:_t(e)})}}})}function mt(e){return ct(this,void 0,void 0,function*(){const t=e.candidates.find(e=>"available"===e.hypothesisGeneration);if(!t)return e.candidates;if("ready"===t.hypothesisState.status){const n=yield It(Object.assign(Object.assign({},t),{hypothesisState:Object.assign(Object.assign({},t.hypothesisState),{isVisible:!0})}));return e.candidates.map(e=>e===t?n:e)}yield bt({id:e.stateId,type:"analyzing-site",what:"first-hypotheses"});const n=yield ht({candidate:t,language:e.siteAnalysis.metaInformation.language,validExperimentTypes:e.validExperimentTypes,experiments:e.experiments});return e.candidates.map(e=>e===t?n:e)})}function ht(e){return ct(this,arguments,void 0,function*({candidate:e,experiments:t,language:n,validExperimentTypes:i}){var s;e=yield It(Object.assign(Object.assign({},e),{contentSummary:(null===(s=e.contentSummary)||void 0===s?void 0:s.length)?e.contentSummary:yield(0,b.getContentSummary)(e.url)}));const r=i.map(e=>e.name);try{const i=(yield Ze({path:"/nab/v1/ai/test-hypotheses",method:"POST",data:{language:n,id:e.id,type:e.type,url:e.url,content:e.contentSummary||[]}})).filter(e=>r.includes(e.testType)).map(n=>Object.assign(Object.assign({},n),{controlUrl:e.url,relatedTests:t.filter(e=>{var t;return(null===(t=e.ai)||void 0===t?void 0:t.basedOnNelioAIHypothesis)===n.id}).map(e=>e.id)})),s=[...i.filter(e=>!e.relatedTests.length),...i.filter(e=>!!e.relatedTests.length)];if(!s.length)throw new Error("no-hypotheses-available");return It(Object.assign(Object.assign({},e),{hypothesisState:{status:"ready",hypotheses:s,isVisible:!0}}))}catch(t){return It(Object.assign(Object.assign({},e),{hypothesisState:{status:"error",reason:_t(t)||"nelio-ai-unknown-error-901"}}))}})}function bt(e){return ct(this,void 0,void 0,function*(){const t=(0,a.select)(gn).getPageAttribute("ai/testGenerationState");if(!t||t.id!==e.id)return;const{setPageAttribute:n}=(0,a.dispatch)(gn);yield n("ai/testGenerationState",e)})}const Et=({analytics:e})=>t=>{var n,i,s,r,o,u,c,l;return{id:t.id,type:t.type,title:(0,tt.decodeEntities)(null!==(i=null===(n=t.title)||void 0===n?void 0:n.rendered)&&void 0!==i?i:""),url:t.link||"",contentMetrics:(0,b.getContentMetrics)((0,a.select)(gn).getPluginSetting("homeUrl"),null===(s=t.content)||void 0===s?void 0:s.rendered),publicationDate:t.date||"",lastUpdate:t.modified||"",monthlyViews:null===(r=e.find(e=>"post"===e.type&&e.postType===t.type&&e.postId===t.id))||void 0===r?void 0:r.monthlyViews,seoTitle:(null===(u=null===(o=t.yoast_head_json)||void 0===o?void 0:o.title)||void 0===u?void 0:u.trim())||void 0,seoDescription:(null===(l=null===(c=t.yoast_head_json)||void 0===c?void 0:c.description)||void 0===l?void 0:l.trim())||void 0}};function St(e){return ct(this,arguments,void 0,function*({context:e,postType:t,experimentTypes:n,maxItems:i}){const s=(0,d.uniq)([...e.analytics.map(e=>"post"===e.type&&e.postType===t?e.postId:0).filter(e=>!!e),...e.abTesting.experiments.filter(e=>n.includes(e.type)).map(e=>{var t;return null===(t=e.alternatives[0])||void 0===t?void 0:t.attributes}).filter(e=>!(null==e?void 0:e.postType)||(null==e?void 0:e.postType)===t).map(e=>{var t;return null!==(t=null==e?void 0:e.postId)&&void 0!==t?t:0}).filter(e=>!!e),...e.abTesting.heatmaps.filter(e=>"post"===e.trackingMode&&e.trackedPostType===t).map(e=>e.trackedPostId).filter(e=>"number"==typeof e).filter(e=>!!e)]),r="page"===t||"post"===t?`${t}s`:t,o=s.length?yield Ze({path:`/wp/v2/${r}?include=${s.join(",")}`}):[],a=o.map(e=>e.id).join(","),u=Math.max(0,i-o.length),c=u?yield Ze({path:a?`/wp/v2/${r}?per_page=${u}&exclude=${a}&status=publish&orderby=rand`:`/wp/v2/${r}?per_page=${u}&status=publish&orderby=rand`}):[];return[...o,...c].map(Et(e))})}function wt(){return ct(this,void 0,void 0,function*(){return(yield c(gn).getActivePlugins()).includes("woocommerce/woocommerce.php")})}const Ot=e=>({id:e.id,type:"product",url:e.permalink||"",name:e.name||"",price:e.price?`${e.price}`:"",publicationDate:e.date_created||"",lastUpdate:e.date_modified||""});function xt(e){return ct(this,void 0,void 0,function*(){try{return(yield Ze({path:"random"===e?"/wc/v3/products?per_page=50&status=publish&orderby=rand":`/wc/v3/products?include=${e.join(",")}`})).map(Ot)}catch(e){return[]}})}function Tt(){const e=new Date;return e.setFullYear(e.getFullYear()-1),e.toISOString()}function jt(e,t=""){const n=(0,nt.sprintf)(/* translators: %s: Letter, such as A, B, or C. */ /* translators: %s: Letter, such as A, B, or C. */
(0,nt._x)("Variant %s","text","nelio-ab-testing"),(0,b.getLetter)(e));return(t=t.trim())?`${n} – ${t}`:n}function Pt(e,t=""){const n=0===e?(0,nt._x)("Default Goal","text","nelio-ab-testing"):(0,nt.sprintf)(/* translators: %d: Number. */ /* translators: %d: Number. */
(0,nt._x)("Goal %d","text","nelio-ab-testing"),e);return(t=t.trim())?`${n} – ${t}`:n}function At(e){return ct(this,void 0,void 0,function*(){const t=Date.now(),n=yield e();if(void 0===n)return n;const i=Date.now()-t,s=Math.max(0,vt-i);return yield new Promise(e=>setTimeout(e,s)),n})}function It(e){return ct(this,void 0,void 0,function*(){const t=(0,a.select)(gn).getPageAttribute("ai/testGenerationState");return t&&"hypothesis-selection"===t.type?(yield bt(Object.assign(Object.assign({},t),{candidates:t.candidates.map(t=>t.type===e.type&&t.id===e.id?e:t)})),e):e})}function _t(e){if(!e)return;if("string"==typeof e)return e||void 0;const t="object"==typeof e&&"code"in e&&"string"==typeof e.code&&e.code?e.code:void 0;return t||console.error(e),t}var Rt=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function o(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}u((i=i.apply(e,t||[])).next())})};function Ut(){return Rt(this,void 0,void 0,function*(){const e=(0,a.select)(gn).getPageAttribute("editor/activeExperiment");if(!e)return;let t,n;yield(0,a.dispatch)(gn).setPageAttribute("editor/isExperimentBeingStopped",!0);try{if(t=yield c(gn).getExperiment(e),!t)return}catch(e){return void(yield(0,b.createErrorNotice)(e))}try{n=yield Ze({path:`/nab/v1/experiment/${e}/stop`,method:"PUT"})}catch(e){return yield(0,b.createErrorNotice)(e,(0,nt._x)("Test can’t be stopped","text","nelio-ab-testing")),void(yield(0,a.dispatch)(gn).setPageAttribute("editor/isExperimentBeingStopped",!1))}const i=(0,d.keyBy)(n.alternatives||[],"id"),s=Object.assign(Object.assign({},n),{links:Object.assign(Object.assign({},n.links),t.links),alternatives:(t.alternatives||[]).map(e=>Object.assign(Object.assign({},e),{links:Vt(e,i[e.id])}))});yield(0,a.dispatch)(gn).receiveExperiment(t.id,s),yield(0,a.dispatch)(gn).setPageAttribute("editor/isExperimentBeingStopped",!1)})}function Ct(){return Rt(this,void 0,void 0,function*(){const e=(0,a.select)(gn).getPageAttribute("editor/activeExperiment");if(e){yield(0,a.dispatch)(gn).setPageAttribute("editor/isExperimentBeingPaused",!0);try{yield Ze({path:`/nab/v1/experiment/${e}/pause`,method:"PUT"})}catch(e){return yield(0,b.createErrorNotice)(e,(0,nt._x)("Test can’t be paused","text","nelio-ab-testing")),void(yield(0,a.dispatch)(gn).setPageAttribute("editor/isExperimentBeingPaused",!1))}window.location.href=(0,a.select)(gn).getAdminUrl("admin.php",{page:"nelio-ab-testing-experiment-edit",experiment:e})}})}function kt(e){return Rt(this,void 0,void 0,function*(){const t=(0,a.select)(gn).getPageAttribute("editor/activeExperiment");if(!t)return;let n;yield(0,a.dispatch)(gn).setPageAttribute("editor/alternativeBeingApplied",e);try{n=yield Ze({path:`/nab/v1/experiment/${t}/apply/${e}`,method:"PUT"})}catch(e){return yield(0,b.createErrorNotice)(e,(0,nt._x)("Alternative can’t be applied","text","nelio-ab-testing")),void(yield(0,a.dispatch)(gn).setPageAttribute("editor/alternativeBeingApplied",!1))}yield(0,a.dispatch)(gn).changeLastAppliedAlternative(n.id,e),yield(0,a.dispatch)(gn).setPageAttribute("editor/alternativeBeingApplied",!1)})}function $t(e){return Rt(this,void 0,void 0,function*(){const t=(0,a.select)(gn).getPageAttribute("editor/activeExperiment");if(!t)return;yield(0,a.dispatch)(gn).setPageAttribute("isLocked",!0);let n=e;try{n=yield Ze({path:`/nab/v1/experiment/${t}/public-result-status`,method:"PUT",data:{status:e}})}catch(e){return yield(0,b.createErrorNotice)(e,(0,nt._x)("Public result’s status can’t be changed","text","nelio-ab-testing")),void(yield(0,a.dispatch)(gn).setPageAttribute("isLocked",!1))}yield(0,a.dispatch)(gn).setPageAttribute("isLocked",!1),yield(0,a.dispatch)(gn).setPageAttribute("results/isReadOnlyActive",n)})}function Vt(e,t){if(null==e?void 0:e.links)return(null==t?void 0:t.links)?Object.assign(Object.assign({},t.links),{heatmap:e.links.heatmap,preview:e.links.preview}):e.links}var Dt=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function o(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}u((i=i.apply(e,t||[])).next())})};function qt(e,t){return Dt(this,void 0,void 0,function*(){const n=(0,a.select)(gn).getSubscriptionId();if(n)try{yield(0,a.dispatch)(gn).lock(),yield Ze({path:`/nab/v1/subscription/${n}/quota`,method:"POST",data:{quantity:e,currency:t}}),window.location.reload()}catch(e){yield(0,a.dispatch)(gn).unlock(),yield(0,b.createErrorNotice)(e)}})}var Mt=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function o(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}u((i=i.apply(e,t||[])).next())})};function Nt(){return Mt(this,void 0,void 0,function*(){try{const e=yield Ze({path:"/nab/v1/types"});yield(0,a.dispatch)(gn).receiveKindEntitiesQuery((0,d.values)(e))}catch(e){console.warn(e)}})}function Lt(e,t){return Mt(this,void 0,void 0,function*(){if(e&&t)try{const n=yield c(gn).getKindEntities();if(!(0,d.find)(n,{name:e}))return void console.warn(`Entity ${e} not found in`,n);const i=yield Ze({path:`/nab/v1/post/?id=${t}&type=${e}`});yield(0,a.dispatch)(gn).receiveEntityRecords(e,i)}catch(e){console.warn(e)}})}var Gt=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function o(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}u((i=i.apply(e,t||[])).next())})};function Bt(e){return Gt(this,void 0,void 0,function*(){if(e)try{const t=yield Ze({path:`/nab/v1/experiment/${e}`});yield(0,a.dispatch)(gn).receiveExperiment(e,t)}catch(t){const n=t instanceof Error?t.message:"unknown";console.warn(`Unable to retrieve experiment ${e}. Error: ${n}.`)}})}var Ft=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function o(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}u((i=i.apply(e,t||[])).next())})};function Qt(){return Ft(this,void 0,void 0,function*(){try{const{currency:e,products:t,subscriptionId:n}=yield Ze({path:"/nab/v1/fastspring"});yield(0,a.dispatch)(gn).receiveFSCurrency(e),yield(0,a.dispatch)(gn).receiveFSProducts(t),yield(0,a.dispatch)(gn).receiveFSSubscriptionId(n)}catch(e){throw yield(0,b.createErrorNotice)(e,(0,nt._x)("Error while retrieving NC products.","text","nelio-ab-testing")),e}})}const Yt=()=>Ft(void 0,void 0,void 0,function*(){yield c(gn).getProducts()}),Ht=()=>Ft(void 0,void 0,void 0,function*(){yield c(gn).getProducts()});var zt=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function o(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}u((i=i.apply(e,t||[])).next())})};function Kt(e){return zt(this,void 0,void 0,function*(){if(e)try{const t=yield Ze({path:`/wp/v2/media/${e}`});yield(0,a.dispatch)(gn).receiveMediaUrl(e,t.source_url)}catch(e){const t=e instanceof Error?e.message:"unknown";console.warn(`Error while retrieving media. Error: ${t}`)}})}var Wt=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function o(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}u((i=i.apply(e,t||[])).next())})};function Xt(e){return Wt(this,void 0,void 0,function*(){try{const t=yield c(gn).getExperiment(e);if(!t)return;const n=function(e,t){return Object.assign({winners:$(e.results||{},t.goals),wasEnoughData:V(e.results||{},t.goals),alternatives:D(e,t),segments:k(e,t)},e.uniqueResults&&{winnersUnique:$(e.uniqueResults||{},t.goals),wasEnoughDataUnique:V(e.uniqueResults||{},t.goals)})}(yield Ze({path:`/nab/v1/experiment/${e}/result`}),t);yield(0,a.dispatch)(gn).receiveExperimentResult(e,n)}catch(t){yield(0,b.createErrorNotice)(t,(0,nt.sprintf)(/* translators: %d: Test id. */ /* translators: %d: Test id. */
(0,nt._x)("Unable to retrieve results in test %d.","text","nelio-ab-testing"),e))}})}function Jt(e){return Wt(this,void 0,void 0,function*(){yield c(gn).getExperimentResults(e)})}function Zt(e){return Wt(this,void 0,void 0,function*(){yield c(gn).getExperimentResults(e)})}function en(e){return Wt(this,void 0,void 0,function*(){yield c(gn).getExperimentResults(e)})}function tn(e){return Wt(this,void 0,void 0,function*(){yield c(gn).getExperimentResults(e)})}function nn(e){return Wt(this,void 0,void 0,function*(){yield c(gn).getExperimentResults(e)})}var sn=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function o(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}u((i=i.apply(e,t||[])).next())})};function rn(){return sn(this,void 0,void 0,function*(){try{const e=yield Ze({path:"/nab/v1/plugins"});yield(0,a.dispatch)(gn).receivePlugins(e)}catch(e){const t=e instanceof Error?e.message:"unknown";console.warn(`Unable to retrieve active plugins. Error: ${t}`)}})}function on(){return sn(this,void 0,void 0,function*(){try{const e=yield Ze({path:"/nab/v1/menu/search?query"});yield(0,a.dispatch)(gn).receiveMenus(e.results)}catch(e){const t=e instanceof Error?e.message:"unknown";console.warn(`Unable to check if site has menus. Error: ${t}`)}})}function an(e){return sn(this,void 0,void 0,function*(){try{const t=yield Ze({path:`/nab/v1/menu/${e}`});yield(0,a.dispatch)(gn).receiveMenus(t)}catch(t){const n=t instanceof Error?t.message:"unknown";console.warn(`Unable to retrieve menu ${e}. Error: ${n}`)}})}function un(){return sn(this,void 0,void 0,function*(){try{const e=yield Ze({path:(0,Y.addQueryArgs)("/nab/v1/template-contexts")});yield(0,a.dispatch)(gn).receiveTemplateContexts(e.results)}catch(e){const t=e instanceof Error?e.message:"unknown";console.warn(`Unable to retrieve template contexts. Error: ${t}`)}})}function cn(){return sn(this,void 0,void 0,function*(){try{const e=yield Ze({path:(0,Y.addQueryArgs)("/nab/v1/templates")});yield(0,a.dispatch)(gn).receiveTemplates(e.results)}catch(e){const t=e instanceof Error?e.message:"unknown";console.warn(`Unable to retrieve templates. Error: ${t}`)}})}function ln(){return sn(this,void 0,void 0,function*(){try{const e=yield Ze({path:"/nab/v1/themes"});yield(0,a.dispatch)(gn).receiveThemes(e.results)}catch(e){const t=e instanceof Error?e.message:"unknown";console.warn(`Unable to retrieve themes. Error: ${t}`)}})}var dn=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function o(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}u((i=i.apply(e,t||[])).next())})};function pn(){return dn(this,void 0,void 0,function*(){try{const e=yield Ze({path:"/nab/v1/site/quota"});yield(0,a.dispatch)(gn).receiveSiteQuota(e)}catch(e){throw yield(0,b.createErrorNotice)((0,nt._x)("Unable to retrieve quota.","text","nelio-ab-testing")),e}})}const vn=Object.assign(Object.assign({},t),s),gn=(0,a.createReduxStore)("nab/data",{reducer:S,controls:a.controls,actions:vn,selectors:e,resolvers:r});!function(e){(0,a.register)(e)}(gn),(0,a.select)(gn).getPluginSetting("siteId"),(0,a.dispatch)(gn).setToday((0,l.format)("Y-m-d",new Date)),function(e,t){var n;(0,a.dispatch)(gn).setPageAttribute(e,(0,b.getValue)(e,t));let i=null!==(n=(0,a.select)(gn).getPageAttribute(e))&&void 0!==n?n:t;!function(e,t){(0,a.subscribe)(e,t)}(()=>{var n;const s=null!==(n=(0,a.select)(gn).getPageAttribute(e))&&void 0!==n?n:t;s!==i&&(i=s,(0,b.setValue)(e,s))},gn)}("results/shouldShowUniqueResults",!1);const yn=window.wp.element;function fn(e,t){return u(n=>{var i;const{getPageAttribute:s,getExperimentAttribute:r}=n(gn),o=s("editor/activeExperiment");return o&&null!==(i=r(o,e))&&void 0!==i?i:t},[e,t])}function mn(e,t){var n;const i=null!==(n=u(t=>t(gn).getPageAttribute(e),[e]))&&void 0!==n?n:t,{setPageAttribute:s}=(0,a.useDispatch)(gn);return[i,(0,yn.useCallback)(t=>s(e,t),[e,s])]}function hn(e){return u(t=>t(gn).getPluginSetting(e),[e])}const bn=(e,t)=>u(n=>n(gn).getAdminUrl(e,t),[e,t])})();var s=nab="undefined"==typeof nab?{}:nab;for(var r in i)s[r]=i[r];i.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();