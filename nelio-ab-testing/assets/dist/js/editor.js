(()=>{var e,t={8788(e,t,n){"use strict";n.r(t),n.d(t,{editor:()=>r});var i={};n.r(i),n.d(i,{getActiveGoal:()=>C,getActiveGoalIndex:()=>D,getActiveSegment:()=>P,getActiveSegmentIndex:()=>k,getAiAlternativeModal:()=>G,getAlternative:()=>w,getAlternativeIds:()=>N,getAlternativePreviewerUrl:()=>B,getAlternatives:()=>O,getConversionActions:()=>I,getDraftStatusRationale:()=>M,getExperimentAttribute:()=>q,getExperimentId:()=>V,getExperimentType:()=>L,getGoals:()=>H,getHeatmapAttribute:()=>U,getScope:()=>Y,getSegmentEvaluation:()=>z,getSegmentationRules:()=>$,getSegments:()=>W,hasExperimentBeenRecentlySaved:()=>R,isExperimentBeingSaved:()=>T,isTestedElementInvalid:()=>F});var s={};n.r(s),n.d(s,{addAlternatives:()=>X,addConversionActionsIntoGoal:()=>Z,addGoals:()=>ve,addSegmentationRulesIntoSegment:()=>je,addSegments:()=>_e,closeAlternativePreviewer:()=>ue,openAlternativePreviewer:()=>ce,removeAlternatives:()=>J,removeConversionActionsFromGoal:()=>te,removeGoals:()=>be,removeSegmentationRulesFromSegment:()=>Ae,removeSegments:()=>ye,replaceAlternatives:()=>Q,replaceConversionActionsInGoal:()=>ee,replaceSegmentationRulesInSegment:()=>Ee,setActiveGoal:()=>se,setActiveSegment:()=>ae,setAlternative:()=>K,setDraftStatusRationale:()=>oe,setExperimentAsBeingSaved:()=>re,setExperimentAsRecentlySaved:()=>le,setExperimentData:()=>pe,setHeatmapData:()=>ge,setScopeRules:()=>he,setSegmentEvaluation:()=>we,setTestedElementAsInvalid:()=>me,setupEditor:()=>ie,showAiAlternativeModal:()=>de,updateConversionAction:()=>ne,updateGoal:()=>xe,updateSegment:()=>fe,updateSegmentationRule:()=>Se});var a={};n.r(a),n.d(a,{moveToTrash:()=>Le,resumeExperiment:()=>Ue,saveExperiment:()=>Be,saveExperimentAndEditAlternative:()=>Ge,saveExperimentAndPreviewAlternative:()=>Ve,startExperiment:()=>qe});var r={};n.r(r),n.d(r,{EditorProvider:()=>Xe,ExperimentName:()=>Bt,Header:()=>Nt,Sidebar:()=>Xi,initializeExperimentEditor:()=>_s,store:()=>ze});const o=window.ReactJSXRuntime,l=(window.wp.coreData,window.wp.data);function c(e,t){return(0,l.useSelect)(e,t)}const u=window.wp.domReady,d=n.n(u)(),p=window.wp.element,g=window.lodash,m=window.nab.data,v=window.nab.experimentLibrary,b=window.nab.utils,x={alternatives:{byId:{control:{id:"control",attributes:{},links:{edit:"",heatmap:"",preview:""}}},allIds:[]},conversionActions:{},data:{id:0,type:"",status:"draft",name:"",description:"",startDate:"",endDate:"",endMode:"manual",endValue:0,autoAlternativeApplication:!1,isTestedElementInvalid:!1,links:{edit:"",preview:""}},goals:{},scope:{},segmentation:{evaluation:"tested-page",rules:{},segments:{}}},h={activeGoalId:"",activeSegmentId:"",aiAlternativeModal:void 0,alternativePreviewerUrl:"",draftStatusRationale:"",hasExperimentBeenRecentlySaved:!1,isExperimentBeingSaved:!1},_=x.alternatives,y=x.conversionActions,f=x.data,j=x.goals,E=x.scope,A=x.segmentation,S=(0,l.combineReducers)({editor:function(e=h,t){var n;return null!==(n=function(e,t){switch(t.type){case"SET_ACTIVE_GOAL":return Object.assign(Object.assign({},e),{activeGoalId:t.goalId});case"SET_ACTIVE_SEGMENT":return Object.assign(Object.assign({},e),{activeSegmentId:t.segmentId});case"SET_EXPERIMENT_AS_BEING_SAVED":return Object.assign(Object.assign({},e),{isExperimentBeingSaved:!!t.status});case"SET_EXPERIMENT_AS_RECENTLY_SAVED":return Object.assign(Object.assign({},e),{hasExperimentBeenRecentlySaved:!0});case"SET_DRAFT_STATUS_RATIONALE":return(0,g.isEqual)(e.draftStatusRationale,t.rationale)?e:Object.assign(Object.assign({},e),{draftStatusRationale:t.rationale});case"OPEN_ALTERNATIVE_PREVIEWER":return Object.assign(Object.assign({},e),{alternativePreviewerUrl:t.url});case"CLOSE_ALTERNATIVE_PREVIEWER":return Object.assign(Object.assign({},e),{alternativePreviewerUrl:""});case"SHOW_AI_ALTERNATIVE_MODAL":return Object.assign(Object.assign({},e),{aiAlternativeModal:t.alternativeId});case"SETUP_EDITOR":return e}}(e=Object.assign(Object.assign({},e),{hasExperimentBeenRecentlySaved:!1}),t))&&void 0!==n?n:e},experiment:(0,l.combineReducers)({alternatives:function(e=_,t){var n;return null!==(n=function(e,t){switch(t.type){case"ADD_ALTERNATIVES":{const n=t.alternatives.filter(t=>!(0,g.isEqual)(e.byId[t.id],t));return n.length?{byId:Object.assign(Object.assign({},e.byId),(0,g.keyBy)(n,"id")),allIds:[...e.allIds,...(0,g.map)(n,"id")]}:e}case"REMOVE_ALTERNATIVES":{const n=Object.assign({control:e.byId.control},(0,g.omit)(e.byId,t.ids)),i=(0,g.difference)(e.allIds,t.ids.filter(e=>"control"!==e));return(0,g.isEqual)(e.byId,n)&&(0,g.isEqual)(e.allIds,i)?e:{byId:n,allIds:i}}case"REPLACE_ALTERNATIVES":{const n=(0,g.zip)(t.oldIds,(0,g.map)(t.alternatives,"id")),i=Object.assign(Object.assign({control:e.byId.control},(0,g.omit)(e.byId,t.oldIds)),(0,g.keyBy)(t.alternatives,"id")),s=[...e.allIds.map(e=>{const t=n.find(t=>t[0]===e);return t?t[1]:e}).filter(b.isDefined),...n.filter(e=>!e[0]).map(e=>e[1]).filter(b.isDefined)],a=e.byId,r=i,o=Object.values(a).map(e=>(0,g.omit)(e,"id")),l=Object.values(r).map(e=>(0,g.omit)(e,"id"));return(0,g.isEqual)(o,l)?e:{byId:i,allIds:s}}case"SET_ALTERNATIVE":const n=e.byId[t.id];if(!n)return e;const i=t.alternative;return i?(0,g.isEqual)(n,i)?e:Object.assign(Object.assign({},e),{byId:Object.assign(Object.assign({},e.byId),{[t.id]:i})}):e;case"SETUP_EDITOR":{if("nab/heatmap"===t.experiment.type)return _;const n={byId:Object.assign({control:e.byId.control},(0,g.keyBy)(t.experiment.alternatives,"id")),allIds:(0,g.map)(t.experiment.alternatives,"id")};return(0,g.isEqual)(e,n)?e:n}}}(e,t))&&void 0!==n?n:e},conversionActions:function(e=y,t){var n;return null!==(n=function(e,t){var n;switch(t.type){case"ADD_CONVERSION_ACTIONS_INTO_GOAL":{const n=t.conversionActions.filter(n=>{var i;return!(0,g.isEqual)(null===(i=e[t.goalId])||void 0===i?void 0:i[n.id],n)});return n.length?Object.assign(Object.assign({},e),{[t.goalId]:Object.assign(Object.assign({},e[t.goalId]),(0,g.keyBy)(n,"id"))}):e}case"REPLACE_CONVERSION_ACTIONS_IN_GOAL":{const i=null!==(n=e[t.goalId])&&void 0!==n?n:{},s=(0,g.keyBy)(t.conversionActions,"id"),a=Object.values(i).map(e=>(0,g.omit)(e,"id")),r=Object.values(s).map(e=>(0,g.omit)(e,"id"));return(0,g.isEqual)(a,r)?e:Object.assign(Object.assign({},e),{[t.goalId]:s})}case"UPDATE_CONVERSION_ACTION":{const n=e[t.goalId];if(!n)return e;const i=n[t.conversionActionId];if(!i)return e;const s=Object.assign(Object.assign({},i),{attributes:t.attributes?Object.assign(Object.assign({},i.attributes),t.attributes):i.attributes,scope:t.scope?t.scope:i.scope});return(0,g.isEqual)(i,s)?e:Object.assign(Object.assign({},e),{[t.goalId]:Object.assign(Object.assign({},n),{[t.conversionActionId]:s})})}case"REMOVE_CONVERSION_ACTIONS_FROM_GOAL":{const n=(0,g.omit)(e[t.goalId],t.conversionActionIds);return(0,g.isEqual)(e[t.goalId],n)?e:Object.assign(Object.assign({},e),{[t.goalId]:n})}case"SETUP_EDITOR":{if("nab/heatmap"===t.experiment.type)return b.EMPTY_OBJECT;const n=t.experiment.goals.reduce((e,t)=>(e[t.id]=(0,g.keyBy)(t.conversionActions,"id"),e),{});return(0,g.isEqual)(e,n)?e:n}}}(e,t))&&void 0!==n?n:e},data:function(e=f,t){var n;return null!==(n=function(e,t){switch(t.type){case"UPDATE_EXPERIMENT_DATA":{const n=Object.assign(Object.assign({},e),t.attributes);return(0,g.isEqual)(e,n)?e:n}case"SET_TESTED_ELEMENT_AS_INVALID":return Object.assign(Object.assign({},e),{isTestedElementInvalid:!!t.invalid});case"SETUP_EDITOR":{const n=Object.assign(Object.assign({},e),(0,g.omit)(t.experiment,["alternatives","goals","scope","segments"]));return(0,g.isEqual)(e,n)?e:n}}}(e,t))&&void 0!==n?n:e},goals:function(e=j,t){var n;return null!==(n=function(e,t){switch(t.type){case"ADD_GOALS":{const n=t.goals.filter(t=>!(0,g.isEqual)(e[t.id],t));return n.length?Object.assign(Object.assign({},e),(0,g.keyBy)(n,"id")):e}case"UPDATE_GOAL":{const n=e[t.goalId];if(!n)return e;const i=Object.assign(Object.assign({},n),{attributes:Object.assign(Object.assign({},n.attributes),t.attributes)});return(0,g.isEqual)(n,i)?e:Object.assign(Object.assign({},e),{[t.goalId]:i})}case"REMOVE_GOALS":return(0,g.omit)(e,t.ids);case"SETUP_EDITOR":if("nab/heatmap"===t.experiment.type)return b.EMPTY_OBJECT;const n=(0,g.keyBy)(t.experiment.goals.map(e=>(0,g.omit)(e,"conversionActions")),"id");return(0,g.isEqual)(e,n)?e:n}}(e,t))&&void 0!==n?n:e},scope:function(e=E,t){var n;return null!==(n=function(e,t){switch(t.type){case"SET_SCOPE_RULES":{const n=t.rules.map(t=>e[t.id]&&(0,g.isEqual)(e[t.id],t)?e[t.id]:t);return(0,g.keyBy)(n,"id")}case"SETUP_EDITOR":{if("nab/heatmap"===t.experiment.type)return b.EMPTY_OBJECT;const n=(0,g.keyBy)(t.experiment.scope,"id");return(0,g.isEqual)(n,e)?e:n}}}(e,t))&&void 0!==n?n:e},segmentation:function(e=A,t){var n;return null!==(n=function(e,t){var n;switch(t.type){case"ADD_SEGMENTS":{const n=t.segments.filter(t=>!(0,g.isEqual)(e.segments[t.id],t));return n.length?Object.assign(Object.assign({},e),{segments:Object.assign(Object.assign({},e.segments),(0,g.keyBy)(n,"id"))}):e}case"UPDATE_SEGMENT":{const n=e.segments[t.segmentId];if(!n)return e;const i=Object.assign(Object.assign({},n),{attributes:Object.assign(Object.assign({},n.attributes),t.attributes)});return(0,g.isEqual)(i,n)?e:Object.assign(Object.assign({},e),{segments:Object.assign(Object.assign({},e.segments),{[t.segmentId]:i})})}case"REMOVE_SEGMENTS":{const n=(0,g.omit)(e.segments,t.ids);return(0,g.isEqual)(e.segments,n)?e:Object.assign(Object.assign({},e),{segments:n})}case"ADD_SEGMENTATION_RULES_INTO_SEGMENT":{const n=e.rules[t.segmentId],i=t.segmentationRules.filter(e=>!(0,g.isEqual)(null==n?void 0:n[e.id],e));return i.length?Object.assign(Object.assign({},e),{rules:Object.assign(Object.assign({},e.rules),{[t.segmentId]:Object.assign(Object.assign({},n),(0,g.keyBy)(i,"id"))})}):e}case"REPLACE_SEGMENTATION_RULES_IN_SEGMENT":{const i=null!==(n=e.rules[t.segmentId])&&void 0!==n?n:{},s=(0,g.keyBy)(t.segmentationRules,"id"),a=Object.values(i).map(e=>(0,g.omit)(e,"id")),r=Object.values(s).map(e=>(0,g.omit)(e,"id"));return(0,g.isEqual)(a,r)?e:Object.assign(Object.assign({},e),{rules:Object.assign(Object.assign({},e.rules),{[t.segmentId]:s})})}case"UPDATE_SEGMENTATION_RULE":{const n=e.rules[t.segmentId];if(!n)return e;const i=n[t.segmentationRuleId];if(!i)return e;const s=Object.assign(Object.assign({},i),{attributes:Object.assign(Object.assign({},i.attributes),t.attributes)});return(0,g.isEqual)(i,s)?e:Object.assign(Object.assign({},e),{rules:Object.assign(Object.assign({},e.rules),{[t.segmentId]:Object.assign(Object.assign({},n),{[t.segmentationRuleId]:s})})})}case"REMOVE_SEGMENTATION_RULES_FROM_SEGMENT":{const n=e.rules[t.segmentId];if(!n)return e;const i=(0,g.omit)(n,t.segmentationRuleIds);return(0,g.isEqual)(n,i)?e:Object.assign(Object.assign({},e),{rules:Object.assign(Object.assign({},e.rules),{[t.segmentId]:i})})}case"SET_SEGMENT_EVALUATION":return Object.assign(Object.assign({},e),{evaluation:t.strategy});case"SETUP_EDITOR":{if("nab/heatmap"===t.experiment.type)return e;const n={evaluation:t.experiment.segmentEvaluation,rules:t.experiment.segments.reduce((e,t)=>(e[t.id]=(0,g.keyBy)(t.segmentationRules,"id"),e),{}),segments:(0,g.keyBy)(t.experiment.segments.map(e=>(0,g.omit)(e,"segmentationRules")),"id")};return(0,g.isEqual)(e,n)?e:n}}}(e,t))&&void 0!==n?n:e}})}),w=function(e,t){return e.experiment.alternatives.byId[t]},O=(0,l.createSelector)(e=>(0,g.values)(e.experiment.alternatives.byId).filter(b.isDefined),e=>[e.experiment.alternatives.byId]),N=e=>e.experiment.alternatives.allIds,I=(0,b.createIndexedSelector)((e,t)=>(0,g.values)(e.experiment.conversionActions[t]),(e,t)=>({key:t,dependants:[e.experiment.conversionActions[t]]}));function T(e){return!!e.editor.isExperimentBeingSaved}function R(e){return!!e.editor.hasExperimentBeenRecentlySaved}function C(e){return e.experiment.goals[e.editor.activeGoalId]||(0,g.values)(e.experiment.goals)[0]}function D(e){return(0,g.map)(e.experiment.goals,"id").indexOf(e.editor.activeGoalId)||0}function P(e){return(0,g.filter)(e.experiment.segmentation.segments,{id:e.editor.activeSegmentId})[0]}function k(e){return(0,g.map)(e.experiment.segmentation.segments,"id").indexOf(e.editor.activeSegmentId)||0}function M(e){if(e.experiment&&e.experiment.data)return["draft","paused_draft"].includes(e.experiment.data.status)?e.editor.draftStatusRationale:void 0}function B(e){return e.editor.alternativePreviewerUrl}function G(e){return e.editor.aiAlternativeModal}function V(e){return e.experiment.data.id}function L(e){return e.experiment.data.type}const q=function(e,t){return e.experiment.data[t]},U=function(e,t){return e.experiment.data[t]};function F(e){return!!e.experiment.data.isTestedElementInvalid}const H=(0,l.createSelector)(e=>(0,g.values)(e.experiment.goals).filter(b.isDefined),e=>[e.experiment.goals]),Y=(0,l.createSelector)(e=>(0,g.values)(e.experiment.scope).filter(b.isDefined),e=>[e.experiment.scope]),W=(0,l.createSelector)(e=>(0,g.values)(e.experiment.segmentation.segments).filter(b.isDefined),e=>[e.experiment.segmentation.segments]),$=(0,b.createIndexedSelector)((e,t)=>(0,g.values)(e.experiment.segmentation.rules[t]),(e,t)=>({key:t,dependants:[e.experiment.segmentation.rules[t]]}));function z(e){return e.experiment.segmentation.evaluation}function X(e){return{type:"ADD_ALTERNATIVES",alternatives:(0,g.castArray)(e)}}function J(e){return{type:"REMOVE_ALTERNATIVES",ids:(0,g.castArray)(e)}}function Q(e,t){return{type:"REPLACE_ALTERNATIVES",oldIds:(0,g.castArray)(e),alternatives:(0,g.castArray)(t)}}function K(e,t){return{type:"SET_ALTERNATIVE",id:e,alternative:t}}function Z(e,t){return{type:"ADD_CONVERSION_ACTIONS_INTO_GOAL",goalId:e,conversionActions:(0,g.castArray)(t)}}function ee(e,t){return{type:"REPLACE_CONVERSION_ACTIONS_IN_GOAL",goalId:e,conversionActions:(0,g.castArray)(t)}}function te(e,t){return{type:"REMOVE_CONVERSION_ACTIONS_FROM_GOAL",goalId:e,conversionActionIds:(0,g.castArray)(t)}}function ne(e,t,n,i){return{type:"UPDATE_CONVERSION_ACTION",goalId:e,conversionActionId:t,attributes:n,scope:i}}function ie(e){return{type:"SETUP_EDITOR",experiment:e}}function se(e){return{type:"SET_ACTIVE_GOAL",goalId:e}}function ae(e){return{type:"SET_ACTIVE_SEGMENT",segmentId:e}}function re(e){return{type:"SET_EXPERIMENT_AS_BEING_SAVED",status:e}}function oe(e){return{type:"SET_DRAFT_STATUS_RATIONALE",rationale:e}}function le(){return{type:"SET_EXPERIMENT_AS_RECENTLY_SAVED"}}function ce(e){return{type:"OPEN_ALTERNATIVE_PREVIEWER",url:e}}function ue(){return{type:"CLOSE_ALTERNATIVE_PREVIEWER"}}function de(e){return{type:"SHOW_AI_ALTERNATIVE_MODAL",alternativeId:e}}function pe(e){return{type:"UPDATE_EXPERIMENT_DATA",attributes:e}}function ge(e){return{type:"UPDATE_EXPERIMENT_DATA",attributes:e}}function me(e){return{type:"SET_TESTED_ELEMENT_AS_INVALID",invalid:e}}function ve(e){return{type:"ADD_GOALS",goals:(0,g.castArray)(e)}}function be(e){return{type:"REMOVE_GOALS",ids:(0,g.castArray)(e)}}function xe(e,t){return{type:"UPDATE_GOAL",goalId:e,attributes:t}}function he(e){return{type:"SET_SCOPE_RULES",rules:e}}function _e(e){return{type:"ADD_SEGMENTS",segments:(0,g.castArray)(e)}}function ye(e){return{type:"REMOVE_SEGMENTS",ids:(0,g.castArray)(e)}}function fe(e,t){return{type:"UPDATE_SEGMENT",segmentId:e,attributes:t}}function je(e,t){return{type:"ADD_SEGMENTATION_RULES_INTO_SEGMENT",segmentId:e,segmentationRules:(0,g.castArray)(t)}}function Ee(e,t){return{type:"REPLACE_SEGMENTATION_RULES_IN_SEGMENT",segmentId:e,segmentationRules:(0,g.castArray)(t)}}function Ae(e,t){return{type:"REMOVE_SEGMENTATION_RULES_FROM_SEGMENT",segmentId:e,segmentationRuleIds:(0,g.castArray)(t)}}function Se(e,t,n){return{type:"UPDATE_SEGMENTATION_RULE",segmentId:e,segmentationRuleId:t,attributes:n}}function we(e){return{type:"SET_SEGMENT_EVALUATION",strategy:e}}const Oe=window.wp.apiFetch;var Ne=n.n(Oe);const Ie=window.wp.date,Te=window.wp.url,Re=e=>{const{url:t,path:n}=e,i=(0,Ie.format)("YmjHi").substring(0,11)+"0";return Ne()(Object.assign(Object.assign(Object.assign(Object.assign({},e),t&&{url:Ce(e)?(0,Te.addQueryArgs)(t,{nabts:i}):t}),n&&{path:(0,Te.addQueryArgs)(n,{nabts:i})}),{parse:!0}))},Ce=e=>{var t,n;return!!(null===(t=e.url)||void 0===t?void 0:t.includes("/wp-json/"))||!!(null===(n=e.url)||void 0===n?void 0:n.includes("rest_route"))||!!Object.keys(e).includes("rest_route")},De=window.wp.i18n,Pe=window.wp.notices,ke=window.nab.experiments;var Me=function(e,t,n,i){return new(n||(n=Promise))(function(s,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,o)}l((i=i.apply(e,t||[])).next())})};function Be(){return Me(this,void 0,void 0,function*(){var e,t,n,i,s,a;if((0,l.select)(ze).isExperimentBeingSaved())return;yield(0,l.dispatch)(ze).setExperimentAsBeingSaved(!0);const r=[],o=(0,l.select)(ze).getGoals();for(const t of o){const n=(0,l.select)(ze).getConversionActions(t.id),i=He(n);r.push(Object.assign(Object.assign({},t),{attributes:Object.assign(Object.assign({},t.attributes),{useOrderRevenue:i?null===(e=t.attributes.useOrderRevenue)||void 0===e||e:void 0,orderStatusForConversion:i?Ye(i,t):void 0}),conversionActions:n}))}const c=[],u=(0,l.select)(ze).getSegments();for(const e of u)c.push(Object.assign(Object.assign({},e),{segmentationRules:(0,l.select)(ze).getSegmentationRules(e.id)}));const d=[],p=(0,l.select)(ze).getAlternativeIds(),g=(0,l.select)(ze).isTestedElementInvalid(),m=(0,l.select)(ze).getAlternative("control");for(const e of p){if("control"===e)continue;const t=(0,l.select)(ze).getAlternative(e);t&&d.push(t)}let v;const b=(0,l.select)(ze).getExperimentType();v="nab/heatmap"===b?{id:(0,l.select)(ze).getExperimentId(),type:b,name:(0,l.select)(ze).getExperimentAttribute("name"),description:(0,l.select)(ze).getExperimentAttribute("description"),status:(0,l.select)(ze).getExperimentAttribute("status"),startDate:(0,l.select)(ze).getExperimentAttribute("startDate"),endDate:!1,endMode:(0,l.select)(ze).getExperimentAttribute("endMode"),endValue:(0,l.select)(ze).getExperimentAttribute("endValue"),trackingMode:null!==(t=(0,l.select)(ze).getHeatmapAttribute("trackingMode"))&&void 0!==t?t:"post",trackedPostId:null!==(n=(0,l.select)(ze).getHeatmapAttribute("trackedPostId"))&&void 0!==n?n:0,trackedPostType:null!==(i=(0,l.select)(ze).getHeatmapAttribute("trackedPostType"))&&void 0!==i?i:"page",trackedUrl:null!==(s=(0,l.select)(ze).getHeatmapAttribute("trackedUrl"))&&void 0!==s?s:"",participationConditions:null!==(a=(0,l.select)(ze).getHeatmapAttribute("participationConditions"))&&void 0!==a?a:[]}:{id:(0,l.select)(ze).getExperimentId(),type:b,name:(0,l.select)(ze).getExperimentAttribute("name"),description:(0,l.select)(ze).getExperimentAttribute("description"),status:(0,l.select)(ze).getExperimentAttribute("status"),startDate:(0,l.select)(ze).getExperimentAttribute("startDate"),endDate:!1,endMode:(0,l.select)(ze).getExperimentAttribute("endMode"),endValue:(0,l.select)(ze).getExperimentAttribute("endValue"),autoAlternativeApplication:(0,l.select)(ze).getExperimentAttribute("autoAlternativeApplication"),scope:(0,l.select)(ze).getScope(),alternatives:g?[m]:[m,...d],goals:r,segmentEvaluation:(0,l.select)(ze).getSegmentEvaluation(),segments:c};try{let e=yield Re({path:`/nab/v1/experiment/${v.id}`,method:"PUT",data:v});"nab/heatmap"!==v.type&&g&&(e=Object.assign(Object.assign({},e),{alternatives:[e.alternatives[0],...d]})),yield(0,l.dispatch)(ze).setupEditor(e),yield(0,l.dispatch)(ze).setExperimentAsBeingSaved(!1),yield(0,l.dispatch)(ze).setExperimentAsRecentlySaved()}catch(e){const t=We(e);yield(0,l.dispatch)(Pe.store).createErrorNotice(t),yield(0,l.dispatch)(ze).setExperimentAsBeingSaved(!1)}})}function Ge(e){return Me(this,void 0,void 0,function*(){if(yield Be(),!(0,l.select)(ze).hasExperimentBeenRecentlySaved())return;if(!(0,l.select)(ze).getAlternativeIds().includes(e))return;const t=(0,l.select)(ze).getAlternative(e);t&&t.links.edit&&(window.location.href=t.links.edit)})}function Ve(e){return Me(this,void 0,void 0,function*(){if(yield Be(),!(0,l.select)(ze).hasExperimentBeenRecentlySaved())return;if(!(0,l.select)(ze).getAlternativeIds().includes(e))return;const t=(0,l.select)(ze).getAlternative(e);if(!(null==t?void 0:t.links.preview)){let e=(0,De._x)("Preview not available.","text","nelio-ab-testing");const t=(0,l.select)(ze).getExperimentType(),n=(0,l.select)(ke.store).getExperimentSupport(t,"scope");return"urls"!==n&&"urls-with-tested-post"!==n||(e+=" ",e+=(0,De._x)("Please review your test scope and consider adding an exact URL where the test should be active so that Nelio can use it in the preview.","user","nelio-ab-testing")),void(yield(0,l.dispatch)(Pe.store).createWarningNotice(e))}yield(0,l.dispatch)(ze).openAlternativePreviewer(t.links.preview)})}function Le(){return Me(this,void 0,void 0,function*(){yield(0,l.dispatch)(ze).setExperimentData({status:"trash"}),yield Be(),window.location.href=(0,l.select)(m.store).getAdminUrl("edit.php",{post_type:"nab_experiment"})})}function qe(){return Me(this,void 0,void 0,function*(){yield Fe("start")})}function Ue(){return Me(this,void 0,void 0,function*(){yield Fe("resume")})}function Fe(e){return Me(this,arguments,void 0,function*(e,t=!1){if(yield Be(),!(0,l.select)(ze).hasExperimentBeenRecentlySaved())return;yield(0,l.dispatch)(ze).setExperimentAsBeingSaved(!0);const n=(0,l.select)(ze).getExperimentId();try{yield Re({path:`/nab/v1/experiment/${n}/${e}`,method:"PUT",data:{ignoreScopeOverlap:t}})}catch(t){const n=We(t,"start"===e?(0,De._x)("Test can’t be started","text","nelio-ab-testing"):(0,De._x)("Test can’t be resumed","text","nelio-ab-testing"));if("equivalent-experiment-running"===function(e){if(!e||"object"!=typeof e)return!1;if("code"in e&&"equivalent-experiment-running"===e.code)return"equivalent-experiment-running";if(!("errors"in e)||"object"!=typeof e.errors)return!1;const t=e.errors||{};return Object.keys(t).includes("equivalent-experiment-running")&&"equivalent-experiment-running"}(t)){const{notice:t}=yield(0,l.dispatch)(Pe.store).createWarningNotice(n,{actions:[{label:"start"===e?(0,De._x)("Start anyway","command","nelio-ab-testing"):(0,De._x)("Resume anyway","command","nelio-ab-testing"),variant:"primary",onClick:()=>Me(this,void 0,void 0,function*(){yield(0,l.dispatch)(Pe.store).removeNotice(t.id),yield Fe(e,!0)})}]})}else yield(0,l.dispatch)(Pe.store).createErrorNotice(n);return void(yield(0,l.dispatch)(ze).setExperimentAsBeingSaved(!1))}window.location.href=(0,l.select)(m.store).getAdminUrl("admin.php",{page:"nelio-ab-testing-experiment-view",experiment:n})})}function He(e){if(e.length)return e.every(({type:e})=>"nab/wc-order"===e)?"woocommerce":e.every(({type:e})=>"nab/edd-order"===e)?"edd":void 0}function Ye(e,t){const n=(0,l.select)(m.store).getECommerceSetting(e,"orderStatuses"),i=t.attributes.orderStatusForConversion;return i&&n.map(e=>e.value).includes(i)?i:function(e){switch(e){case"woocommerce":return"wc-completed";case"edd":return"complete"}}(e)}function We(e,t){const n=t||(0,De._x)("Unknown error","text","nelio-ab-testing");if(!e||"object"!=typeof e)return n;if("errors"in e&&"object"==typeof e.errors){const t=Array.isArray(e.errors)?e.errors:(0,g.values)(e.errors);if("string"==typeof t[0])return t[0]||n;const i=Array.isArray(t[0])&&"string"==typeof t[0][0]?t[0][0]:void 0;if(i)return i||n}return"message"in e&&"string"==typeof e.message&&e.message||n}const $e=Object.assign(Object.assign({},s),a),ze=(0,l.createReduxStore)("nab/editor",{reducer:S,controls:l.controls,actions:$e,selectors:i});!function(e){(0,l.register)(e)}(ze);const Xe=({experiment:e,children:t})=>{const[n,i]=(0,p.useState)(!1),{setupEditor:s,setActiveGoal:a,setActiveSegment:r}=(0,l.useDispatch)(ze);return(0,p.useEffect)(()=>{if(n)return;if(!e)return;const t=e.goals[0]||(0,b.createGoal)(),o=e.segments[0];s(e),a(t.id),o&&r(o.id),i(!0)},[e,n,s,a,r]),n?(0,o.jsx)("div",{children:t}):null},Je=window.wp.components,Qe=(Object.assign(e=>(0,o.jsx)(Je.BaseControl,Object.assign({__nextHasNoMarginBottom:!0},e)),Je.BaseControl),Object.assign(e=>(0,o.jsx)(Je.CheckboxControl,Object.assign({__nextHasNoMarginBottom:!0},e)),Je.CheckboxControl)),Ke=(Object.assign(e=>(0,o.jsx)(Je.FormTokenField,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),Je.FormTokenField),Object.assign(e=>(0,o.jsx)(Je.RangeControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),Je.RangeControl),e=>(0,o.jsx)(Je.SelectControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e))),Ze=Object.assign(e=>(0,o.jsx)(Je.TextControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),Je.TextControl),et=Object.assign(e=>(0,o.jsx)(Je.TextareaControl,Object.assign({__nextHasNoMarginBottom:!0},e)),Je.TextareaControl),tt=(Object.assign(e=>(0,o.jsx)(Je.ToggleControl,Object.assign({__nextHasNoMarginBottom:!0},e)),Je.ToggleControl),Object.assign(e=>(0,o.jsx)(Je.__experimentalToggleGroupControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),Je.__experimentalToggleGroupControl),window.nab.conversionActions),nt=window.nab.date,it=window.nab.segmentationRules;function st(e,t,n){var i;if(!e.conversionActions.length)return(0,De.sprintf)(/* translators: %s: Goal name. */ /* translators: %s: Goal name. */
(0,De._x)("%s doesn’t have any conversion actions","text","nelio-ab-testing"),at(e,t));for(let s=0;s<e.conversionActions.length;++s){const a=e.conversionActions[s];if(!a)continue;const r=n[a.type];if(!r)return(0,De.sprintf)(/* translators: %s: Goal name. */ /* translators: %s: Goal name. */
(0,De._x)("%s has one or more invalid conversion actions","text","nelio-ab-testing"),at(e,t));if(!(0,b.isEmpty)(null===(i=r.validate)||void 0===i?void 0:i.call(r,a.attributes))||!(0,b.isEmpty)((0,b.getConversionActionScopeError)(a.scope)))return(0,De.sprintf)(/* translators: %s: Goal name, as in “Goal 2” or “Default Goal”. */ /* translators: %s: Goal name, as in “Goal 2” or “Default Goal”. */
(0,De._x)("One or more conversion actions in %s are invalid","text","nelio-ab-testing"),at(e,t))}return!1}function at(e,t){let n=(0,De.sprintf)(/* translators: %d: Goal id. */ /* translators: %d: Goal id. */
(0,De._x)("Goal %d","text","nelio-ab-testing"),t+1);return 0===t&&(n=(0,De._x)("Default Goal","text","nelio-ab-testing")),(0,g.trim)(e.attributes.name)&&(n=(0,De.sprintf)(/* translators: %s: Goal name. */ /* translators: %s: Goal name. */
(0,De._x)("Goal “%s”","text","nelio-ab-testing"),(0,g.trim)(e.attributes.name))),n}function rt(e,t,n){var i;if(!e.segmentationRules.length)return(0,De.sprintf)(/* translators: %s: Segment name. */ /* translators: %s: Segment name. */
(0,De._x)("%s doesn’t have any segmentation rules","text","nelio-ab-testing"),ot(e,t));for(let s=0;s<e.segmentationRules.length;++s){const a=e.segmentationRules[s];if(!a)continue;const r=n[a.type];if(!r)return(0,De.sprintf)(/* translators: %s: Segment name. */ /* translators: %s: Segment name. */
(0,De._x)("%s has one or more invalid segmentation rules","text","nelio-ab-testing"),ot(e,t));if(!(0,b.isEmpty)(null===(i=r.validate)||void 0===i?void 0:i.call(r,a.attributes)))return(0,De.sprintf)(/* translators: %s: Segment name, as in Segment 2”. */ /* translators: %s: Segment name, as in Segment 2”. */
(0,De._x)("One or more segmentation rules in %s are invalid","text","nelio-ab-testing"),ot(e,t))}return!1}function ot(e,t){let n=(0,De.sprintf)(/* translators: %d: Segment id. */ /* translators: %d: Segment id. */
(0,De._x)("Segment %d","text","nelio-ab-testing"),t+1);return(0,g.trim)(e.attributes.name)&&(n=(0,De.sprintf)(/* translators: %s: Segment name. */ /* translators: %s: Segment name. */
(0,De._x)("Segment “%s”","text","nelio-ab-testing"),(0,g.trim)(e.attributes.name))),n}const lt=e=>"php-snippet"===(null==e?void 0:e.attributes.type);function ct(e){const t=c(t=>t(ze).getExperimentAttribute(e),[e]),{setExperimentData:n}=(0,l.useDispatch)(ze);return[t,t=>{n({[e]:t})}]}function ut(){const e=ct("type")[0];return c(t=>t(ke.store).getExperimentType(e),[e])}const dt=e=>c(t=>t(m.store).isSubscribedTo(e),[e]),pt=()=>{const e=(0,m.usePluginSetting)("maxCombinations"),t=c(e=>e(ze).getAlternativeIds().length,[]);return!gt()&&t<e},gt=()=>{const[e]=ct("status");return e.includes("paused")},mt=()=>(vt(),bt(),null),vt=()=>{const e=ct("startDate")[0]||"",[t,n]=ct("status"),i=c(e=>e(ze).getDraftStatusRationale(),[]),{setDraftStatusRationale:s}=(0,l.useDispatch)(ze),a=(0,p.useCallback)((e,a)=>{t.includes("paused")&&(e="draft"===e?"paused_draft":"paused"),a=null!=a?a:"",t===e&&i===a||(n(e),s(a))},[i,t,n,s]),r=xt();(0,p.useEffect)(()=>{"running"!==t&&"trash"!==t&&(r?a("draft",r):"ready"!==t&&("scheduled"!==t||(0,nt.isInTheFuture)(e)||a("ready"),"scheduled"!==t&&a("ready")))},[r,e,t,a])},bt=()=>{const[e]=ct("status"),t=ht(),n=ut(),i=(0,g.find)(t,{id:"control"}),s=c(t=>"running"!==e&&!!i&&!!n&&!!n.checks.getControlError(i.attributes,t),[i,e,n]),{setTestedElementAsInvalid:a}=(0,l.useDispatch)(ze);(0,p.useEffect)(()=>{a(s)},[s,a])},xt=()=>{const e=ct("name")[0]||"",t=ut(),n=ht(),i=_t(),s=yt(),a=ft(),r=jt(),o=Et(),c=(0,g.find)(n,{id:"control"});return(t?function(e,t,n){const{control:i,alternatives:s,goals:a,scope:r,segments:o,name:c,type:u}=e;if(!c)return(0,De._x)("Test is unnamed","text","nelio-ab-testing");if(s.length<2)return(0,De._x)("Test doesn’t have any variants","text","nelio-ab-testing");const d=u.checks.getControlError(i.attributes,l.select);if(d)return d;const[p,...m]=s,v=m.reduce((e,t,n)=>e||u.checks.getAlternativeError(t.attributes,(0,b.getLetter)(n+1),i.attributes,l.select),!1);if(v)return v;const x=m.reduce((e,t,n)=>e||!t.ai||t.ai.isReady?e:(0,De.sprintf)(/* translators: %1$s: Nelio AI. %2$s: Variant letter. */ /* translators: %1$s: Nelio AI. %2$s: Variant letter. */
(0,De._x)("%1$s Variant %2$s has pending changes that need to be applied","text","nelio-ab-testing"),"Nelio AI",(0,b.getLetter)(n+1)),!1);if(x)return x;const h=function(e){var t;const[n]=e;if(lt(n))return!!n.attributes.value.errorMessage&&(0,De._x)("Test scope is incorrect","text","nelio-ab-testing");const i=e.filter(e=>"tested-url-with-query-args"===e.attributes.type);for(const e of i){const n=null===(t=(0,g.toPairs)((0,g.countBy)(e.attributes.value.args,"name")).find(([e,t])=>!!e&&t>=2))||void 0===t?void 0:t[0];if(n)return(0,De.sprintf)(/* translators: %s: Query parameter’s name. */ /* translators: %s: Query parameter’s name. */
(0,De._x)("Query parameter “%s” should only appear once in the test scope","text","nelio-ab-testing"),n)}return!1}(r);if(h)return h;const _=function(e,t){if(!e.length)return(0,De._x)("Test doesn’t have any goals","text","nelio-ab-testing");for(let n=0;n<e.length;++n){const i=e[n];if(!i)continue;const s=st(i,n,t);if(s)return s}return!1}(a,t);if(_)return _;const y=function(e,t){for(let n=0;n<e.length;++n){const i=e[n];if(!i)continue;const s=rt(i,n,t);if(s)return s}return!1}(o,n);return y||!1}({name:e,control:c,alternatives:n,scope:a,goals:i,segments:s,type:t},r,o):(0,De._x)("Type not found","text","nelio-ab-testing"))||""},ht=()=>c(e=>e(ze).getAlternatives(),[]),_t=()=>{const e=c(e=>e(ze).getGoals(),[]),t=c(t=>e.reduce((e,n)=>Object.assign(Object.assign({},e),{[n.id]:t(ze).getConversionActions(n.id)}),{}),[e]);return e.map(e=>{var n;return Object.assign(Object.assign({},e),{conversionActions:null!==(n=t[e.id])&&void 0!==n?n:b.EMPTY_ARRAY})})},yt=()=>{const e=c(e=>e(ze).getSegments(),[]),t=c(t=>e.reduce((e,n)=>Object.assign(Object.assign({},e),{[n.id]:t(ze).getSegmentationRules(n.id)}),{}),[e]);return e.map(e=>{var n;return Object.assign(Object.assign({},e),{segmentationRules:null!==(n=t[e.id])&&void 0!==n?n:b.EMPTY_ARRAY})})},ft=()=>c(e=>e(ze).getScope(),[]),jt=()=>c(e=>(0,g.keyBy)(e(tt.store).getConversionActionTypes()||[],"name"),[]),Et=()=>c(e=>(0,g.keyBy)(e(it.store).getSegmentationRuleTypes()||[],"name"),[]),At=window.nab.components,St=()=>{var e,t;const n=c(e=>{const t=e(ze).getExperimentType();return{type:e(ke.store).getExperimentType(t),subscriptionPlan:e(m.store).getPluginSetting("subscription")}},[]),i=null!==(t=null===(e=n.type)||void 0===e?void 0:e.name)&&void 0!==t?t:"unknown";return(0,o.jsx)(At.ContextualHelpButton,{placement:"bottom-start",screen:`experiment-list:${i}`,questions:wt,walkthrough:Ot(n)})},wt=[{label:(0,De._x)("What is the original page or post of a test?","text","nelio-ab-testing"),link:"https://neliosoftware.com/testing/help/what-is-the-original-page-or-post-of-a-test/"},{label:(0,De._x)("Why don’t all my posts/pages appear in the selection list when I’m creating a new test?","text","nelio-ab-testing"),link:"https://neliosoftware.com/testing/help/why-dont-all-my-posts-appear-in-the-selection-list/"},{label:(0,De._x)("What is a conversion and what counts as one?","text","nelio-ab-testing"),link:"https://neliosoftware.com/testing/help/what-is-a-conversion/"},{label:(0,De._x)("How can I track conversions occurring in third-party websites?","text","nelio-ab-testing"),link:"https://neliosoftware.com/testing/help/how-can-i-track-conversions-occurring-in-third-party-websites/"}];function Ot(e){var t,n,i,s;const{type:a,subscriptionPlan:r}=e,o=(e,t)=>"exactly"===t?(0,b.isPlan)(r,"exactly",e):(0,b.isPlan)(r,"exactly-or-above",e);return[{title:(0,De._x)("Test Editor","text","nelio-ab-testing"),intro:(0,De._x)("Welcome to the Test Editor. Here you’ll be able to select the element you want to test and create one or more variants to find out which one converts the most. As you can see, it’s quite similar to WordPress’ Block Editor: there’s a header, a sidebar, and a main area.","user","nelio-ab-testing")},{title:(0,De._x)("Name","text","nelio-ab-testing"),intro:(0,De._x)("You’ll notice that all test types have a similar user interface. When creating a new test, you’ll first have to name it. Just type in a descriptive name that helps you identify the test in the future.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-experiment-title")},{title:(0,De._x)("Variants","text","nelio-ab-testing"),intro:(0,De._x)("Next, there’s a “Control Version and Variants” section. Use it to (a) identify the element you want to test and (b) create one or more split testing variants.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-edit-experiment__alternative-section")},{title:(0,De._x)("Variant A","text","nelio-ab-testing"),intro:null!==(n=null===(t=null==a?void 0:a.help)||void 0===t?void 0:t.original)&&void 0!==n?n:"",element:()=>document.querySelector(".nab-alternative-list__alternative--original"),active:()=>{var e;return!!(null===(e=null==a?void 0:a.help)||void 0===e?void 0:e.original)}},{title:(0,De._x)("Variant B","text","nelio-ab-testing"),intro:null!==(s=null===(i=null==a?void 0:a.help)||void 0===i?void 0:i.alternative)&&void 0!==s?s:"",element:()=>document.querySelector(".nab-alternative-list__alternative:not(.nab-alternative-list__alternative--original)"),active:()=>{var e;return!!(null===(e=null==a?void 0:a.help)||void 0===e?void 0:e.alternative)&&!!document.querySelector(".nab-alternative-list__alternative:not(.nab-alternative-list__alternative--original)")}},{title:(0,De._x)("Goals","text","nelio-ab-testing"),intro:(0,De._x)("Split tests help you to improve the conversion rate of your website. Here you can set up the goals a test pursues and the specific conversion actions that, when performed by a visitor, will trigger a conversion.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-edit-experiment__goal-section"),active:()=>{var e;return!(null===(e=null==a?void 0:a.supports)||void 0===e?void 0:e.automaticGoalSetup)}},{title:(0,De._x)("Goals","text","nelio-ab-testing"),intro:(0,De._x)("Split tests help you to improve the conversion rate of your website. With this type of test, the conversion goal and conversion action that might trigger a conversion is already set up by Nelio A/B Testing.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-edit-experiment__goal-section"),active:()=>{var e;return!!(null===(e=null==a?void 0:a.supports)||void 0===e?void 0:e.automaticGoalSetup)}},{title:(0,De._x)("Actions","text","nelio-ab-testing"),intro:(0,De._x)("Use these buttons to add the specific conversion actions that might trigger a conversion like, for example, “visiting a page” or “clicking an element on the page.”","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-conversion-action-type-list"),active:()=>!!document.querySelector(".nab-conversion-action-type-list")},{title:(0,De._x)("Segmentation","text","nelio-ab-testing"),intro:(0,De._x)("If you subscribe to Nelio A/B Testing, you’ll be able to segment your visitors into groups and specify who may or may not participate in a test.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-edit-experiment__segmentation-section"),active:()=>!!document.querySelector(".nab-edit-experiment-segmentation-section__content--free")},{title:(0,De._x)("Segmentation","text","nelio-ab-testing"),intro:(0,De._x)("You can segment your audience into different groups and look at the performance of your split test with respect to each group. You can also use segmentation to limit who may or may not participate in a test.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-edit-experiment__segmentation-section"),active:()=>!document.querySelector(".nab-edit-experiment-segmentation-section__content--free")},{title:(0,De._x)("Status","text","nelio-ab-testing"),intro:(0,De._x)("Here you can see the current status of your test: once it’s “Ready,” you’ll be able to start it. Also, if you subscribe to our Professional plan, you’ll be able to schedule when a test should be started, as well as to define if and when it should be automatically stopped.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-experiment-management"),active:()=>!o("professional")},{title:(0,De._x)("Status","text","nelio-ab-testing"),intro:(0,De._x)("Here you can see the current status of your test: once it’s “Ready,” you’ll be able to start it. You can also schedule when the test should be started, as well as define a stop condition to automatically stop the test.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-experiment-management"),active:()=>o("professional")},{title:(0,De._x)("Scope","text","nelio-ab-testing"),intro:(0,De._x)("By default, this type of test will show up on all pages of your website. You can limit its scope by specifying the URLs in which the test should be visible.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-experiment-scope"),active:()=>{var e,t;return"urls"===(null===(e=null==a?void 0:a.supports)||void 0===e?void 0:e.scope)||"urls-with-tested-post"===(null===(t=null==a?void 0:a.supports)||void 0===t?void 0:t.scope)}},{title:(0,De._x)("Scope","text","nelio-ab-testing"),intro:(0,De._x)("By default, this type of test will show up on all pages of your website. You can limit its scope by specifying the URLs in which the test should be visible.","user","nelio-ab-testing")+" "+(0,De._x)("Alternatively, you can specify where variants should be visible using PHP.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-experiment-scope"),active:()=>{var e;return"urls-or-php"===(null===(e=null==a?void 0:a.supports)||void 0===e?void 0:e.scope)}},{title:(0,De._x)("Scope","text","nelio-ab-testing"),intro:(0,De._x)("This type of test applies to a specific element of your website, be it a page, a post, or what. If you enable “Global Consistency,” our plugin will also load the appropriate variant on any page in which the tested element (i.e. its title, featured image, and so on) shows up.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-experiment-scope"),active:()=>{var e;return"tested-post-with-consistency"===(null===(e=null==a?void 0:a.supports)||void 0===e?void 0:e.scope)}},{title:(0,De._x)("Scope","text","nelio-ab-testing"),intro:(0,De._x)("This type of test applies to a specific product on your store. If you enable the option to run it on “product’s page only,” our plugin will only load alternative content when the visitor sees the tested product’s page. If the product shows up anywhere else on your store, the control version will be shown and no page views will be tracked.","user","nelio-ab-testing"),element:()=>document.querySelector(".nab-experiment-scope"),active:()=>{var e;return"tested-product-with-consistency"===(null===(e=null==a?void 0:a.supports)||void 0===e?void 0:e.scope)}}]}const Nt=()=>{const e=(0,p.useRef)(null),t=Rt(),n=Tt(),i=Ct(),[s]=ct("status"),a=(s||"").includes("draft"),r=(s||"").includes("paused"),c=Dt(),u=Pt(),d=kt(),{saveExperiment:g,setExperimentData:m}=(0,l.useDispatch)(ze),v=It();return(0,o.jsxs)("div",{ref:e,className:"nab-edit-experiment-header",children:[(0,o.jsxs)("div",{className:"nab-edit-experiment-header__info",children:[t&&(0,o.jsx)(t,{className:"nab-edit-experiment-header__experiment-icon"}),(0,o.jsx)("h1",{className:"nab-edit-experiment-header__title",children:(0,De._x)("Edit Test","text","nelio-ab-testing")}),(0,o.jsx)(At.SubscribeWithCouponButton,{className:"finished"===s?"nab-edit-experiment-header__right-promo-button":void 0})]}),(0,o.jsxs)("div",{className:"nab-edit-experiment-header__settings",children:[c&&(0,o.jsxs)("span",{className:"nab-edit-experiment-header__save-button nab-edit-experiment-header__save-button--is-saving",children:[(0,o.jsx)(Je.Dashicon,{icon:"cloud"}),(0,De._x)("Saving…","text","nelio-ab-testing")]}),u&&"scheduled"!==s&&(0,o.jsxs)("span",{className:"nab-edit-experiment-header__save-button nab-edit-experiment-header__save-button--has-been-saved",children:[(0,o.jsx)(Je.Dashicon,{icon:"yes"}),(0,De._x)("Saved","text (experiment)","nelio-ab-testing")]}),!c&&!(u&&"scheduled"!==s)&&(0,o.jsx)(Je.Button,{variant:"tertiary",className:"nab-edit-experiment-header__save-button",onClick:"scheduled"===s?()=>{m({status:r?"paused":"ready"}),g()}:g,children:"scheduled"===s?(0,De._x)("Save as Ready","command (experiment)","nelio-ab-testing"):(0,De._x)("Save","command","nelio-ab-testing")}),(0,o.jsx)("div",{className:"nab-edit-experiment-header__start-button",children:(0,o.jsx)(At.Tooltip,{text:i,placement:"left",getTooltipContainer:e.current?()=>e.current:void 0,children:(0,o.jsx)("span",{children:(0,o.jsx)(Je.Button,{variant:"primary",disabled:a||c||!v||u&&"scheduled"===s,onClick:d,children:n})})})}),(0,o.jsx)(St,{})]})]})},It=()=>{const[e]=ct("status"),t=(e||"").includes("paused");return c(e=>{const{hasCapability:n}=e(m.store);return n(t?"resume_nab_experiments":"start_nab_experiments")},[t])},Tt=()=>{const[e]=ct("startDate"),[t]=ct("status");return(t||"").includes("paused")?(0,De._x)("Resume…","command","nelio-ab-testing"):e&&(0,nt.isInTheFuture)(e)?"scheduled"===t?(0,De._x)("Schedule","command","nelio-ab-testing"):(0,De._x)("Schedule…","command","nelio-ab-testing"):(0,De._x)("Start…","command","nelio-ab-testing")},Rt=()=>c(e=>{var t;const{getExperimentTypes:n}=e(ke.store),{getExperimentType:i}=e(ze);return null===(t=n()[i()])||void 0===t?void 0:t.icon},[]),Ct=()=>c(e=>e(ze).getDraftStatusRationale(),[]),Dt=()=>c(e=>e(ze).isExperimentBeingSaved(),[]),Pt=()=>c(e=>e(ze).hasExperimentBeenRecentlySaved(),[]),kt=()=>{const[e]=ct("status"),[t]=ct("startDate"),n=(e||"").includes("paused"),{resumeExperiment:i,setExperimentData:s,saveExperiment:a,startExperiment:r}=(0,l.useDispatch)(ze);return()=>{n?i():t&&(0,nt.isInTheFuture)(t)?(s({status:"scheduled"}),a()):r()}},Mt=window.wp.blockEditor,Bt=()=>{const[e,t]=ct("name");return(0,o.jsx)("div",{className:"nab-experiment-title",children:(0,o.jsx)(Mt.PlainText,{value:e,className:"nab-experiment-title__edit",placeholder:(0,De._x)("Name your test…","user","nelio-ab-testing"),onChange:t})})},Gt=({readOnly:e,action:t,goalId:n})=>{var i;const s=Vt(),a=Lt(),r=qt(),l=Ut(t.type),c=Ft(t),u=null==l?void 0:l.view,d=null==l?void 0:l.edit,g=null==l?void 0:l.icon,m=(null==t?void 0:t.attributes)||{},v=null!==(i=null==l?void 0:l.validate)&&void 0!==i?i:()=>({}),x=(0,b.getConversionActionScopeError)(c),h=Object.assign(Object.assign({},v(m)),x?{_scope:x}:{}),_=!(0,b.isEmpty)(h),[y,f]=(0,p.useState)(_),{setAttributes:j,setScope:E}=Ht(n,t.id),A=Yt(n,t.id);if(!a)return null;if(e)return(0,o.jsx)("div",{className:"nab-conversion-action",children:(0,o.jsxs)("div",{className:"nab-conversion-action__view",children:[g?(0,o.jsx)(g,{className:"nab-conversion-action__icon"}):(0,o.jsx)(Je.Dashicon,{className:"nab-conversion-action__icon nab-conversion-action__icon--invalid",icon:"warning"}),(0,o.jsx)("div",{className:"nab-conversion-action__actual-view",children:u?(0,o.jsx)(u,{attributes:m,scope:c,experimentId:s,goal:a.attributes,goalId:n,goalIndex:r}):(0,o.jsx)("span",{children:(0,De._x)("Invalid conversion action.","text","nelio-ab-testing")})})]})});const S=!!g&&(!_||y);return(0,o.jsxs)(Je.PanelBody,{className:"nab-conversion-action",opened:y,onToggle:f,title:(0,o.jsxs)("div",{className:"nab-conversion-action__view",children:[S?(0,o.jsx)(g,{className:"nab-conversion-action__icon"}):(0,o.jsx)(Je.Dashicon,{className:"nab-conversion-action__icon nab-conversion-action__icon--invalid",icon:"warning"}),(0,o.jsx)("div",{className:"nab-conversion-action__actual-view",children:u?(0,o.jsx)(u,{attributes:m,scope:c,experimentId:s,goal:a.attributes,goalId:n,goalIndex:r}):(0,o.jsx)("span",{children:(0,De._x)("Invalid conversion action.","text","nelio-ab-testing")})})]}),children:[(0,o.jsx)("div",{className:"nab-conversion-action__edit",children:d?(0,o.jsx)(d,{attributes:m,scope:c,experimentId:s,goal:a.attributes,goalId:n,goalIndex:r,setAttributes:j,setScope:E,errors:h}):(0,o.jsx)("span",{children:(0,De._x)("This conversion action can’t be properly loaded. Please consider removing it.","text","nelio-ab-testing")})}),(0,o.jsx)(Je.Button,{variant:"link",isDestructive:!0,onClick:A,className:"nab-conversion-action__delete-button",children:(0,De._x)("Delete","command","neli-ab-testing")})]})},Vt=()=>c(e=>e(ze).getExperimentId(),[]),Lt=()=>c(e=>e(ze).getActiveGoal(),[]),qt=()=>c(e=>e(ze).getActiveGoalIndex(),[]),Ut=e=>c(t=>t(tt.store).getConversionActionType(e),[e]),Ft=e=>{const t=(0,m.usePluginSetting)("goalTracking");return"custom"!==t?{type:t}:(null==e?void 0:e.scope)?e.scope:{type:"test-scope"}},Ht=(e,t)=>{const{updateConversionAction:n}=(0,l.useDispatch)(ze),i=(0,p.useCallback)((i,s)=>n(e,t,i,s),[e,t,n]),s=(0,p.useCallback)(e=>i(e,void 0),[i]),a=(0,p.useCallback)(e=>i(void 0,e),[i]);return{setAttributes:e&&t?s:g.noop,setScope:e&&t?a:g.noop}},Yt=(e,t)=>{const{removeConversionActionsFromGoal:n}=(0,l.useDispatch)(ze);return e&&t?()=>n(e,t):g.noop},Wt=()=>{const e=$t(),t=zt(e);return(0,o.jsxs)("div",{className:"nab-conversion-action-list nab-conversion-action-list--automatic",children:[1===t.length?(0,o.jsx)("p",{className:"nab-conversion-action-list__help",children:(0,De._x)("By default, there will be a new conversion in this test when the following conversion action occurs after the visitor has seen the tested element:","text","nelio-ab-testing")},"conversion-action-explanation"):(0,o.jsx)("p",{className:"nab-conversion-action-list__help",children:(0,De._x)("Split tests are usually run with some specific goals in mind. In this type of test, there’s a new conversion when at least one of the following conversion actions occurs after the visitor has seen the tested element:","text","nelio-ab-testing")},"conversion-action-explanation"),e&&t.map(t=>(0,o.jsx)(Gt,{goalId:e,action:t,readOnly:!0},t.id))]})},$t=()=>c(e=>{var t;return null===(t=e(ze).getActiveGoal())||void 0===t?void 0:t.id},[]),zt=e=>c(t=>{if(!e)return b.EMPTY_ARRAY;const{getConversionActions:n}=t(ze);return n(e)||b.EMPTY_ARRAY},[e]),Xt=()=>{var e,t;const n=Jt(),i=null==n?void 0:n.id,s=Qt(i);return s.length?(0,o.jsxs)("div",{className:"nab-conversion-action-list",children:[(0,o.jsx)("p",{className:"nab-conversion-action-list__help",children:!!(null===(t=null==n?void 0:n.ai)||void 0===t?void 0:t.description)&&(0,o.jsx)("p",{className:"nab-conversion-action-list__help",children:n.ai.description})}),(0,o.jsx)("p",{children:(0,De._x)("After a visitor has seen the tested element, there’s a new conversion every time one of the following conversion actions occurs:","text","nelio-ab-testing")}),i&&s.map(e=>(0,o.jsx)(Gt,{goalId:i,action:e},e.id))]}):(0,o.jsxs)("div",{className:"nab-conversion-action-list",children:[(null===(e=null==n?void 0:n.ai)||void 0===e?void 0:e.description)?(0,o.jsx)("p",{className:"nab-conversion-action-list__help",children:n.ai.description}):(0,o.jsx)("p",{className:"nab-conversion-action-list__help",children:(0,De._x)("Split tests are usually run with some specific goals in mind, such as “getting more subscribers” or “showing interest in your products.” Goals are fulfilled when the visitor performs certain actions. For instance, a visitor might be “showing interest in your products” when they visit your pricing page or they submit a certain form in your website.","text","nelio-ab-testing")}),(0,o.jsx)("p",{className:"nab-conversion-action-list__help",children:(0,p.createInterpolateElement)((0,De._x)("Use the following button to <strong>add the specific conversion actions</strong> that fulfill this goal.","user","nelio-ab-testing"),{strong:(0,o.jsx)("strong",{})})})]})},Jt=()=>c(e=>e(ze).getActiveGoal(),[]),Qt=e=>c(t=>{if(!e)return[];const{getConversionActions:n}=t(ze);return n(e)||[]},[e]),Kt={view:(0,De._x)("View","text","nelio-ab-testing"),interaction:(0,De._x)("Interaction","text","nelio-ab-testing"),ecommerce:(0,De._x)("E-Commerce","text","nelio-ab-testing"),other:(0,De._x)("Other","text","nelio-ab-testing")},Zt=()=>{const e=en(),t=tn(),{addConversionActionsIntoGoal:n}=(0,l.useDispatch)(ze);if(!(null==t?void 0:t.length))return(0,o.jsx)("div",{className:"nab-conversion-action-type-new",children:(0,o.jsx)(Je.Button,{variant:"secondary",disabled:!0,children:(0,De._x)("Add Action","command","nelio-ab-testing")})});const i=(0,g.omitBy)((0,g.groupBy)(t,"category"),e=>!e.length);return(0,o.jsx)(Je.DropdownMenu,{className:"nab-conversion-action-type-new",icon:null,label:(0,De._x)("Add Action","command","nelio-ab-testing"),toggleProps:{variant:"secondary",children:(0,De._x)("Add Action","command","nelio-ab-testing")},popoverProps:{className:"nab-conversion-action-type-new__list",placement:"top-center"},children:({onClose:t})=>(0,g.keys)(Kt).map(e=>e).filter(e=>{var t;return!!(null===(t=i[e])||void 0===t?void 0:t.length)}).map(s=>{var a;return(0,o.jsx)(Je.MenuGroup,{label:Kt[s],children:null===(a=i[s])||void 0===a?void 0:a.map(({name:i,title:s,icon:a})=>(0,o.jsx)(Je.MenuItem,{role:"menuitem",icon:(0,o.jsx)(a,{}),iconPosition:"left",onClick:()=>{(t=>{if(!e)return;const i=(0,tt.createConversionAction)(t);i&&n(e,i)})(i),t()},children:s},i))},s)})})},en=()=>c(e=>{var t;return null===(t=e(ze).getActiveGoal())||void 0===t?void 0:t.id},[]),tn=()=>{const e=en(),t=nn(e),n=c(e=>e(tt.store).getConversionActionTypes().filter(t=>!t.isActive||t.isActive(e)).filter(e=>!e.requiresSingleness||t.every(t=>t.type!==e.name)),[t]);if(!t.length)return n;const i=n.filter(e=>!!e.requiresUniformity);for(const e of i)if((0,g.every)(t,t=>t.type===e.name))return[e];return i.length?(0,g.difference)(n,i):n},nn=e=>c(t=>e&&t(ze).getConversionActions(e)||[],[e]),sn=()=>{const e=on();return e?(0,o.jsx)(an,{plugin:e}):null},an=({plugin:e})=>{const t=rn(e),[n,i]=ln(),s=un(e),[a,r]=cn(e);return(0,o.jsxs)("div",{className:"nab-ecommerce-goal-settings",children:[(0,o.jsx)("p",{children:(0,o.jsx)("strong",{children:t})}),(0,o.jsx)(Ke,{className:"nab-ecommerce-goal-settings__order-status",label:(0,De._x)("Order status required for conversions:","command","nelio-ab-testing"),options:s,value:a,onChange:r}),(0,o.jsx)(Qe,{className:"nab-ecommerce-goal-settings__track-revenue",label:(0,De._x)("Track revenue and show in test results","command","nelio-ab-testing"),checked:n,onChange:i})]})},rn=e=>{switch(e){case"woocommerce":return(0,De._x)("WooCommerce Goal Settings","text","nelio-ab-testing");case"edd":return(0,De._x)("Easy Digital Downloads Goal Settings","text","nelio-ab-testing")}},on=()=>c(e=>{var t;const{getActiveGoal:n}=e(ze),{getConversionActions:i}=e(ze),s=null===(t=n())||void 0===t?void 0:t.id,a=s?i(s):[];if(a.length)return a.every(({type:e})=>"nab/wc-order"===e)?"woocommerce":a.every(({type:e})=>"nab/edd-order"===e)?"edd":void 0},[]),ln=()=>{var e;const t=dn(),n=null===(e=null==t?void 0:t.attributes.useOrderRevenue)||void 0===e||e,{updateGoal:i}=(0,l.useDispatch)(ze);return[n,()=>t?i(t.id,{useOrderRevenue:!n}):void 0]},cn=e=>{const t=dn(),n=un(e),i=null==t?void 0:t.attributes.orderStatusForConversion,s=i&&n.map(e=>e.value).includes(null==t?void 0:t.attributes.orderStatusForConversion)?i:pn(e),{updateGoal:a}=(0,l.useDispatch)(ze);return[s,e=>t?a(t.id,{orderStatusForConversion:e}):void 0]},un=e=>c(t=>t(m.store).getECommerceSetting(e,"orderStatuses"),[e]),dn=()=>c(e=>e(ze).getActiveGoal(),[]),pn=e=>{switch(e){case"woocommerce":return"wc-completed";case"edd":return"complete"}},gn=({name:e,setName:t,removeGoal:n,isAutomatic:i})=>(0,o.jsxs)("div",{className:"nab-current-goal-info",children:[!i&&(0,o.jsxs)("div",{className:"nab-current-goal-info__header",children:[(0,o.jsx)(Ze,{placeholder:(0,De._x)("Name your goal…","user","nelio-ab-testing"),value:e,onChange:e=>t(e)}),!!n&&(0,o.jsx)(Je.Button,{variant:"tertiary",isDestructive:!0,className:"nab-current-goal-info__delete-button",onClick:n,children:(0,De._x)("Delete","command (goal)","nelio-ab-testing")})]}),(0,o.jsx)(sn,{}),i?(0,o.jsx)(Wt,{}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Xt,{}),(0,o.jsx)(Zt,{})]})]});function mn(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=mn(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}const vn=function(){for(var e,t,n=0,i="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=mn(e))&&(i&&(i+=" "),i+=t);return i},bn=()=>{const e=xn(),t=hn(),n=yn(),{setActiveGoal:i,addGoals:s}=(0,l.useDispatch)(ze);return(0,o.jsxs)("ul",{className:"nab-goal-list",children:[t.map((t,n)=>(0,o.jsx)("li",{className:vn("nab-goal-list__item",{"nab-goal-list__item--is-active":t.id===e}),children:(0,o.jsx)(Je.Button,{disabled:t.id===e,onClick:()=>i(t.id),children:(0,g.trim)(t.attributes.name)||fn(n)})},t.id)),!n&&(0,o.jsx)("li",{className:"nab-goal-list__add-new-goal",children:(0,o.jsxs)(Je.Button,{className:"nab-goal-list__add-new-goal-button",variant:"link",onClick:()=>{const e=(0,b.createGoal)();s(e),i(e.id)},children:[(0,o.jsx)(Je.Dashicon,{icon:"plus"}),(0,o.jsx)("span",{children:(0,De._x)("New","command (goal)","nelio-ab-testing")})]})},"add-new-goal")]})},xn=()=>c(e=>{var t;return null===(t=e(ze).getActiveGoal())||void 0===t?void 0:t.id},[]),hn=()=>c(e=>e(ze).getGoals(),[]),yn=()=>{const[e]=ct("status");return(e||"").includes("paused")};function fn(e){return e?(0,De.sprintf)(/* translators: %d: Number. */ /* translators: %d: Number. */
(0,De._x)("Goal %d","text","nelio-ab-testing"),e+1):(0,De._x)("Default Goal","text","nelio-ab-testing")}const jn=()=>{var e;On();const t=En(),n=An(),i=Sn(),s=n.length,a=wn(),{removeGoals:r,setActiveGoal:c,updateGoal:u}=(0,l.useDispatch)(ze),d=1<s&&!i;return(0,o.jsxs)("div",{className:"nab-edit-experiment__goal-section",children:[(0,o.jsx)("h2",{children:(0,p.createInterpolateElement)((0,De.sprintf)(/* translators: %s: Dashicon. */ /* translators: %s: Dashicon. */
(0,De._x)("%s Conversion Goals and Actions","text","nelio-ab-testing"),"<icon></icon>"),{icon:(0,o.jsx)(Je.Dashicon,{className:"nab-goal-section__title-icon",icon:"flag"})})}),(0,o.jsxs)("div",{className:"nab-edit-experiment-goal-section__content",children:[(0,o.jsx)(bn,{}),(0,o.jsx)(gn,{name:null!==(e=null==t?void 0:t.attributes.name)&&void 0!==e?e:"",setName:e=>{return n={name:e},t&&u(t.id,Object.assign(Object.assign({},t.attributes),n));var n},removeGoal:d?()=>{if(!t)return;const e=function(e,t){const n=(0,g.findIndex)(e,{id:t});return n===e.length-1?e[n-1]:e[n+1]}(n,t.id);e&&(c(e.id),r(t.id))}:void 0,isAutomatic:a})]})]})},En=()=>c(e=>e(ze).getActiveGoal(),[]),An=()=>c(e=>e(ze).getGoals(),[]),Sn=()=>{const[e]=ct("status");return(e||"").includes("paused")},wn=()=>{const e=En(),t=An()[0];return c(n=>{const{getExperimentType:i}=n(ze),{hasExperimentSupport:s}=n(ke.store);return(null==e?void 0:e.id)===(null==t?void 0:t.id)&&s(i(),"automaticGoalSetup")},[e,t])},On=()=>{var e;const{replaceConversionActionsInGoal:t}=(0,l.useDispatch)(ze),n=null===(e=An()[0])||void 0===e?void 0:e.id,i=c(e=>e(ze).getAlternative("control"),[]),s=c(e=>{const{getExperimentType:t}=e(ze),{getExperimentSupport:n}=e(ke.store);return n(t(),"automaticGoalSetup")},[]);(0,p.useEffect)(()=>{if(!i||!n||!s)return;const e=s(i.attributes);t(n,e)},[i,n,s,t])},Nn=({readOnly:e,rule:t,setAttributes:n,remove:i})=>{var s;const a=In(),r=Tn(t.type),l=null==r?void 0:r.view,c=null==r?void 0:r.edit,u=null==r?void 0:r.icon,d=(null==t?void 0:t.attributes)||{},g=(null!==(s=null==r?void 0:r.validate)&&void 0!==s?s:()=>({}))(d),m=!(0,b.isEmpty)(g),[v,x]=(0,p.useState)(m);if(e)return(0,o.jsx)("div",{className:"nab-segmentation-rule",children:(0,o.jsxs)("div",{className:"nab-segmentation-rule__view",children:[u?(0,o.jsx)(u,{className:"nab-segmentation-rule__icon"}):(0,o.jsx)(Je.Dashicon,{className:"nab-segmentation-rule__icon nab-segmentation-rule__icon--invalid",icon:"warning"}),(0,o.jsx)("div",{className:"nab-segmentation-rule__actual-view",children:l?(0,o.jsx)(l,{attributes:d,experimentId:a}):(0,o.jsx)("span",{children:(0,De._x)("Invalid segmentation rule.","text","nelio-ab-testing")})})]})});const h=!!u&&(!m||v);return(0,o.jsxs)(Je.PanelBody,{className:"nab-segmentation-rule",opened:v,onToggle:x,title:(0,o.jsxs)("div",{className:"nab-segmentation-rule__view",children:[h?(0,o.jsx)(u,{className:"nab-segmentation-rule__icon"}):(0,o.jsx)(Je.Dashicon,{className:"nab-segmentation-rule__icon nab-segmentation-rule__icon--invalid",icon:"warning"}),(0,o.jsx)("div",{className:"nab-segmentation-rule__actual-view",children:l?(0,o.jsx)(l,{attributes:d,experimentId:a}):(0,o.jsx)("span",{children:(0,De._x)("Invalid segmentation rule.","text","nelio-ab-testing")})})]}),children:[(0,o.jsx)("div",{className:"nab-segmentation-rule__edit",children:c?(0,o.jsx)(c,{attributes:d,experimentId:a,setAttributes:n,errors:g}):(0,o.jsx)("span",{children:(0,De._x)("This segmentation rule can’t be properly loaded. Please consider removing it.","text","nelio-ab-testing")})}),(0,o.jsx)(Je.Button,{variant:"link",isDestructive:!0,onClick:i,className:"nab-segmentation-rule__delete-button",children:(0,De._x)("Delete","command","neli-ab-testing")})]})},In=()=>c(e=>e(ze).getExperimentId(),[]),Tn=e=>c(t=>t(it.store).getSegmentationRuleType(e),[e]),Rn=()=>{const e=Dn(),t=Pn(),n=kn();return(0,o.jsxs)("div",{className:"nab-segmentation-rule-list",children:[!!e.length&&(0,o.jsx)("p",{children:(0,De._x)("A visitor participates in the test every time all of the following segmentation rules match:","text","nelio-ab-testing")},"segmentation-rule-explanation-1"),e.map(e=>(0,o.jsx)(Nn,{rule:e,setAttributes:n=>t(e.id,n),remove:()=>n(e.id)},e.id)),!e.length&&[(0,o.jsx)("p",{className:"nab-segmentation-rule-list__help",children:(0,De._x)("Split tests are usually applied to all visitors. But you can narrow your audience using segmentation rules to target only a subset of your visitors.","text","nelio-ab-testing")},"segmentation-rule-explanation-1"),(0,o.jsx)("p",{className:"nab-segmentation-rule-list__help",children:(0,p.createInterpolateElement)((0,De._x)("Use the buttons below to <strong>add the specific segmentation rules</strong> for this segment.","user","nelio-ab-testing"),{strong:(0,o.jsx)("strong",{})})},"segmentation-rule-explanation-2")]]})},Cn=()=>c(e=>e(ze).getActiveSegment(),[]),Dn=()=>{const e=Cn();return c(t=>{const{getSegmentationRules:n}=t(ze);return(null==e?void 0:e.id)&&n(e.id)||[]},[e])},Pn=()=>{var e;const t=null===(e=Cn())||void 0===e?void 0:e.id,{updateSegmentationRule:n}=(0,l.useDispatch)(ze);return(e,i)=>t?n(t,e,i):Mn},kn=()=>{var e;const t=null===(e=Cn())||void 0===e?void 0:e.id,{removeSegmentationRulesFromSegment:n}=(0,l.useDispatch)(ze);return e=>t?n(t,e):Mn},Mn=()=>{},Bn=({category:e,segmentationRules:t,createSegmentationRule:n,onClose:i})=>{const s=Gn(e.name);return s.length?(0,o.jsx)(Je.MenuGroup,{label:e.title,children:s.map(({name:e,title:s,icon:a,singleton:r})=>(0,o.jsx)(Je.MenuItem,{role:"menuitem",icon:(0,o.jsx)(a,{}),iconPosition:"left",onClick:()=>{n(e),i()},disabled:r&&t.some(t=>t.type===e),children:s},e))}):null},Gn=e=>c(e=>e(it.store).getSegmentationRuleTypes()||b.EMPTY_ARRAY,[]).filter(({category:t})=>t===e),Vn=({createSegmentationRule:e,segmentationRules:t})=>{const n=Ln();return(0,o.jsx)(Je.DropdownMenu,{className:"nab-segmentation-rule-type-new",icon:null,label:(0,De._x)("Add Rule","command","nelio-ab-testing"),toggleProps:{variant:"secondary",children:(0,De._x)("Add Rule","command","nelio-ab-testing")},popoverProps:{className:"nab-segmentation-rule-type-new__list",placement:"top-center"},children:({onClose:i})=>n.map(n=>(0,o.jsx)(Bn,{category:n,createSegmentationRule:e,segmentationRules:t,onClose:i},n.name))})},Ln=()=>c(e=>e(it.store).getSegmentationRuleTypeCategories()||[],[]),qn=({name:e,setName:t,removeSegment:n})=>{const i=Fn(),s=Hn();return(0,o.jsxs)("div",{className:"nab-current-segment-info",children:[(0,o.jsxs)("div",{className:"nab-current-segment-info__header",children:[(0,o.jsx)(Ze,{placeholder:(0,De._x)("Name your segment…","user","nelio-ab-testing"),value:e,onChange:e=>t(e)}),!!n&&(0,o.jsx)(Je.Button,{variant:"tertiary",isDestructive:!0,className:"nab-current-segment-info__delete-button",onClick:n,children:(0,De._x)("Delete","command (segment)","nelio-ab-testing")})]}),(0,o.jsx)(Rn,{}),(0,o.jsx)(Vn,{segmentationRules:i,createSegmentationRule:s})]})},Un=()=>c(e=>e(ze).getActiveSegment(),[]),Fn=()=>{const e=Un();return c(t=>{const{getSegmentationRules:n}=t(ze);return(null==e?void 0:e.id)&&n(e.id)||[]},[e])},Hn=()=>{const{addSegmentationRulesIntoSegment:e}=(0,l.useDispatch)(ze),t=Un();return n=>{if(!t)return;const i=(0,it.createSegmentationRule)(n);i&&e(t.id,i)}},Yn=()=>{const e=Wn(),t=$n(),n=zn(),{setActiveSegment:i,addSegments:s}=(0,l.useDispatch)(ze);return(0,o.jsxs)("ul",{className:"nab-segment-list",children:[t.map((t,n)=>(0,o.jsx)("li",{className:vn("nab-segment-list__item",{"nab-segment-list__item--is-active":t.id===e}),children:(0,o.jsx)(Je.Button,{disabled:t.id===e,onClick:()=>i(t.id),children:(0,g.trim)(t.attributes.name)||Xn(n)})},t.id)),!n&&(0,o.jsx)("li",{className:"nab-segment-list__add-new-segment",children:(0,o.jsxs)(Je.Button,{className:"nab-segment-list__add-new-segment-button",variant:"link",onClick:()=>{const e=(0,b.createSegment)();s(e),i(e.id)},children:[(0,o.jsx)(Je.Dashicon,{icon:"plus"}),(0,o.jsx)("span",{children:(0,De._x)("New","command (segment)","nelio-ab-testing")})]})},"add-new-segment")]})},Wn=()=>c(e=>{var t;return null===(t=e(ze).getActiveSegment())||void 0===t?void 0:t.id},[]),$n=()=>c(e=>e(ze).getSegments()||[],[]),zn=()=>{const[e]=ct("status");return e.includes("paused")},Xn=e=>(0,De.sprintf)(/* translators: %d: Number. */ /* translators: %d: Number. */
(0,De._x)("Segment %d","text","nelio-ab-testing"),e+1),Jn=()=>{const[e,t]=Qn(),[n]=ct("status"),[i,s]=Zn(),a=(0,m.usePluginSetting)("segmentEvaluation"),r=(n||"").includes("paused"),l=Kn(),c=!r;return(0,o.jsxs)("div",{className:"nab-edit-experiment__segmentation-section",children:[(0,o.jsxs)("h2",{children:[(0,o.jsx)("span",{children:(0,p.createInterpolateElement)((0,De.sprintf)(/* translators: %s: Dashicon. */ /* translators: %s: Dashicon. */
(0,De._x)("%s Segmentation","text","nelio-ab-testing"),"<icon></icon>"),{icon:(0,o.jsx)(Je.Dashicon,{className:"nab-segmentation-section__title-icon",icon:"groups"})})}),"custom"===a&&(0,o.jsx)("div",{className:"nab-edit-experiment-segmentation-section__strategy",children:(0,o.jsx)(Ke,{value:i,options:[{value:"site",label:(0,De._x)("Evaluate on Site Landing","command","nelio-ab-testing")},{value:"tested-page",label:(0,De._x)("Evaluate on Tested Pages","text","nelio-ab-testing")}],onChange:s})})]}),(0,o.jsxs)("div",{className:"nab-edit-experiment-segmentation-section__content",children:[(0,o.jsx)(Yn,{}),e?(0,o.jsx)(qn,{name:e.attributes.name,setName:n=>t(Object.assign(Object.assign({},e.attributes),{name:n})),removeSegment:c?l:void 0}):(0,o.jsx)("p",{className:"nab-edit-experiment-segmentation-section__content--empty",children:(0,De._x)("Add a new segment to narrow your tested audience and target only a subset of your visitors.","user","nelio-ab-testing")})]})]})},Qn=()=>{const e=c(e=>e(ze).getActiveSegment(),[]),{updateSegment:t}=(0,l.useDispatch)(ze);return[e,n=>{(null==e?void 0:e.id)&&t(e.id,n)}]},Kn=()=>{const[e]=Qn(),t=c(e=>e(ze).getSegments(),[]),{removeSegments:n,setActiveSegment:i}=(0,l.useDispatch)(ze);return e?()=>{const s=function(e,t){const n=(0,g.findIndex)(e,{id:t});return e[n+1]||e[n-1]||!1}(t,e.id);s&&i(s.id),n(e.id)}:()=>null},Zn=()=>{const e=c(e=>e(ze).getSegmentEvaluation(),[]),{setSegmentEvaluation:t}=(0,l.useDispatch)(ze);return[e,t]},ei=()=>{const[e]=ct("status");return(0,o.jsxs)(Je.PanelRow,{className:"nab-experiment-management__status",children:[(0,o.jsx)("span",{children:(0,De._x)("Status","text","nelio-ab-testing")}),(0,o.jsx)("strong",{className:"nab-experiment-management__status-value",children:ti(e)})]})};function ti(e){switch(e){case"draft":return(0,De._x)("Draft","text (experiment status)","nelio-ab-testing");case"ready":return(0,De._x)("Ready","text (experiment status)","nelio-ab-testing");case"scheduled":return(0,De._x)("Scheduled","text (experiment status)","nelio-ab-testing");case"paused":return(0,De._x)("Paused","text (experiment status)","nelio-ab-testing");case"paused_draft":return(0,De._x)("Paused Draft","text (experiment status)","nelio-ab-testing");case"running":case"finished":case"trash":return"-"}}const ni=()=>{const[e,t]=ct("startDate"),n=dt("professional"),i=ii();return(0,o.jsxs)(Je.PanelRow,{className:"nab-experiment-start-schedule",children:[(0,o.jsx)("span",{children:(0,De._x)("Start","text","nelio-ab-testing")}),(0,o.jsxs)("span",{children:[!!i&&!!e&&(0,o.jsx)("span",{className:"nab-experiment-start-schedule__date",children:(0,nt.formatI18nDatetime)(e)}),!i&&!n&&(0,o.jsx)("span",{className:"nab-experiment-start-schedule__date",children:(0,De._x)("Immediately","text","nelio-ab-testing")}),!i&&!!n&&(0,o.jsx)(At.DateTimePicker,{className:"nab-experiment-start-schedule__date",date:e||"",onChange:e=>t(e||""),noDateLabel:(0,De._x)("Immediately","text","nelio-ab-testing"),readonly:!0})]})]})},ii=()=>{const[e]=ct("status");return e.includes("paused")},si=window.wp.compose,ai=window.nab.i18n,ri=()=>{const e=(0,si.useInstanceId)(ri),t=dt("professional"),[n]=ct("endMode"),[i]=ct("endValue"),s=oi(),a=ui[n],[r,c]=li(),{setExperimentData:u}=(0,l.useDispatch)(ze),d=(e,t)=>u({endMode:e,endValue:t});return t?(0,o.jsxs)(Je.PanelRow,{className:"nab-experiment-end-schedule",children:[(0,o.jsx)("span",{children:(0,De._x)("End","text","nelio-ab-testing")}),(0,o.jsx)(Je.Dropdown,{placement:"bottom-end",contentClassName:"nab-experiment-end-schedule__dropdown",renderToggle:({onToggle:t,isOpen:s})=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("label",{className:"nab-experiment-end-schedule__value screen-reader-text",htmlFor:`nab-experiment-end-schedule__toggle-${e}`,children:(0,De._x)("Click to change","command","nelio-ab-testing")}),(0,o.jsx)(Je.Button,{variant:"link",id:`nab-experiment-end-schedule__toggle-${e}`,type:"button",className:"nab-experiment-end-schedule__toggle",onClick:t,"aria-expanded":s,"aria-live":"polite",children:di(n,i)})]}),renderContent:()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ke,{label:(0,De._x)("End Mode","text","nelio-ab-testing"),value:n,onChange:e=>{c(!1),d(e,function(e){switch(e){case"duration":return 15;case"page-views":return 5e3;case"confidence":return 97;case"manual":return 0}}(e))},options:ci.filter(({value:e})=>"confidence"!==e||"nab/heatmap"!==s)}),!!a&&(0,o.jsx)("div",{style:{marginTop:"1em"},children:(0,o.jsx)(Ke,{label:(0,De._x)("Value","text","nelio-ab-testing"),onChange:e=>{c("custom"===e),d(n,Number.parseInt(e)||0)},value:r?"custom":`${i}`,options:a})}),!!a&&r&&(0,o.jsx)("div",{style:{marginTop:"0.5em"},children:(0,o.jsx)(Ze,{type:"number",placeholder:pi(n),value:i||"",onChange:e=>d(n,Number.parseInt(e)||0)})})]})})]}):(0,o.jsxs)(Je.PanelRow,{className:"nab-experiment-end-schedule",children:[(0,o.jsx)("span",{children:(0,De._x)("End","text","nelio-ab-testing")}),(0,o.jsx)("span",{children:(0,De._x)("Manual","text","nelio-ab-testing")})]})},oi=()=>c(e=>e(ze).getExperimentType(),[]),li=()=>{const[e]=ct("endMode"),[t]=ct("endValue"),n=ui[e],i=!!(0,g.find)(n,{value:"custom"})&&!(0,g.find)(n,{value:`${t}`}),[s,a]=(0,p.useState)(i);return[s,a]},ci=[{value:"manual",label:(0,De._x)("Manual","text","nelio-ab-testing")},{value:"duration",label:(0,De._x)("Duration","text","nelio-ab-testing")},{value:"page-views",label:(0,De._x)("Page Views","text","nelio-ab-testing")},{value:"confidence",label:(0,De._x)("Confidence","text","nelio-ab-testing")}],ui={manual:[],confidence:[95,96,97,98,99].map(e=>({value:`${e}`,label:(0,De.sprintf)(/* translators: %s: Percentage number, such as “95”. */ /* translators: %s: Percentage number, such as “95”. */
(0,De._x)("%s%%","text","nelio-ab-testing"),(0,ai.numberFormat)(e))})),duration:[...[5,7,15,30,60,90].map(e=>({value:`${e}`,label:(0,De.sprintf)(/* translators: %d: Number of days. */ /* translators: %d: Number of days. */
(0,De._n)("%d day","%d days",e,"nelio-ab-testing"),e)})),{value:"custom",label:(0,De._x)("Custom","text","nelio-ab-testing"),placeholder:(0,De._x)("Days","text","nelio-ab-testing")}],"page-views":[...[2500,5e3,1e4,2e4,5e4,1e5].map(e=>({value:`${e}`,label:(0,ai.numberFormat)(e)})),{value:"custom",label:(0,De._x)("Custom","text","nelio-ab-testing"),placeholder:(0,De._x)("Days","text","nelio-ab-testing")}]};function di(e,t){switch(e){case"duration":return(0,De.sprintf)(/* translators: %d: Number of days. */ /* translators: %d: Number of days. */
(0,De._n)("After %d day","After %d days",t,"nelio-ab-testing"),t);case"page-views":return(0,De.sprintf)(/* translators: %s: Number. */ /* translators: %s: Number. */
(0,De._n)("After %s page view","After %s page views",t,"nelio-ab-testing"),(0,ai.numberFormat)(t));case"confidence":return(0,De.sprintf)(/* translators: %s: Percentage number, such as “95”. */ /* translators: %s: Percentage number, such as “95”. */
(0,De._x)("At %s%% confidence","text","nelio-ab-testing"),(0,ai.numberFormat)(t));case"manual":return(0,De._x)("Manual","text","nelio-ab-testing")}}const pi=e=>{var t,n;return null!==(n=null===(t=(0,g.find)(ui[e],{value:"custom"}))||void 0===t?void 0:t.placeholder)&&void 0!==n?n:""},gi=()=>{const[e,t]=ct("autoAlternativeApplication"),n=mi();return(0,p.useEffect)(()=>{"yes"!==n&&t(!1)},[n,t]),"no"===n?null:(0,o.jsx)("div",{className:"nab-experiment-auto-apply-winner",children:(0,o.jsx)(Qe,{className:vn({"nab-experiment-auto-apply-winner__checkbox":!0,"nab-experiment-auto-apply-winner__checkbox--disabled":"not-now"===n}),label:(0,De._x)("Apply winner automatically","command","nelio-ab-testing"),checked:e,onChange:t,disabled:"not-now"===n})})},mi=()=>{const e=ut(),t=c(e=>e(ze).getAlternative("control"),[]);return t&&(null==e?void 0:e.supports.alternativeApplication)?"boolean"==typeof e.supports.alternativeApplication?e.supports.alternativeApplication?"yes":"no":e.supports.alternativeApplication(t.attributes)?"yes":"not-now":"no"},vi=()=>{const e=bi(),{moveToTrash:t}=(0,l.useDispatch)(ze);return(0,o.jsxs)(Je.PanelBody,{className:"nab-experiment-management",title:(0,De._x)("Status & Management","text (experiment)","nelio-ab-testing"),children:[(0,o.jsx)(ei,{}),(0,o.jsx)(ni,{}),(0,o.jsx)(ri,{}),(0,o.jsx)(gi,{}),e&&(0,o.jsx)(Je.PanelRow,{className:"nab-experiment-management__trash",children:(0,o.jsx)(Je.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>{t()},children:(0,De._x)("Move to Trash","command (experiment)","nelio-ab-testing")})})]})},bi=()=>c(e=>e(m.store).hasCapability("delete_nab_experiments"),[]),xi=()=>{const[e,t]=ct("description");return(0,o.jsx)(Je.PanelBody,{className:"nab-experiment-description",title:(0,De._x)("Description","text","nelio-ab-testing"),children:(0,o.jsx)(et,{label:(0,De._x)("Describe your test (optional)","user","nelio-ab-testing"),className:"nab-experiment-description__textarea",value:e,onChange:t})})},hi=({rules:e,scopeSupport:t})=>{const[n,i]=(0,p.useState)((0,b.createScopeRule)({type:"partial",value:""})),{setScopeRules:s}=(0,l.useDispatch)(ze);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_i,{rules:e,scopeSupport:t}),(0,o.jsx)("ul",{className:"nab-experiment-scope__rule-list",children:[...e,n].map(({id:t,attributes:a})=>(0,o.jsx)(yi,{attributes:a,setAttributes:r=>((t,a)=>{const r=n.id===t;r&&i((0,b.createScopeRule)({type:"partial",value:""}));const o=Object.assign(Object.assign({},n),{attributes:a});s(r?[...e,o]:e.map(e=>e.id===t?Object.assign(Object.assign({},e),{attributes:a}):e))})(t,Object.assign(Object.assign({},a),r))},t))})]})},_i=({rules:e,scopeSupport:t})=>e.length?(0,o.jsxs)("p",{children:["urls-with-tested-post"===t?(0,De._x)("Variants will be visible on the tested element’s page, as well as pages matching one of the following criteria.","text","nelio-ab-testing"):(0,De._x)("Variants will be visible only on pages matching one of the following criteria.","text","nelio-ab-testing")," ",(0,De._x)("To remove one criterion, leave it empty and save the test.","user","nelio-ab-testing")]}):(0,o.jsxs)("p",{children:["urls-with-tested-post"===t?(0,De._x)("Variants will be visible on all the pages of your website, including that of the tested element.","user","nelio-ab-testing"):(0,De._x)("Variants will be visible on all the pages of your website.","user","nelio-ab-testing")," ",(0,De._x)("If you wish to limit its scope to certain pages only, use the following form to define the URLs in which the test should run.","user","nelio-ab-testing")]}),yi=({attributes:e,setAttributes:t})=>{const n=function(e,t){const n=(0,m.usePluginSetting)("homeUrl");switch(e){case"partial":case"partial-not-included":return t&&(0,b.isUrlFragmentInvalid)(t)||"";case"exact":case"different":return t&&(0,b.getLocalUrlError)(t,n)||""}}(e.type,e.value);return(0,o.jsxs)("li",{className:vn({"nab-experiment-scope__rule-list-item":!0}),"data-operator":(0,De._x)("or","text","nelio-ab-testing"),children:[(0,o.jsx)("div",{className:"nab-experiment-scope__rule-mode",children:(0,o.jsx)(Ke,{value:e.type,options:ji,onChange:e=>t({type:e})})}),(0,o.jsxs)("div",{className:"nab-experiment-scope__rule-value",children:[(0,o.jsx)(Ze,{placeholder:(0,De._x)("Value","text","nelio-ab-testing"),value:e.value,onChange:e=>t({value:e})}),(0,o.jsx)(At.ErrorText,{value:n})]})]})},fi={exact:(0,De._x)("URL is","text","nelio-ab-testing"),different:(0,De._x)("URL is not","text","nelio-ab-testing"),partial:(0,De._x)("URL contains","text","nelio-ab-testing"),"partial-not-included":(0,De._x)("URL does not contain","text","nelio-ab-testing")},ji=(0,g.keys)(fi).map(e=>e).map(e=>({label:fi[e],value:e})),Ei=({rules:e})=>{const t=Ai();return(0,o.jsx)(Qe,{label:(0,De._x)("Global Consistency","command","nelio-ab-testing"),checked:!e.length,onChange:()=>t(!e.length),help:e.length?(0,De._x)("Variants will be visible only on the tested element’s page.","text","nelio-ab-testing"):(0,De._x)("Variants will be visible on the tested element’s page. All other pages will also show the appropriate variant of this test whenever the tested element appears on them.","text","nelio-ab-testing")})},Ai=()=>{const{setScopeRules:e}=(0,l.useDispatch)(ze);return t=>e(t?[(0,b.createScopeRule)({type:"tested-post"})]:[])},Si=({rules:e})=>{const t=wi();return(0,o.jsx)(Qe,{label:(0,De._x)("Product’s page only","command","nelio-ab-testing"),checked:e.length,onChange:()=>t(!e.length),help:e.length?(0,De._x)("Variants will be visible only on the tested product’s page.","text","nelio-ab-testing")+" "+(0,De._x)("Moreover, price testing is disabled.","user","nelio-ab-testing"):(0,De._x)("Variants will be visible everywhere on your store: the product’s page, shopping carts, the checkout page, on a “related products” section, etc.","text","nelio-ab-testing")})},wi=()=>{const{setScopeRules:e}=(0,l.useDispatch)(ze);return t=>e(t?[(0,b.createScopeRule)({type:"tested-post"})]:[])},Oi=({rules:e})=>{var t,n;const{setScopeRules:i}=(0,l.useDispatch)(ze),s=null!==(t=e[0])&&void 0!==t?t:Ci,a=null!==(n=s.attributes.value.args)&&void 0!==n?n:[];return(0,o.jsxs)("div",{className:"tested-url-with-query-args-scope",children:[(0,o.jsx)("p",{children:(0,De._x)("Test will be active on tested URLs if their query parameters match the following conditions:","text","nelio-ab-testing")}),(0,o.jsx)(Ni,{value:a,onChange:e=>i([Object.assign(Object.assign({},s),{attributes:Object.assign(Object.assign({},s.attributes),{value:Object.assign(Object.assign({},s.attributes.value),{args:e})})})])})]})},Ni=({value:e,onChange:t})=>{const n=(0,g.countBy)(e,"name");return(0,o.jsx)("div",{className:"tested-url-with-query-args-scope",children:(0,o.jsx)("div",{className:"tested-url-with-query-args-scope__block",children:(0,o.jsx)("div",{className:"tested-url-with-query-args-scope__arguments",children:[...e,Ri].map((i,s)=>{var a;return(0,o.jsx)(Ii,{value:i,hasDuplicateName:!!i.name&&(null!==(a=n[i.name])&&void 0!==a?a:0)>=2,onChange:n=>t([...(0,g.take)(e,s),Object.assign(Object.assign({},i),n),...(0,g.drop)(e,s+1)])},s)})})})})},Ii=({hasDuplicateName:e,value:t,onChange:n})=>(0,o.jsxs)("div",{className:"tested-url-with-query-args-scope__argument","data-operator":(0,De._x)("and","text","nelio-ab-testing"),children:[(0,o.jsxs)("div",{className:"tested-url-with-query-args-scope__argument-setup",children:[(0,o.jsx)(Ze,{placeholder:(0,De._x)("Name","text","nelio-ab-testing"),value:t.name,onChange:e=>n({name:e})}),(0,o.jsx)(Ke,{options:Pi,value:t.condition,onChange:e=>n({condition:e})})]}),(0,o.jsx)("div",{className:"tested-url-with-query-args-scope__argument-value",children:(0,o.jsx)(Ti,{type:t.condition,value:t.value,onChange:e=>n({value:e})})}),e&&(0,o.jsx)("div",{className:"tested-url-with-query-args-scope__argument-error",children:(0,De.sprintf)(/* translators: %s: Query parameter’s name. */ /* translators: %s: Query parameter’s name. */
(0,De._x)("Query parameter “%s” should only appear once in the test scope","text","nelio-ab-testing"),t.name)})]}),Ti=({type:e,value:t,onChange:n})=>{switch(e){case"exists":case"does-not-exist":return null;case"is-equal-to":case"is-not-equal-to":case"contains":case"does-not-contain":return(0,o.jsx)(Ze,{placeholder:(0,De._x)("Value","text","nelio-ab-testing"),value:t,onChange:n});case"is-any-of":case"is-none-of":return(0,o.jsx)(et,{placeholder:(0,De._x)("Value (one per line)","text","nelio-ab-testing"),value:t,onChange:n})}},Ri={name:"",condition:"exists",value:""},Ci=(0,b.createScopeRule)({type:"tested-url-with-query-args",value:{urls:[],args:[]}}),Di={exists:(0,De._x)("Exists","text","nelio-ab-testing"),"does-not-exist":(0,De._x)("Does not exist","text","nelio-ab-testing"),"is-equal-to":(0,De._x)("Is equal to","text","nelio-ab-testing"),"is-not-equal-to":(0,De._x)("Is not equal to","text","nelio-ab-testing"),contains:(0,De._x)("Contains","text","nelio-ab-testing"),"does-not-contain":(0,De._x)("Does not contain","text","nelio-ab-testing"),"is-any-of":(0,De._x)("Is any of","text","nelio-ab-testing"),"is-none-of":(0,De._x)("Is none of","text","nelio-ab-testing")},Pi=(0,g.toPairs)(Di).map(([e,t])=>({label:t,value:e})),ki=({rules:e})=>{const{setScopeRules:t}=(0,l.useDispatch)(ze),[n]=e;return Li(n)?(0,o.jsx)(Mi,{rule:n}):(0,o.jsxs)("div",{children:[(0,o.jsx)(hi,{rules:e.filter(Vi),scopeSupport:"urls"}),(0,o.jsx)("br",{}),(0,o.jsx)("p",{children:(0,De._x)("Alternatively, you can specify where variants should be visible using PHP.","text","nelio-ab-testing")}),(0,o.jsx)(Je.Button,{variant:"secondary",onClick:()=>t([(0,b.createScopeRule)({type:"php-snippet",value:{priority:"low",snippet:"return true;",previewUrl:""}})]),children:(0,De._x)("Define Scope in PHP","command","nelio-ab-testing")})]})},Mi=({rule:e})=>{const{setScopeRules:t}=(0,l.useDispatch)(ze),n=n=>t([Object.assign(Object.assign({},e),{attributes:Object.assign(Object.assign({},e.attributes),{value:Object.assign(Object.assign({},e.attributes.value),n)})})]),{priority:i,snippet:s,errorMessage:a,warningMessage:r,previewUrl:c}=e.attributes.value,u=(0,m.usePluginSetting)("homeUrl"),d=(0,b.getLocalUrlError)(c,u);return(0,o.jsxs)("div",{className:"nab-edit-experiment-php-scope",children:[(0,o.jsx)(Ke,{className:"nab-edit-experiment-php-scope__hook",value:i,options:Bi,onChange:e=>n({priority:e})}),(0,o.jsx)("div",{className:"nab-edit-experiment-php-scope__snippet",children:(0,o.jsx)(At.CodeEditor,{language:"php",withBorder:!0,before:"function is_test_active(): bool {",value:s,after:"}",onChange:e=>n({snippet:e,errorMessage:void 0,warningMessage:void 0,validateSnippet:!0})})}),!!a&&(0,o.jsx)("p",{className:"nab-edit-experiment-php-scope__snippet-error",children:(0,De.sprintf)(/* translators: %s: Error message. */
"There’s a problem with your code: %s",a)}),!!r&&(0,o.jsx)("p",{className:"nab-edit-experiment-php-scope__snippet-error",children:(0,De.sprintf)(/* translators: %s: Error message. */
"There might be a problem with your code: %s",r)}),(0,o.jsx)(Ze,{label:(0,De._x)("Preview URL","text","nelio-ab-testing"),value:c,onChange:e=>n({previewUrl:e})}),d&&(0,o.jsx)("p",{className:"nab-edit-experiment-php-scope__preview-error",children:d})]})},Bi=[{value:"high",label:(0,De.sprintf)(/* translators: %s: Hook name. */ /* translators: %s: Hook name. */
(0,De._x)("Run on “%s”","command","nelio-ab-testing"),"plugins_loaded")},{value:"mid",label:(0,De.sprintf)(/* translators: %s: Hook name. */ /* translators: %s: Hook name. */
(0,De._x)("Run on “%s”","command","nelio-ab-testing"),"parse_query")},{value:"low",label:(0,De.sprintf)(/* translators: %s: Hook name. */ /* translators: %s: Hook name. */
(0,De._x)("Run on “%s”","command","nelio-ab-testing"),"wp")}],Gi={exact:!0,partial:!0,"partial-not-included":!0,different:!0},Vi=e=>{var t;return Gi[null!==(t=null==e?void 0:e.attributes.type)&&void 0!==t?t:""]||!1},Li=e=>"php-snippet"===(null==e?void 0:e.attributes.type),qi=()=>{const e=Ui(),t=Fi(),n=Hi(),{setScopeRules:i}=(0,l.useDispatch)(ze);if((0,p.useEffect)(()=>{"tested-post-with-consistency"===t&&n&&i([(0,b.createScopeRule)({type:"tested-post"})])},[t,n,i]),!t)return null;if(n)return null;switch(t){case"tested-post-with-consistency":return(0,o.jsx)(Je.PanelBody,{className:"nab-experiment-scope",title:(0,De._x)("Test Scope","text","nelio-ab-testing"),children:(0,o.jsx)(Ei,{rules:e})});case"tested-product-with-consistency":return(0,o.jsx)(Je.PanelBody,{className:"nab-experiment-scope",title:(0,De._x)("Test Scope","text","nelio-ab-testing"),children:(0,o.jsx)(Si,{rules:e})});case"tested-url-with-query-args":return(0,o.jsx)(Je.PanelBody,{className:"nab-experiment-scope",title:(0,De._x)("Test Scope","text","nelio-ab-testing"),children:(0,o.jsx)(Oi,{rules:e.filter(Yi)})});case"urls":case"urls-with-tested-post":return(0,o.jsx)(Je.PanelBody,{className:"nab-experiment-scope",title:(0,De._x)("Test Scope","text","nelio-ab-testing"),children:(0,o.jsx)(hi,{rules:e.filter($i),scopeSupport:t})});case"urls-or-php":return(0,o.jsx)(Je.PanelBody,{className:"nab-experiment-scope",title:(0,De._x)("Test Scope","text","nelio-ab-testing"),children:(0,o.jsx)(ki,{rules:e.filter(e=>$i(e)||zi(e))})})}},Ui=()=>c(e=>e(ze).getScope(),[]),Fi=()=>c(e=>{const{getExperimentSupport:t}=e(ke.store),{getExperimentType:n}=e(ze);return t(n(),"scope")},[]),Hi=()=>c(e=>{const t=e(ze).getAlternative("control");return!!(null==t?void 0:t.attributes.testAgainstExistingContent)},[]),Yi=e=>"tested-url-with-query-args"===e.attributes.type,Wi={exact:!0,partial:!0,"partial-not-included":!0,different:!0},$i=e=>Wi[e.attributes.type]||!1,zi=e=>"php-snippet"===e.attributes.type;const Xi=()=>{const e=Ji();return(0,o.jsx)("div",{className:"nab-edit-experiment-sidebar",style:e,children:(0,o.jsxs)("div",{className:"nab-edit-experiment-sidebar__element-wrapper",children:[(0,o.jsx)("h2",{className:"nab-edit-experiment-sidebar__section-title",children:(0,p.createInterpolateElement)((0,De.sprintf)(/* translators: %s: Dashicon. */ /* translators: %s: Dashicon. */
(0,De._x)("%s Additional Settings","text","nelio-ab-testing"),"<icon></icon>"),{icon:(0,o.jsx)(Je.Dashicon,{className:"nab-edit-experiment-sidebar__section-title-icon",icon:"admin-settings"})})}),(0,o.jsx)(vi,{}),(0,o.jsx)(xi,{}),(0,o.jsx)(qi,{})]})})},Ji=()=>c(e=>{const{getPageAttribute:t}=e(m.store),n=t("sidebarDimensions"),{applyFix:i}=n,s=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}(n,["applyFix"]);return i?s:void 0},[]),Qi=()=>{const{alternativeId:e,alternative:t}=c(e=>{const t=e(ze).getAiAlternativeModal();return t?{alternativeId:t,alternative:e(ze).getAlternative(t)}:{alternativeId:t,alternative:void 0}},[]),{showAiAlternativeModal:n}=(0,l.useDispatch)(ze),i=null==t?void 0:t.ai;return e&&i&&i.changes.length?(0,o.jsxs)(Je.Modal,{className:"nab-ai-alternative-attributes-modal",title:(0,De.sprintf)(/* translators: %s: Nelio AI. */ /* translators: %s: Nelio AI. */
(0,De._x)("%s – Variant Details","text","nelio-ab-testing"),"Nelio AI"),isDismissible:!0,onRequestClose:()=>n(void 0),shouldCloseOnClickOutside:!1,children:[(0,o.jsx)("p",{children:(0,De.sprintf)(/* translators: %s: Variant name. */ /* translators: %s: Variant name. */
(0,De._x)("Apply these AI-recommended changes to “%s” to make it stand out from the control:","user","nelio-ab-testing"),i.name)}),(0,o.jsx)("ol",{children:i.changes.map((e,t)=>(0,o.jsx)("li",{children:e},t))})]}):null},Ki=({alternativeId:e,disabled:t,index:n})=>{const i=ts("control"),s=ts(e),a=as(n),r=ns(),c=Zi(),u=rs(n),d=is(),g=os(),m=!n,v=pt(),x=es(s),h=ls(s,i),_=cs(s,i),{saveExperimentAndEditAlternative:y,saveExperimentAndPreviewAlternative:f,removeAlternatives:j,replaceAlternatives:E,setAlternative:A,showAiAlternativeModal:S}=(0,l.useDispatch)(ze);if(!s||!i)return null;const w=e=>A(s.id,Object.assign(Object.assign({},s),{attributes:(0,b.omitUndefineds)(Object.assign(Object.assign({},s.attributes),e))}));return(0,o.jsxs)("div",{className:vn(["nab-alternative-list__alternative",{"nab-alternative-list__alternative--original":m}]),children:[(0,o.jsx)("p",{className:vn(["nab-alternative-list__alternative-letter",{"nab-alternative-list__alternative-letter--disabled":0<n&&t}]),children:(0,b.getLetter)(n)}),(0,o.jsxs)("div",{className:"nab-alternative-list__alternative-edit",children:[(0,o.jsx)(a,{attributes:s.attributes,disabled:t,experimentType:c,setAttributes:w,ai:s.ai}),!!s.ai&&(0,o.jsx)("div",{className:"nab-alternative-list__alternative-ai-changes",children:(0,o.jsx)(Qe,{checked:s.ai.isReady,onChange:e=>A(s.id,Object.assign(Object.assign({},s),{ai:s.ai?Object.assign(Object.assign({},s.ai),{isReady:e}):void 0})),label:(0,p.createInterpolateElement)((0,De._x)("I’ve already applied all <a>Nelio AI’s recommended changes</a> to this variant","text","nelio-ab-testing"),{a:(0,o.jsx)(Je.Button,{variant:"link",disabled:t||d,onClick:()=>S(s.id)})})})}),0!==n&&(0,o.jsxs)("ul",{className:"nab-alternative-list__alternative-actions",children:[_.map(e=>!e.isVisible||e.isVisible(s.attributes,i.attributes)?(0,o.jsx)("li",{children:(0,o.jsx)(Je.Button,{variant:"link",disabled:t||d||e.isEnabled&&!e.isEnabled(s.attributes,i.attributes),onClick:()=>e.onClick(s.attributes,w,i.attributes),children:e.label})},`custom-action-${e.id}`):null),g&&(0,o.jsx)("li",{children:(0,o.jsx)(Je.Button,{variant:"link",disabled:t||d,onClick:()=>{y(e)},children:(0,De._x)("Edit","command","nelio-ab-testing")})}),(0,o.jsx)("li",{children:(0,o.jsx)(Je.Button,{variant:"link",disabled:t||d||h,onClick:()=>{f(e)},children:(0,De._x)("Preview","command","nelio-ab-testing")})}),g&&!s.base&&v&&(0,o.jsx)("li",{children:(0,o.jsx)(Je.Button,{variant:"link",disabled:t||d,onClick:x,children:(0,De._x)("Duplicate","command","nelio-ab-testing")})}),g&&(0,o.jsx)("li",{children:(0,o.jsx)(Je.Button,{variant:"link",disabled:t||d,onClick:()=>{var t;return E(e,Object.assign(Object.assign({},(0,b.createAlternative)()),{attributes:{name:(null===(t=s.ai)||void 0===t?void 0:t.name)||""},ai:s.ai?Object.assign(Object.assign({},s.ai),{isReady:!1}):void 0}))},children:(0,De._x)("Reset","command","nelio-ab-testing")})}),r&&(0,o.jsx)("li",{children:(0,o.jsx)(Je.Button,{variant:"link",isDestructive:!0,disabled:t||d,onClick:()=>j(s.id),children:(0,De._x)("Delete","command","nelio-ab-testing")})})]})]}),(0,o.jsx)("div",{className:"nab-alternative-list__alternative-help",children:!!u&&(0,o.jsx)(At.HelpIcon,{text:u})})]})},Zi=()=>c(e=>e(ze).getExperimentType(),[]),es=e=>{const t=c(e=>e(ze).getAlternatives(),[]),{replaceAlternatives:n}=(0,l.useDispatch)(ze);return e?()=>{n(t.map(e=>e.id),[...t,(0,b.duplicateAlternative)(e)])}:()=>{}},ts=e=>{const[t,n]=(0,p.useState)(!1),i=(()=>{const e=Zi();return c(t=>{var n;return null===(n=t(ke.store).getExperimentType(e))||void 0===n?void 0:n.defaults},[e])})(),s=c(t=>t(ze).getAlternative(e),[e]),{setAlternative:a}=(0,l.useDispatch)(ze);return(0,p.useEffect)(()=>{if(t)return;if(!i||!s)return;const e="control"===s.id?i.original:i.alternative;a(s.id,Object.assign(Object.assign({},s),{attributes:Object.assign(Object.assign({},e),s.attributes)})),n(!0)},[i,s,t,a]),t?s:void 0},ns=()=>{const[e]=ct("status");return c(t=>{const{getAlternativeIds:n}=t(ze),i=(e||"").includes("paused");return n().length>2&&!i},[e])},is=()=>c(e=>e(ze).isExperimentBeingSaved(),[]),ss=()=>(0,o.jsx)(o.Fragment,{}),as=e=>c(t=>{const{getExperimentView:n}=t(ke.store),{getExperimentType:i}=t(ze),s=n(i(),e?"alternative":"original");return null!=s?s:ss},[e]),rs=e=>c(t=>{const{getExperimentType:n}=t(ze),{getHelpString:i}=t(ke.store);return 0===e?i(n(),"original"):1===e?i(n(),"alternative"):""},[e]),os=()=>{const e=Zi(),t=c(e=>e(ze).getAlternative("control"),[]);return c(n=>{const{getExperimentSupport:i}=n(ke.store),s=i(e,"alternativeEdition");return"external"===(null==s?void 0:s.type)&&("function"!=typeof s.enabled||!!t&&s.enabled(t.attributes))},[e,t])},ls=(e,t)=>c(n=>{var i,s;const{getExperimentType:a}=n(ke.store),r=a(n(ze).getExperimentType());return!!(r&&e&&t)&&!!(null===(s=(i=r.checks).isAlternativePreviewDisabled)||void 0===s?void 0:s.call(i,e.attributes,t.attributes,n))},[t,e]),cs=(e,t)=>c(n=>{var i;const{getExperimentType:s}=n(ke.store),a=s(n(ze).getExperimentType());return a&&e&&t&&null!==(i=a.supports.alternativeCustomActions)&&void 0!==i?i:[]},[t,e]),us=()=>{const{closeAlternativePreviewer:e}=(0,l.useDispatch)(ze),t=c(e=>e(ze).getAlternativePreviewerUrl(),[]);return t?(0,o.jsx)(Je.Modal,{className:"nab-alternative-previewer",title:(0,De._x)("Alternative Preview","text","nelio-ab-testing"),isDismissible:!0,onRequestClose:e,shouldCloseOnClickOutside:!1,children:(0,o.jsx)("iframe",{className:"nab-alternative-previewer__iframe",title:(0,De._x)("Alternative Preview Frame","text","nelio-ab-testing"),src:t})}):null},ds=()=>{const[e,...t]=ps(),n=gs(),i=ms(),s=vs(),a=pt();return(0,o.jsxs)("div",{className:"nab-edit-experiment__alternative-section",children:[(0,o.jsx)("h2",{children:(0,p.createInterpolateElement)((0,De.sprintf)(/* translators: %s: Dashicon. */ /* translators: %s: Dashicon. */
(0,De._x)("%s Control Version and Variants","text","nelio-ab-testing"),"<icon></icon>"),{icon:(0,o.jsx)(Je.Dashicon,{className:"nab-alternative-section__title-icon",icon:"randomize"})})}),(0,o.jsxs)("div",{className:"nab-alternative-list",children:[!!e&&(0,o.jsx)(Ki,{index:0,alternativeId:"control",disabled:i},"control"),(0,o.jsx)(At.AnimatedList,{disableAnimations:s,exit:500,children:t.map((e,t)=>(0,o.jsx)(Ki,{index:t+1,alternativeId:e,disabled:i},e))})]}),(0,o.jsx)("div",{className:"nab-edit-experiment-alternative-section__new-variant-container",children:a&&(0,o.jsx)(Je.Button,{variant:"secondary",disabled:i,onClick:()=>n(),children:(0,De._x)("New Variant","command","nelio-ab-testing")},"new-variant")}),(0,o.jsx)(us,{}),(0,o.jsx)(Qi,{})]})},ps=()=>c(e=>e(ze).getAlternativeIds(),[]),gs=()=>{const{addAlternatives:e}=(0,l.useDispatch)(ze);return()=>e((0,b.createAlternative)())},ms=()=>c(e=>e(ze).isTestedElementInvalid(),[]),vs=()=>{const e=ps(),[t,n]=(0,p.useState)(e);if((0,p.useEffect)(()=>{e!==t&&n(e)},[e,t]),e===t)return!1;const i=(0,g.difference)(e,t),s=(0,g.difference)(t,e);return!!i.length&&!!s.length},bs=()=>{const e=xs(),{removeNotice:t}=(0,l.useDispatch)(Pe.store);return(0,o.jsxs)("div",{className:"nab-edit-experiment-layout",children:[(0,o.jsx)(mt,{}),(0,o.jsx)(Nt,{}),(0,o.jsxs)("div",{className:"nab-edit-experiment-layout__body",children:[(0,o.jsxs)("div",{className:"nab-edit-experiment-layout__content",role:"region","aria-label":(0,De._x)("Editor content","text","nelio-ab-testing"),tabIndex:-1,children:[!(0,b.isEmpty)(e)&&(0,o.jsx)(Je.NoticeList,{className:"nab-edit-experiment-layout__notices",notices:e,onRemove:t}),(0,o.jsx)(Bt,{}),(0,o.jsx)(ds,{}),(0,o.jsx)(jn,{}),(0,o.jsx)(Jn,{})]}),(0,o.jsx)(Xi,{})]})]})},xs=()=>c(e=>e(Pe.store).getNotices(),[]),hs=({experimentId:e})=>{const t=c(t=>t(m.store).getExperiment(e),[e]);return(0,o.jsx)(p.StrictMode,{children:(0,o.jsx)(Xe,{experiment:t,children:(0,o.jsx)(bs,{})})})};function _s(e,t){const n=document.getElementById(e);var i,s;n?((0,v.registerCoreExperiments)(),i=(0,o.jsx)(hs,{experimentId:t}),(s=n)&&(p.createRoot?(0,p.createRoot)(s).render(i):(0,p.render)(i,s))):console.warn(`Unable to find container node ${e}.`)}function ys(){const e=window.innerHeight,t=document.getElementById("wpadminbar"),n=t?t.getBoundingClientRect().height:0,{setPageAttribute:i}=(0,l.dispatch)(m.store);i("sidebarDimensions",{top:n,height:e-n+"px",applyFix:782<=window.innerWidth})}window.addEventListener("resize",(0,g.debounce)(ys,100)),d(ys)}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,i),a.exports}e=[],i.O=(t,n,s,a)=>{if(!n){var r=1/0;for(u=0;u<e.length;u++){for(var[n,s,a]=e[u],o=!0,l=0;l<n.length;l++)(!1&a||r>=a)&&Object.keys(i.O).every(e=>i.O[e](n[l]))?n.splice(l--,1):(o=!1,a<r&&(r=a));if(o){e.splice(u--,1);var c=s();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,s,a]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s=i.O(void 0,[117],()=>i(8788));s=i.O(s);var a=nab="undefined"==typeof nab?{}:nab;for(var r in s)a[r]=s[r];s.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})})();