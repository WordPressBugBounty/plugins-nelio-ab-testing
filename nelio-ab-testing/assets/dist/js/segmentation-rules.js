(()=>{var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{segmentationRules:()=>o});var n={};e.r(n),e.d(n,{getSegmentationRuleType:()=>u,getSegmentationRuleTypeCategories:()=>c,getSegmentationRuleTypeCategory:()=>l,getSegmentationRuleTypes:()=>s});var r={};e.r(r),e.d(r,{addSegmentationRuleTypeCategories:()=>d,addSegmentationRuleTypes:()=>g,removeSegmentationRuleTypeCategories:()=>y,removeSegmentationRuleTypes:()=>m});var o={};e.r(o),e.d(o,{createSegmentationRule:()=>h,registerSegmentationRuleType:()=>O,registerSegmentationRuleTypeCategory:()=>_,store:()=>f});const a=window.wp.data,i=window.lodash,s=(0,a.createSelector)(e=>(0,i.values)(e.segmentationRuleTypes),e=>[e.segmentationRuleTypes]),u=function(e,t){return e.segmentationRuleTypes[t]},c=(0,a.createSelector)(e=>(0,i.values)(e.categories),e=>[e.categories]);function l(e,t){return e.categories[t]}function g(e){return{type:"ADD_SEGMENTATION_RULE_TYPES",segmentationRuleTypes:(0,i.castArray)(e)}}function m(e){return{type:"REMOVE_SEGMENTATION_RULE_TYPES",names:(0,i.castArray)(e)}}function d(e){return{type:"ADD_SEGMENTATION_RULE_TYPE_CATEGORIES",categories:(0,i.castArray)(e)}}function y(e){return{type:"REMOVE_SEGMENTATION_RULE_TYPE_CATEGORIES",names:(0,i.castArray)(e)}}const p={segmentationRuleTypes:{},categories:{}},f=(0,a.createReduxStore)("nab/segmentation-rules",{reducer:function(e=p,t){var n;return null!==(n=function(e,t){switch(t.type){case"ADD_SEGMENTATION_RULE_TYPES":{const n=t.segmentationRuleTypes.filter(t=>!(0,i.isEqual)(e.segmentationRuleTypes[t.name],t));return n.length?Object.assign(Object.assign({},e),{segmentationRuleTypes:Object.assign(Object.assign({},e.segmentationRuleTypes),(0,i.keyBy)(n,"name"))}):e}case"REMOVE_SEGMENTATION_RULE_TYPES":{const n=(0,i.omit)(e.segmentationRuleTypes,t.names);return(0,i.isEqual)(e.segmentationRuleTypes,n)?e:Object.assign(Object.assign({},e),{segmentationRuleTypes:n})}case"ADD_SEGMENTATION_RULE_TYPE_CATEGORIES":{const n=t.categories.filter(t=>!(0,i.isEqual)(e.categories[t.name],t));return n.length?Object.assign(Object.assign({},e),{categories:Object.assign(Object.assign({},e.categories),(0,i.keyBy)(n,"name"))}):e}case"REMOVE_SEGMENTATION_RULE_TYPE_CATEGORIES":{const n=(0,i.omit)(e.categories,t.names);return(0,i.isEqual)(e.categories,n)?e:Object.assign(Object.assign({},e),{categories:n})}}}(e,t))&&void 0!==n?n:e},selectors:n,actions:r});!function(e){(0,a.register)(e)}(f);const T={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let E;const S=new Uint8Array(16),R=[];for(let e=0;e<256;++e)R.push((e+256).toString(16).slice(1));const b=function(e,t,n){if(T.randomUUID&&!t&&!e)return T.randomUUID();const r=(e=e||{}).random??e.rng?.()??function(){if(!E){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");E=crypto.getRandomValues.bind(crypto)}return E(S)}();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return(R[e[t+0]]+R[e[t+1]]+R[e[t+2]]+R[e[t+3]]+"-"+R[e[t+4]]+R[e[t+5]]+"-"+R[e[t+6]]+R[e[t+7]]+"-"+R[e[t+8]]+R[e[t+9]]+"-"+R[e[t+10]]+R[e[t+11]]+R[e[t+12]]+R[e[t+13]]+R[e[t+14]]+R[e[t+15]]).toLowerCase()}(r)};function h(e,t){const{getSegmentationRuleType:n}=(0,a.select)(f),r=n(e);if(r)return{id:b(),type:e,attributes:Object.assign(Object.assign({},r.attributes),t||{})}}const v=window.nab.utils;function O(e,t){if("string"!=typeof e)return void console.error("Segmentation rule names must be strings.");if(!/^[a-z][a-z0-9-]*\/[a-z][a-z0-9-]*$/.test(e))return void console.error("Segmentation rule names must contain a namespace prefix, include only lowercase alphanumeric characters or dashes, and start with a letter. Example: my-plugin/my-custom-segmentation-rule");if((0,a.select)(f).getSegmentationRuleType(e))return void console.error(`Segmentation rule “${e}” is already registered.`);if(!w(t))return void console.error(`Segmentation rule “${e}” should specify its default attributes.`);if(!j(t))return void console.error(`Segmentation rule “${e}” must have an icon.`);if(!(0,v.isValidIcon)(t.icon))return void console.error("The icon passed is invalid. The icon should be an element or a function.");if(!A(t))return void console.error("The “view” property must be a valid function.");if(!U(t))return void console.error("The “edit” property must be a valid function.");if(!N(t))return void console.error(`Segmentation rule “${e}” must have a title.`);if(!I(t))return void console.error(`Segmentation rule “${e}” must have a category.`);if(!M(t))return void console.error(`Segmentation rule “${e}” must specify whether it’s singleton or not.`);const n=Object.assign({name:e},t);return(0,a.dispatch)(f).addSegmentationRuleTypes(n),n}function _(e,t){const n=Object.assign({name:e},t);if("string"==typeof e)if(/^[a-z][a-z0-9-]*\/[a-z][a-z0-9-]*$/.test(e))if((0,a.select)(f).getSegmentationRuleTypeCategory(e))console.error(`Segmentation rule category “${e}” is already registered.`);else if(j(n))if((0,v.isValidIcon)(n.icon)){if(N(n))return(0,a.dispatch)(f).addSegmentationRuleTypeCategories(n),n;console.error(`Segmentation rule category “${e}” must have a title.`)}else console.error("The icon passed is invalid. The icon should be an element or a function.");else console.error(`Segmentation rule category “${e}” must have an icon.`);else console.error("Segmentation rule category names must contain a namespace prefix, include only lowercase alphanumeric characters or dashes, and start with a letter. Example: my-plugin/my-custom-segmentation-rule-category");else console.error("Segmentation rule category names must be strings.")}const w=e=>!!e.attributes,j=e=>"icon"in e,A=e=>(0,i.isFunction)(e.view),U=e=>(0,i.isFunction)(e.edit),I=e=>!!e.category,M=e=>void 0!==e.singleton&&"boolean"==typeof e.singleton,N=e=>!!e.title})();var n=nab="undefined"==typeof nab?{}:nab;for(var r in t)n[r]=t[r];t.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();