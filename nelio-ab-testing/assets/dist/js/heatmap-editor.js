(()=>{var e,t={8290(e,t,n){"use strict";n.r(t),n.d(t,{heatmapEditor:()=>r});var i={};n.r(i),n.d(i,{getActiveGoal:()=>Q,getActiveGoalIndex:()=>K,getActiveSegment:()=>Z,getActiveSegmentIndex:()=>ee,getAiAlternativeModal:()=>ie,getAlternative:()=>W,getAlternativeIds:()=>z,getAlternativePreviewerUrl:()=>ne,getAlternatives:()=>Y,getConversionActions:()=>X,getDraftStatusRationale:()=>te,getExperimentAttribute:()=>re,getExperimentId:()=>se,getExperimentType:()=>ae,getGoals:()=>le,getHeatmapAttribute:()=>oe,getScope:()=>de,getSegmentEvaluation:()=>pe,getSegmentationRules:()=>ge,getSegments:()=>ue,hasExperimentBeenRecentlySaved:()=>J,isExperimentBeingSaved:()=>$,isTestedElementInvalid:()=>ce});var s={};n.r(s),n.d(s,{addAlternatives:()=>me,addConversionActionsIntoGoal:()=>_e,addGoals:()=>Ce,addSegmentationRulesIntoSegment:()=>Ve,addSegments:()=>Ue,closeAlternativePreviewer:()=>Ne,openAlternativePreviewer:()=>he,removeAlternatives:()=>be,removeConversionActionsFromGoal:()=>ye,removeGoals:()=>Me,removeSegmentationRulesFromSegment:()=>He,removeSegments:()=>Ge,replaceAlternatives:()=>ve,replaceConversionActionsInGoal:()=>xe,replaceSegmentationRulesInSegment:()=>qe,setActiveGoal:()=>fe,setActiveSegment:()=>je,setAlternative:()=>Ee,setDraftStatusRationale:()=>Te,setExperimentAsBeingSaved:()=>Ie,setExperimentAsRecentlySaved:()=>Se,setExperimentData:()=>we,setHeatmapData:()=>De,setScopeRules:()=>Le,setSegmentEvaluation:()=>We,setTestedElementAsInvalid:()=>Pe,setupEditor:()=>Oe,showAiAlternativeModal:()=>Re,updateConversionAction:()=>Ae,updateGoal:()=>ke,updateSegment:()=>Be,updateSegmentationRule:()=>Fe});var a={};n.r(a),n.d(a,{moveToTrash:()=>it,resumeExperiment:()=>at,saveExperiment:()=>et,saveExperimentAndEditAlternative:()=>tt,saveExperimentAndPreviewAlternative:()=>nt,startExperiment:()=>st});var r={};n.r(r),n.d(r,{initializeExperimentEditor:()=>Tt});const o=window.ReactJSXRuntime,c=window.wp.element,l=window.wp.data;function d(e,t){return(0,l.useSelect)(e,t)}const u=window.wp.domReady,g=n.n(u)(),p=window.lodash,m=window.nab.editor,b=window.nab.data,v=window.nab.experimentLibrary,E=window.wp.components,_=(Object.assign(e=>(0,o.jsx)(E.BaseControl,Object.assign({__nextHasNoMarginBottom:!0},e)),E.BaseControl),Object.assign(e=>(0,o.jsx)(E.CheckboxControl,Object.assign({__nextHasNoMarginBottom:!0},e)),E.CheckboxControl)),x=(Object.assign(e=>(0,o.jsx)(E.FormTokenField,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),E.FormTokenField),Object.assign(e=>(0,o.jsx)(E.RangeControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),E.RangeControl),e=>(0,o.jsx)(E.SelectControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e))),y=Object.assign(e=>(0,o.jsx)(E.TextControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),E.TextControl),A=(Object.assign(e=>(0,o.jsx)(E.TextareaControl,Object.assign({__nextHasNoMarginBottom:!0},e)),E.TextareaControl),Object.assign(e=>(0,o.jsx)(E.ToggleControl,Object.assign({__nextHasNoMarginBottom:!0},e)),E.ToggleControl),Object.assign(e=>(0,o.jsx)(E.__experimentalToggleGroupControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),E.__experimentalToggleGroupControl),window.wp.i18n),O=window.wp.notices,f=window.nab.utils,j=window.nab.date,I=window.nab.segmentationRules,T=()=>{const e=S(),t=h(),n=e.status.includes("paused"),i=N();return(0,c.useEffect)(()=>{const s=e.homeUrl,a=e.mode,r=e.name,o=e.participationConditions,c=e.postId,l=e.postType,d=e.startDate,u=e.status,g=e.url;if("running"===u)return;if((0,f.isEmpty)(r))return void t(n?"paused_draft":"draft",(0,A._x)("Please name your Heatmap test","user","nelio-ab-testing"));if("post"===a&&!c)switch(l){case"product":return void t(n?"paused_draft":"draft",(0,A._x)("Please select the product to track","user","nelio-ab-testing"));case"post":return void t(n?"paused_draft":"draft",(0,A._x)("Please select the post to track","user","nelio-ab-testing"));case"page":return void t(n?"paused_draft":"draft",(0,A._x)("Please select the page to track","user","nelio-ab-testing"));default:return void t(n?"paused_draft":"draft",(0,A._x)("Please select a page to track","user","nelio-ab-testing"))}if("url"===a&&(0,f.getLocalUrlError)(g,s))return void t(n?"paused_draft":"draft",(0,f.getLocalUrlError)(g,s)||"");const p=o.reduce((e,t)=>e||i(t),void 0);p?t(n?"paused_draft":"draft",p):"scheduled"!==u||!d||(0,j.isInTheFuture)(d)?"scheduled"!==u&&t(n?"paused":"ready"):t(n?"paused":"ready")},[e.homeUrl,e.mode,e.name,e.participationConditions,e.postId,e.postType,e.startDate,e.status,e.url,n,t,i]),null},S=()=>d(e=>{var t,n,i,s,a;const{getPluginSetting:r}=e(b.store),{getExperimentAttribute:o,getHeatmapAttribute:c}=e(m.store);return{homeUrl:r("homeUrl"),mode:null!==(t=c("trackingMode"))&&void 0!==t?t:"post",name:o("name"),participationConditions:null!==(n=c("participationConditions"))&&void 0!==n?n:[],postId:null!==(i=c("trackedPostId"))&&void 0!==i?i:0,postType:null!==(s=c("trackedPostType"))&&void 0!==s?s:"page",startDate:o("startDate"),status:o("status"),url:null!==(a=c("trackedUrl"))&&void 0!==a?a:""}},[]),h=()=>{const{setDraftStatusRationale:e,setExperimentData:t}=(0,l.useDispatch)(m.store);return(0,c.useCallback)((n,i)=>{t({status:n}),e(null!=i?i:"")},[t,e])},N=()=>{const e=d(e=>(0,p.keyBy)(e(I.store).getSegmentationRuleTypes()||[],"name"),[]);return(0,c.useCallback)(t=>{var n,i,s,a;const r=null!==(s=null===(i=null===(n=e[t.type])||void 0===n?void 0:n.validate)||void 0===i?void 0:i.call(n,t.attributes))&&void 0!==s?s:{};return null!==(a=(0,p.values)(r)[0])&&void 0!==a?a:""},[e])},R=window.nab.components,w=({className:e,postId:t,postType:n,setAttributes:i})=>{const s=D().map(e=>({value:e.name,label:e.labels.singular_name})),a=n||"page";return(0,o.jsxs)("div",{className:e,children:[(0,o.jsx)(x,{className:`${e}-type-selector`,value:a,options:s,onChange:e=>i({postId:0,postType:e})}),(0,o.jsx)(R.PostSearcher,{className:`${e}-selector`,type:a,value:t,perPage:10,onChange:e=>i({postId:e,postType:a})})]})},D=()=>{const e=d(e=>e(b.store).getKindEntities(),[]);return((0,f.isEmpty)(e)?P:e).filter(e=>"entity"===e.kind).filter(e=>"attachment"!==e.name)},P=[{kind:"entity",name:"page",label:(0,A._x)("Pages","text","nelio-ab-testing"),labels:{singular_name:(0,A._x)("Page","text","nelio-ab-testing")}},{kind:"entity",name:"post",label:(0,A._x)("Posts","text","nelio-ab-testing"),labels:{singular_name:(0,A._x)("Post","text","nelio-ab-testing")}}],C=()=>{const[e,t]=M(),{mode:n,postId:i,postType:s,url:a,urlError:r}=e;return(0,o.jsxs)("div",{className:"nab-edit-experiment__alternative-section",children:[(0,o.jsx)("h2",{children:(0,c.createInterpolateElement)((0,A.sprintf)(/* translators: %s: Dashicon. */ /* translators: %s: Dashicon. */
(0,A._x)("%s WordPress Page","text","nelio-ab-testing"),"<icon></icon>"),{icon:(0,o.jsx)(E.Dashicon,{className:"nab-alternative-section__title-icon",icon:"welcome-view-site"})})}),(0,o.jsxs)("div",{className:"nab-tracked-element",children:["url"!==n?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"nab-tracked-element__p",children:(0,A._x)("Select the page you want to generate a heatmap for:","user","nelio-ab-testing")}),(0,o.jsx)(w,{className:"nab-tracked-element__post",postId:null!=i?i:0,postType:s,setAttributes:t})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"nab-tracked-element__p",children:(0,A._x)("Type in the URL of the page you want to generate a heatmap for:","user","nelio-ab-testing")}),(0,o.jsxs)("div",{className:"nab-tracked-element__url",children:[(0,o.jsx)(y,{className:"nab-tracked-element__url-value",value:a,onChange:e=>t({url:e}),placeholder:(0,A._x)("URL…","text","nelio-ab-testing")}),(0,o.jsx)("div",{className:"nab-tracked-element__url-preview",children:r?(0,o.jsx)("span",{children:(0,A._x)("View","command","nelio-ab-testing")}):(0,o.jsx)(E.ExternalLink,{className:"components-button is-secondary",href:a,children:(0,A._x)("View","command","nelio-ab-testing")})})]}),!!r&&(0,o.jsx)("div",{className:"nab-tracked-element__p",children:(0,o.jsx)(R.ErrorText,{value:r})})]}),(0,o.jsx)("div",{className:"nab-tracked-element__p",children:(0,o.jsx)(_,{className:"nab-tracked-element__mode",label:(0,A._x)("Track heatmap of a page specified using its URL.","command","nelio-ab-testing"),checked:"url"===n,onChange:e=>t({mode:e?"url":"post"})})})]})]})},M=()=>{const e=d(e=>{const{getPluginSetting:t}=e(b.store),{getHeatmapAttribute:n}=e(m.store),i=n("trackedUrl")||"",s=t("homeUrl");return{mode:n("trackingMode")||"post",postId:n("trackedPostId")||void 0,postType:n("trackedPostType")||"page",url:i,urlError:(0,f.getLocalUrlError)(i,s)}},[]),{setHeatmapData:t}=(0,l.useDispatch)(m.store);return[e,n=>{var i,s,a,r;t({trackingMode:null!==(i=n.mode)&&void 0!==i?i:e.mode,trackedPostId:null!==(s=n.postId)&&void 0!==s?s:e.postId,trackedPostType:null!==(a=n.postType)&&void 0!==a?a:e.postType,trackedUrl:null!==(r=n.url)&&void 0!==r?r:e.url})}]},k={alternatives:{byId:{control:{id:"control",attributes:{},links:{edit:"",heatmap:"",preview:""}}},allIds:[]},conversionActions:{},data:{id:0,type:"",status:"draft",name:"",description:"",startDate:"",endDate:"",endMode:"manual",endValue:0,autoAlternativeApplication:!1,isTestedElementInvalid:!1,links:{edit:"",preview:""}},goals:{},scope:{},segmentation:{evaluation:"tested-page",rules:{},segments:{}}},L={activeGoalId:"",activeSegmentId:"",aiAlternativeModal:void 0,alternativePreviewerUrl:"",draftStatusRationale:"",hasExperimentBeenRecentlySaved:!1,isExperimentBeingSaved:!1},U=k.alternatives,G=k.conversionActions,B=k.data,V=k.goals,q=k.scope,H=k.segmentation,F=(0,l.combineReducers)({editor:function(e=L,t){var n;return null!==(n=function(e,t){switch(t.type){case"SET_ACTIVE_GOAL":return Object.assign(Object.assign({},e),{activeGoalId:t.goalId});case"SET_ACTIVE_SEGMENT":return Object.assign(Object.assign({},e),{activeSegmentId:t.segmentId});case"SET_EXPERIMENT_AS_BEING_SAVED":return Object.assign(Object.assign({},e),{isExperimentBeingSaved:!!t.status});case"SET_EXPERIMENT_AS_RECENTLY_SAVED":return Object.assign(Object.assign({},e),{hasExperimentBeenRecentlySaved:!0});case"SET_DRAFT_STATUS_RATIONALE":return(0,p.isEqual)(e.draftStatusRationale,t.rationale)?e:Object.assign(Object.assign({},e),{draftStatusRationale:t.rationale});case"OPEN_ALTERNATIVE_PREVIEWER":return Object.assign(Object.assign({},e),{alternativePreviewerUrl:t.url});case"CLOSE_ALTERNATIVE_PREVIEWER":return Object.assign(Object.assign({},e),{alternativePreviewerUrl:""});case"SHOW_AI_ALTERNATIVE_MODAL":return Object.assign(Object.assign({},e),{aiAlternativeModal:t.alternativeId});case"SETUP_EDITOR":return e}}(e=Object.assign(Object.assign({},e),{hasExperimentBeenRecentlySaved:!1}),t))&&void 0!==n?n:e},experiment:(0,l.combineReducers)({alternatives:function(e=U,t){var n;return null!==(n=function(e,t){switch(t.type){case"ADD_ALTERNATIVES":{const n=t.alternatives.filter(t=>!(0,p.isEqual)(e.byId[t.id],t));return n.length?{byId:Object.assign(Object.assign({},e.byId),(0,p.keyBy)(n,"id")),allIds:[...e.allIds,...(0,p.map)(n,"id")]}:e}case"REMOVE_ALTERNATIVES":{const n=Object.assign({control:e.byId.control},(0,p.omit)(e.byId,t.ids)),i=(0,p.difference)(e.allIds,t.ids.filter(e=>"control"!==e));return(0,p.isEqual)(e.byId,n)&&(0,p.isEqual)(e.allIds,i)?e:{byId:n,allIds:i}}case"REPLACE_ALTERNATIVES":{const n=(0,p.zip)(t.oldIds,(0,p.map)(t.alternatives,"id")),i=Object.assign(Object.assign({control:e.byId.control},(0,p.omit)(e.byId,t.oldIds)),(0,p.keyBy)(t.alternatives,"id")),s=[...e.allIds.map(e=>{const t=n.find(t=>t[0]===e);return t?t[1]:e}).filter(f.isDefined),...n.filter(e=>!e[0]).map(e=>e[1]).filter(f.isDefined)],a=e.byId,r=i,o=Object.values(a).map(e=>(0,p.omit)(e,"id")),c=Object.values(r).map(e=>(0,p.omit)(e,"id"));return(0,p.isEqual)(o,c)?e:{byId:i,allIds:s}}case"SET_ALTERNATIVE":const n=e.byId[t.id];if(!n)return e;const i=t.alternative;return i?(0,p.isEqual)(n,i)?e:Object.assign(Object.assign({},e),{byId:Object.assign(Object.assign({},e.byId),{[t.id]:i})}):e;case"SETUP_EDITOR":{if("nab/heatmap"===t.experiment.type)return U;const n={byId:Object.assign({control:e.byId.control},(0,p.keyBy)(t.experiment.alternatives,"id")),allIds:(0,p.map)(t.experiment.alternatives,"id")};return(0,p.isEqual)(e,n)?e:n}}}(e,t))&&void 0!==n?n:e},conversionActions:function(e=G,t){var n;return null!==(n=function(e,t){var n;switch(t.type){case"ADD_CONVERSION_ACTIONS_INTO_GOAL":{const n=t.conversionActions.filter(n=>{var i;return!(0,p.isEqual)(null===(i=e[t.goalId])||void 0===i?void 0:i[n.id],n)});return n.length?Object.assign(Object.assign({},e),{[t.goalId]:Object.assign(Object.assign({},e[t.goalId]),(0,p.keyBy)(n,"id"))}):e}case"REPLACE_CONVERSION_ACTIONS_IN_GOAL":{const i=null!==(n=e[t.goalId])&&void 0!==n?n:{},s=(0,p.keyBy)(t.conversionActions,"id"),a=Object.values(i).map(e=>(0,p.omit)(e,"id")),r=Object.values(s).map(e=>(0,p.omit)(e,"id"));return(0,p.isEqual)(a,r)?e:Object.assign(Object.assign({},e),{[t.goalId]:s})}case"UPDATE_CONVERSION_ACTION":{const n=e[t.goalId];if(!n)return e;const i=n[t.conversionActionId];if(!i)return e;const s=Object.assign(Object.assign({},i),{attributes:t.attributes?Object.assign(Object.assign({},i.attributes),t.attributes):i.attributes,scope:t.scope?t.scope:i.scope});return(0,p.isEqual)(i,s)?e:Object.assign(Object.assign({},e),{[t.goalId]:Object.assign(Object.assign({},n),{[t.conversionActionId]:s})})}case"REMOVE_CONVERSION_ACTIONS_FROM_GOAL":{const n=(0,p.omit)(e[t.goalId],t.conversionActionIds);return(0,p.isEqual)(e[t.goalId],n)?e:Object.assign(Object.assign({},e),{[t.goalId]:n})}case"SETUP_EDITOR":{if("nab/heatmap"===t.experiment.type)return f.EMPTY_OBJECT;const n=t.experiment.goals.reduce((e,t)=>(e[t.id]=(0,p.keyBy)(t.conversionActions,"id"),e),{});return(0,p.isEqual)(e,n)?e:n}}}(e,t))&&void 0!==n?n:e},data:function(e=B,t){var n;return null!==(n=function(e,t){switch(t.type){case"UPDATE_EXPERIMENT_DATA":{const n=Object.assign(Object.assign({},e),t.attributes);return(0,p.isEqual)(e,n)?e:n}case"SET_TESTED_ELEMENT_AS_INVALID":return Object.assign(Object.assign({},e),{isTestedElementInvalid:!!t.invalid});case"SETUP_EDITOR":{const n=Object.assign(Object.assign({},e),(0,p.omit)(t.experiment,["alternatives","goals","scope","segments"]));return(0,p.isEqual)(e,n)?e:n}}}(e,t))&&void 0!==n?n:e},goals:function(e=V,t){var n;return null!==(n=function(e,t){switch(t.type){case"ADD_GOALS":{const n=t.goals.filter(t=>!(0,p.isEqual)(e[t.id],t));return n.length?Object.assign(Object.assign({},e),(0,p.keyBy)(n,"id")):e}case"UPDATE_GOAL":{const n=e[t.goalId];if(!n)return e;const i=Object.assign(Object.assign({},n),{attributes:Object.assign(Object.assign({},n.attributes),t.attributes)});return(0,p.isEqual)(n,i)?e:Object.assign(Object.assign({},e),{[t.goalId]:i})}case"REMOVE_GOALS":return(0,p.omit)(e,t.ids);case"SETUP_EDITOR":if("nab/heatmap"===t.experiment.type)return f.EMPTY_OBJECT;const n=(0,p.keyBy)(t.experiment.goals.map(e=>(0,p.omit)(e,"conversionActions")),"id");return(0,p.isEqual)(e,n)?e:n}}(e,t))&&void 0!==n?n:e},scope:function(e=q,t){var n;return null!==(n=function(e,t){switch(t.type){case"SET_SCOPE_RULES":{const n=t.rules.map(t=>e[t.id]&&(0,p.isEqual)(e[t.id],t)?e[t.id]:t);return(0,p.keyBy)(n,"id")}case"SETUP_EDITOR":{if("nab/heatmap"===t.experiment.type)return f.EMPTY_OBJECT;const n=(0,p.keyBy)(t.experiment.scope,"id");return(0,p.isEqual)(n,e)?e:n}}}(e,t))&&void 0!==n?n:e},segmentation:function(e=H,t){var n;return null!==(n=function(e,t){var n;switch(t.type){case"ADD_SEGMENTS":{const n=t.segments.filter(t=>!(0,p.isEqual)(e.segments[t.id],t));return n.length?Object.assign(Object.assign({},e),{segments:Object.assign(Object.assign({},e.segments),(0,p.keyBy)(n,"id"))}):e}case"UPDATE_SEGMENT":{const n=e.segments[t.segmentId];if(!n)return e;const i=Object.assign(Object.assign({},n),{attributes:Object.assign(Object.assign({},n.attributes),t.attributes)});return(0,p.isEqual)(i,n)?e:Object.assign(Object.assign({},e),{segments:Object.assign(Object.assign({},e.segments),{[t.segmentId]:i})})}case"REMOVE_SEGMENTS":{const n=(0,p.omit)(e.segments,t.ids);return(0,p.isEqual)(e.segments,n)?e:Object.assign(Object.assign({},e),{segments:n})}case"ADD_SEGMENTATION_RULES_INTO_SEGMENT":{const n=e.rules[t.segmentId],i=t.segmentationRules.filter(e=>!(0,p.isEqual)(null==n?void 0:n[e.id],e));return i.length?Object.assign(Object.assign({},e),{rules:Object.assign(Object.assign({},e.rules),{[t.segmentId]:Object.assign(Object.assign({},n),(0,p.keyBy)(i,"id"))})}):e}case"REPLACE_SEGMENTATION_RULES_IN_SEGMENT":{const i=null!==(n=e.rules[t.segmentId])&&void 0!==n?n:{},s=(0,p.keyBy)(t.segmentationRules,"id"),a=Object.values(i).map(e=>(0,p.omit)(e,"id")),r=Object.values(s).map(e=>(0,p.omit)(e,"id"));return(0,p.isEqual)(a,r)?e:Object.assign(Object.assign({},e),{rules:Object.assign(Object.assign({},e.rules),{[t.segmentId]:s})})}case"UPDATE_SEGMENTATION_RULE":{const n=e.rules[t.segmentId];if(!n)return e;const i=n[t.segmentationRuleId];if(!i)return e;const s=Object.assign(Object.assign({},i),{attributes:Object.assign(Object.assign({},i.attributes),t.attributes)});return(0,p.isEqual)(i,s)?e:Object.assign(Object.assign({},e),{rules:Object.assign(Object.assign({},e.rules),{[t.segmentId]:Object.assign(Object.assign({},n),{[t.segmentationRuleId]:s})})})}case"REMOVE_SEGMENTATION_RULES_FROM_SEGMENT":{const n=e.rules[t.segmentId];if(!n)return e;const i=(0,p.omit)(n,t.segmentationRuleIds);return(0,p.isEqual)(n,i)?e:Object.assign(Object.assign({},e),{rules:Object.assign(Object.assign({},e.rules),{[t.segmentId]:i})})}case"SET_SEGMENT_EVALUATION":return Object.assign(Object.assign({},e),{evaluation:t.strategy});case"SETUP_EDITOR":{if("nab/heatmap"===t.experiment.type)return e;const n={evaluation:t.experiment.segmentEvaluation,rules:t.experiment.segments.reduce((e,t)=>(e[t.id]=(0,p.keyBy)(t.segmentationRules,"id"),e),{}),segments:(0,p.keyBy)(t.experiment.segments.map(e=>(0,p.omit)(e,"segmentationRules")),"id")};return(0,p.isEqual)(e,n)?e:n}}}(e,t))&&void 0!==n?n:e}})}),W=function(e,t){return e.experiment.alternatives.byId[t]},Y=(0,l.createSelector)(e=>(0,p.values)(e.experiment.alternatives.byId).filter(f.isDefined),e=>[e.experiment.alternatives.byId]),z=e=>e.experiment.alternatives.allIds,X=(0,f.createIndexedSelector)((e,t)=>(0,p.values)(e.experiment.conversionActions[t]),(e,t)=>({key:t,dependants:[e.experiment.conversionActions[t]]}));function $(e){return!!e.editor.isExperimentBeingSaved}function J(e){return!!e.editor.hasExperimentBeenRecentlySaved}function Q(e){return e.experiment.goals[e.editor.activeGoalId]||(0,p.values)(e.experiment.goals)[0]}function K(e){return(0,p.map)(e.experiment.goals,"id").indexOf(e.editor.activeGoalId)||0}function Z(e){return(0,p.filter)(e.experiment.segmentation.segments,{id:e.editor.activeSegmentId})[0]}function ee(e){return(0,p.map)(e.experiment.segmentation.segments,"id").indexOf(e.editor.activeSegmentId)||0}function te(e){if(e.experiment&&e.experiment.data)return["draft","paused_draft"].includes(e.experiment.data.status)?e.editor.draftStatusRationale:void 0}function ne(e){return e.editor.alternativePreviewerUrl}function ie(e){return e.editor.aiAlternativeModal}function se(e){return e.experiment.data.id}function ae(e){return e.experiment.data.type}const re=function(e,t){return e.experiment.data[t]},oe=function(e,t){return e.experiment.data[t]};function ce(e){return!!e.experiment.data.isTestedElementInvalid}const le=(0,l.createSelector)(e=>(0,p.values)(e.experiment.goals).filter(f.isDefined),e=>[e.experiment.goals]),de=(0,l.createSelector)(e=>(0,p.values)(e.experiment.scope).filter(f.isDefined),e=>[e.experiment.scope]),ue=(0,l.createSelector)(e=>(0,p.values)(e.experiment.segmentation.segments).filter(f.isDefined),e=>[e.experiment.segmentation.segments]),ge=(0,f.createIndexedSelector)((e,t)=>(0,p.values)(e.experiment.segmentation.rules[t]),(e,t)=>({key:t,dependants:[e.experiment.segmentation.rules[t]]}));function pe(e){return e.experiment.segmentation.evaluation}function me(e){return{type:"ADD_ALTERNATIVES",alternatives:(0,p.castArray)(e)}}function be(e){return{type:"REMOVE_ALTERNATIVES",ids:(0,p.castArray)(e)}}function ve(e,t){return{type:"REPLACE_ALTERNATIVES",oldIds:(0,p.castArray)(e),alternatives:(0,p.castArray)(t)}}function Ee(e,t){return{type:"SET_ALTERNATIVE",id:e,alternative:t}}function _e(e,t){return{type:"ADD_CONVERSION_ACTIONS_INTO_GOAL",goalId:e,conversionActions:(0,p.castArray)(t)}}function xe(e,t){return{type:"REPLACE_CONVERSION_ACTIONS_IN_GOAL",goalId:e,conversionActions:(0,p.castArray)(t)}}function ye(e,t){return{type:"REMOVE_CONVERSION_ACTIONS_FROM_GOAL",goalId:e,conversionActionIds:(0,p.castArray)(t)}}function Ae(e,t,n,i){return{type:"UPDATE_CONVERSION_ACTION",goalId:e,conversionActionId:t,attributes:n,scope:i}}function Oe(e){return{type:"SETUP_EDITOR",experiment:e}}function fe(e){return{type:"SET_ACTIVE_GOAL",goalId:e}}function je(e){return{type:"SET_ACTIVE_SEGMENT",segmentId:e}}function Ie(e){return{type:"SET_EXPERIMENT_AS_BEING_SAVED",status:e}}function Te(e){return{type:"SET_DRAFT_STATUS_RATIONALE",rationale:e}}function Se(){return{type:"SET_EXPERIMENT_AS_RECENTLY_SAVED"}}function he(e){return{type:"OPEN_ALTERNATIVE_PREVIEWER",url:e}}function Ne(){return{type:"CLOSE_ALTERNATIVE_PREVIEWER"}}function Re(e){return{type:"SHOW_AI_ALTERNATIVE_MODAL",alternativeId:e}}function we(e){return{type:"UPDATE_EXPERIMENT_DATA",attributes:e}}function De(e){return{type:"UPDATE_EXPERIMENT_DATA",attributes:e}}function Pe(e){return{type:"SET_TESTED_ELEMENT_AS_INVALID",invalid:e}}function Ce(e){return{type:"ADD_GOALS",goals:(0,p.castArray)(e)}}function Me(e){return{type:"REMOVE_GOALS",ids:(0,p.castArray)(e)}}function ke(e,t){return{type:"UPDATE_GOAL",goalId:e,attributes:t}}function Le(e){return{type:"SET_SCOPE_RULES",rules:e}}function Ue(e){return{type:"ADD_SEGMENTS",segments:(0,p.castArray)(e)}}function Ge(e){return{type:"REMOVE_SEGMENTS",ids:(0,p.castArray)(e)}}function Be(e,t){return{type:"UPDATE_SEGMENT",segmentId:e,attributes:t}}function Ve(e,t){return{type:"ADD_SEGMENTATION_RULES_INTO_SEGMENT",segmentId:e,segmentationRules:(0,p.castArray)(t)}}function qe(e,t){return{type:"REPLACE_SEGMENTATION_RULES_IN_SEGMENT",segmentId:e,segmentationRules:(0,p.castArray)(t)}}function He(e,t){return{type:"REMOVE_SEGMENTATION_RULES_FROM_SEGMENT",segmentId:e,segmentationRuleIds:(0,p.castArray)(t)}}function Fe(e,t,n){return{type:"UPDATE_SEGMENTATION_RULE",segmentId:e,segmentationRuleId:t,attributes:n}}function We(e){return{type:"SET_SEGMENT_EVALUATION",strategy:e}}const Ye=window.wp.apiFetch;var ze=n.n(Ye);const Xe=window.wp.date,$e=window.wp.url,Je=e=>{const{url:t,path:n}=e,i=(0,Xe.format)("YmjHi").substring(0,11)+"0";return ze()(Object.assign(Object.assign(Object.assign(Object.assign({},e),t&&{url:Qe(e)?(0,$e.addQueryArgs)(t,{nabts:i}):t}),n&&{path:(0,$e.addQueryArgs)(n,{nabts:i})}),{parse:!0}))},Qe=e=>{var t,n;return!!(null===(t=e.url)||void 0===t?void 0:t.includes("/wp-json/"))||!!(null===(n=e.url)||void 0===n?void 0:n.includes("rest_route"))||!!Object.keys(e).includes("rest_route")},Ke=window.nab.experiments;var Ze=function(e,t,n,i){return new(n||(n=Promise))(function(s,a){function r(e){try{c(i.next(e))}catch(e){a(e)}}function o(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,o)}c((i=i.apply(e,t||[])).next())})};function et(){return Ze(this,void 0,void 0,function*(){var e,t,n,i,s,a;if((0,l.select)(ut).isExperimentBeingSaved())return;yield(0,l.dispatch)(ut).setExperimentAsBeingSaved(!0);const r=[],o=(0,l.select)(ut).getGoals();for(const t of o){const n=(0,l.select)(ut).getConversionActions(t.id),i=ot(n);r.push(Object.assign(Object.assign({},t),{attributes:Object.assign(Object.assign({},t.attributes),{useOrderRevenue:i?null===(e=t.attributes.useOrderRevenue)||void 0===e||e:void 0,orderStatusForConversion:i?ct(i,t):void 0}),conversionActions:n}))}const c=[],d=(0,l.select)(ut).getSegments();for(const e of d)c.push(Object.assign(Object.assign({},e),{segmentationRules:(0,l.select)(ut).getSegmentationRules(e.id)}));const u=[],g=(0,l.select)(ut).getAlternativeIds(),p=(0,l.select)(ut).isTestedElementInvalid(),m=(0,l.select)(ut).getAlternative("control");for(const e of g){if("control"===e)continue;const t=(0,l.select)(ut).getAlternative(e);t&&u.push(t)}let b;const v=(0,l.select)(ut).getExperimentType();b="nab/heatmap"===v?{id:(0,l.select)(ut).getExperimentId(),type:v,name:(0,l.select)(ut).getExperimentAttribute("name"),description:(0,l.select)(ut).getExperimentAttribute("description"),status:(0,l.select)(ut).getExperimentAttribute("status"),startDate:(0,l.select)(ut).getExperimentAttribute("startDate"),endDate:!1,endMode:(0,l.select)(ut).getExperimentAttribute("endMode"),endValue:(0,l.select)(ut).getExperimentAttribute("endValue"),trackingMode:null!==(t=(0,l.select)(ut).getHeatmapAttribute("trackingMode"))&&void 0!==t?t:"post",trackedPostId:null!==(n=(0,l.select)(ut).getHeatmapAttribute("trackedPostId"))&&void 0!==n?n:0,trackedPostType:null!==(i=(0,l.select)(ut).getHeatmapAttribute("trackedPostType"))&&void 0!==i?i:"page",trackedUrl:null!==(s=(0,l.select)(ut).getHeatmapAttribute("trackedUrl"))&&void 0!==s?s:"",participationConditions:null!==(a=(0,l.select)(ut).getHeatmapAttribute("participationConditions"))&&void 0!==a?a:[]}:{id:(0,l.select)(ut).getExperimentId(),type:v,name:(0,l.select)(ut).getExperimentAttribute("name"),description:(0,l.select)(ut).getExperimentAttribute("description"),status:(0,l.select)(ut).getExperimentAttribute("status"),startDate:(0,l.select)(ut).getExperimentAttribute("startDate"),endDate:!1,endMode:(0,l.select)(ut).getExperimentAttribute("endMode"),endValue:(0,l.select)(ut).getExperimentAttribute("endValue"),autoAlternativeApplication:(0,l.select)(ut).getExperimentAttribute("autoAlternativeApplication"),scope:(0,l.select)(ut).getScope(),alternatives:p?[m]:[m,...u],goals:r,segmentEvaluation:(0,l.select)(ut).getSegmentEvaluation(),segments:c};try{let e=yield Je({path:`/nab/v1/experiment/${b.id}`,method:"PUT",data:b});"nab/heatmap"!==b.type&&p&&(e=Object.assign(Object.assign({},e),{alternatives:[e.alternatives[0],...u]})),yield(0,l.dispatch)(ut).setupEditor(e),yield(0,l.dispatch)(ut).setExperimentAsBeingSaved(!1),yield(0,l.dispatch)(ut).setExperimentAsRecentlySaved()}catch(e){const t=lt(e);yield(0,l.dispatch)(O.store).createErrorNotice(t),yield(0,l.dispatch)(ut).setExperimentAsBeingSaved(!1)}})}function tt(e){return Ze(this,void 0,void 0,function*(){if(yield et(),!(0,l.select)(ut).hasExperimentBeenRecentlySaved())return;if(!(0,l.select)(ut).getAlternativeIds().includes(e))return;const t=(0,l.select)(ut).getAlternative(e);t&&t.links.edit&&(window.location.href=t.links.edit)})}function nt(e){return Ze(this,void 0,void 0,function*(){if(yield et(),!(0,l.select)(ut).hasExperimentBeenRecentlySaved())return;if(!(0,l.select)(ut).getAlternativeIds().includes(e))return;const t=(0,l.select)(ut).getAlternative(e);if(!(null==t?void 0:t.links.preview)){let e=(0,A._x)("Preview not available.","text","nelio-ab-testing");const t=(0,l.select)(ut).getExperimentType(),n=(0,l.select)(Ke.store).getExperimentSupport(t,"scope");return"urls"!==n&&"urls-with-tested-post"!==n||(e+=" ",e+=(0,A._x)("Please review your test scope and consider adding an exact URL where the test should be active so that Nelio can use it in the preview.","user","nelio-ab-testing")),void(yield(0,l.dispatch)(O.store).createWarningNotice(e))}yield(0,l.dispatch)(ut).openAlternativePreviewer(t.links.preview)})}function it(){return Ze(this,void 0,void 0,function*(){yield(0,l.dispatch)(ut).setExperimentData({status:"trash"}),yield et(),window.location.href=(0,l.select)(b.store).getAdminUrl("edit.php",{post_type:"nab_experiment"})})}function st(){return Ze(this,void 0,void 0,function*(){yield rt("start")})}function at(){return Ze(this,void 0,void 0,function*(){yield rt("resume")})}function rt(e){return Ze(this,arguments,void 0,function*(e,t=!1){if(yield et(),!(0,l.select)(ut).hasExperimentBeenRecentlySaved())return;yield(0,l.dispatch)(ut).setExperimentAsBeingSaved(!0);const n=(0,l.select)(ut).getExperimentId();try{yield Je({path:`/nab/v1/experiment/${n}/${e}`,method:"PUT",data:{ignoreScopeOverlap:t}})}catch(t){const n=lt(t,"start"===e?(0,A._x)("Test can’t be started","text","nelio-ab-testing"):(0,A._x)("Test can’t be resumed","text","nelio-ab-testing"));if("equivalent-experiment-running"===function(e){if(!e||"object"!=typeof e)return!1;if("code"in e&&"equivalent-experiment-running"===e.code)return"equivalent-experiment-running";if(!("errors"in e)||"object"!=typeof e.errors)return!1;const t=e.errors||{};return Object.keys(t).includes("equivalent-experiment-running")&&"equivalent-experiment-running"}(t)){const{notice:t}=yield(0,l.dispatch)(O.store).createWarningNotice(n,{actions:[{label:"start"===e?(0,A._x)("Start anyway","command","nelio-ab-testing"):(0,A._x)("Resume anyway","command","nelio-ab-testing"),variant:"primary",onClick:()=>Ze(this,void 0,void 0,function*(){yield(0,l.dispatch)(O.store).removeNotice(t.id),yield rt(e,!0)})}]})}else yield(0,l.dispatch)(O.store).createErrorNotice(n);return void(yield(0,l.dispatch)(ut).setExperimentAsBeingSaved(!1))}window.location.href=(0,l.select)(b.store).getAdminUrl("admin.php",{page:"nelio-ab-testing-experiment-view",experiment:n})})}function ot(e){if(e.length)return e.every(({type:e})=>"nab/wc-order"===e)?"woocommerce":e.every(({type:e})=>"nab/edd-order"===e)?"edd":void 0}function ct(e,t){const n=(0,l.select)(b.store).getECommerceSetting(e,"orderStatuses"),i=t.attributes.orderStatusForConversion;return i&&n.map(e=>e.value).includes(i)?i:function(e){switch(e){case"woocommerce":return"wc-completed";case"edd":return"complete"}}(e)}function lt(e,t){const n=t||(0,A._x)("Unknown error","text","nelio-ab-testing");if(!e||"object"!=typeof e)return n;if("errors"in e&&"object"==typeof e.errors){const t=Array.isArray(e.errors)?e.errors:(0,p.values)(e.errors);if("string"==typeof t[0])return t[0]||n;const i=Array.isArray(t[0])&&"string"==typeof t[0][0]?t[0][0]:void 0;if(i)return i||n}return"message"in e&&"string"==typeof e.message&&e.message||n}const dt=Object.assign(Object.assign({},s),a),ut=(0,l.createReduxStore)("nab/editor",{reducer:F,controls:l.controls,actions:dt,selectors:i});!function(e){(0,l.register)(e)}(ut);const gt=({readOnly:e,rule:t,setAttributes:n,remove:i})=>{var s;const a=pt(),r=mt(t.type),l=null==r?void 0:r.view,d=null==r?void 0:r.edit,u=null==r?void 0:r.icon,g=(null==t?void 0:t.attributes)||{},p=(null!==(s=null==r?void 0:r.validate)&&void 0!==s?s:()=>({}))(g),m=!(0,f.isEmpty)(p),[b,v]=(0,c.useState)(m);if(e)return(0,o.jsx)("div",{className:"nab-segmentation-rule",children:(0,o.jsxs)("div",{className:"nab-segmentation-rule__view",children:[u?(0,o.jsx)(u,{className:"nab-segmentation-rule__icon"}):(0,o.jsx)(E.Dashicon,{className:"nab-segmentation-rule__icon nab-segmentation-rule__icon--invalid",icon:"warning"}),(0,o.jsx)("div",{className:"nab-segmentation-rule__actual-view",children:l?(0,o.jsx)(l,{attributes:g,experimentId:a}):(0,o.jsx)("span",{children:(0,A._x)("Invalid segmentation rule.","text","nelio-ab-testing")})})]})});const _=!!u&&(!m||b);return(0,o.jsxs)(E.PanelBody,{className:"nab-segmentation-rule",opened:b,onToggle:v,title:(0,o.jsxs)("div",{className:"nab-segmentation-rule__view",children:[_?(0,o.jsx)(u,{className:"nab-segmentation-rule__icon"}):(0,o.jsx)(E.Dashicon,{className:"nab-segmentation-rule__icon nab-segmentation-rule__icon--invalid",icon:"warning"}),(0,o.jsx)("div",{className:"nab-segmentation-rule__actual-view",children:l?(0,o.jsx)(l,{attributes:g,experimentId:a}):(0,o.jsx)("span",{children:(0,A._x)("Invalid segmentation rule.","text","nelio-ab-testing")})})]}),children:[(0,o.jsx)("div",{className:"nab-segmentation-rule__edit",children:d?(0,o.jsx)(d,{attributes:g,experimentId:a,setAttributes:n,errors:p}):(0,o.jsx)("span",{children:(0,A._x)("This segmentation rule can’t be properly loaded. Please consider removing it.","text","nelio-ab-testing")})}),(0,o.jsx)(E.Button,{variant:"link",isDestructive:!0,onClick:i,className:"nab-segmentation-rule__delete-button",children:(0,A._x)("Delete","command","neli-ab-testing")})]})},pt=()=>d(e=>e(ut).getExperimentId(),[]),mt=e=>d(t=>t(I.store).getSegmentationRuleType(e),[e]),bt=({category:e,segmentationRules:t,createSegmentationRule:n,onClose:i})=>{const s=vt(e.name);return s.length?(0,o.jsx)(E.MenuGroup,{label:e.title,children:s.map(({name:e,title:s,icon:a,singleton:r})=>(0,o.jsx)(E.MenuItem,{role:"menuitem",icon:(0,o.jsx)(a,{}),iconPosition:"left",onClick:()=>{n(e),i()},disabled:r&&t.some(t=>t.type===e),children:s},e))}):null},vt=e=>d(e=>e(I.store).getSegmentationRuleTypes()||f.EMPTY_ARRAY,[]).filter(({category:t})=>t===e),Et=({createSegmentationRule:e,segmentationRules:t})=>{const n=_t();return(0,o.jsx)(E.DropdownMenu,{className:"nab-segmentation-rule-type-new",icon:null,label:(0,A._x)("Add Rule","command","nelio-ab-testing"),toggleProps:{variant:"secondary",children:(0,A._x)("Add Rule","command","nelio-ab-testing")},popoverProps:{className:"nab-segmentation-rule-type-new__list",placement:"top-center"},children:({onClose:i})=>n.map(n=>(0,o.jsx)(bt,{category:n,createSegmentationRule:e,segmentationRules:t,onClose:i},n.name))})},_t=()=>d(e=>e(I.store).getSegmentationRuleTypeCategories()||[],[]),xt=()=>(0,o.jsxs)("div",{className:"nab-edit-experiment__participation-section",children:[(0,o.jsx)(yt,{}),(0,o.jsx)(At,{})]}),yt=()=>(0,o.jsx)("h2",{children:(0,c.createInterpolateElement)((0,A.sprintf)(/* translators: %s: Dashicon. */ /* translators: %s: Dashicon. */
(0,A._x)("%s Participation","text","nelio-ab-testing"),"<icon></icon>"),{icon:(0,o.jsx)(E.Dashicon,{className:"nab-participation-section__title-icon",icon:"groups"})})}),At=()=>{const{conditions:e,createCondition:t,updateCondition:n,removeCondition:i}=Ot();return(0,o.jsxs)("div",{className:"nab-edit-experiment-participation-section__content",children:[(0,o.jsx)("p",{children:e.length?(0,A._x)("Only visitors who meet all the following criteria will contribute to this heatmap:","text","nelio-ab-testing"):(0,A._x)("All visitors will contribute to this heatmap. If you want to limit participation to a subset of visitors, use the actions below:","text","nelio-ab-testing")}),(0,o.jsx)("div",{className:"nab-edit-experiment-participation-section__conditions",children:e.map(e=>(0,o.jsx)(gt,{rule:e,setAttributes:t=>n(e.id,t),remove:()=>i(e.id)},e.id))}),(0,o.jsx)(Et,{segmentationRules:e,createSegmentationRule:t})]})},Ot=()=>{const e=d(e=>{var t;return null!==(t=e(m.store).getHeatmapAttribute("participationConditions"))&&void 0!==t?t:f.EMPTY_ARRAY},[]),{setHeatmapData:t}=(0,l.useDispatch)(m.store);return{conditions:e,createCondition:n=>{const i=(0,I.createSegmentationRule)(n);i&&t({participationConditions:[...e,i]})},updateCondition:(n,i)=>{t({participationConditions:e.map(e=>e.id===n?Object.assign(Object.assign({},e),{attributes:Object.assign(Object.assign({},e.attributes),i)}):e)})},removeCondition:n=>{t({participationConditions:e.filter(e=>e.id!==n)})}}},ft=()=>{const e=jt(),{removeNotice:t}=(0,l.useDispatch)(O.store);return(0,o.jsxs)("div",{className:"nab-edit-experiment-layout",children:[(0,o.jsx)(T,{}),(0,o.jsx)(m.Header,{}),(0,o.jsxs)("div",{className:"nab-edit-experiment-layout__body",children:[(0,o.jsxs)("div",{className:"nab-edit-experiment-layout__content",role:"region","aria-label":(0,A._x)("Editor content","text","nelio-ab-testing"),tabIndex:-1,children:[!(0,f.isEmpty)(e)&&(0,o.jsx)(E.NoticeList,{className:"nab-edit-experiment-layout__notices",notices:e,onRemove:t}),(0,o.jsx)(m.ExperimentName,{}),(0,o.jsx)(C,{}),(0,o.jsx)(xt,{})]}),(0,o.jsx)(m.Sidebar,{})]})]})},jt=()=>d(e=>e(O.store).getNotices(),[]),It=({experimentId:e})=>{const t=d(t=>t(b.store).getExperiment(e),[e]);return t?(0,o.jsx)(c.StrictMode,{children:(0,o.jsx)(m.EditorProvider,{experiment:t,children:(0,o.jsx)(ft,{})})}):null};function Tt(e,t){const n=document.getElementById(e);var i,s;(0,v.registerCoreExperiments)(),i=(0,o.jsx)(It,{experimentId:t}),(s=n)&&(c.createRoot?(0,c.createRoot)(s).render(i):(0,c.render)(i,s))}function St(){const e=window.innerHeight,t=document.getElementById("wpadminbar"),n=t?t.getBoundingClientRect().height:0,{setPageAttribute:i}=(0,l.dispatch)(b.store);i("sidebarDimensions",{top:n,height:e-n+"px",applyFix:782<=window.innerWidth})}window.addEventListener("resize",(0,p.debounce)(St,100)),g(St)}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,i),a.exports}e=[],i.O=(t,n,s,a)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,s,a]=e[d],o=!0,c=0;c<n.length;c++)(!1&a||r>=a)&&Object.keys(i.O).every(e=>i.O[e](n[c]))?n.splice(c--,1):(o=!1,a<r&&(r=a));if(o){e.splice(d--,1);var l=s();void 0!==l&&(t=l)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,s,a]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s=i.O(void 0,[117,9196],()=>i(8290));s=i.O(s);var a=nab="undefined"==typeof nab?{}:nab;for(var r in s)a[r]=s[r];s.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})})();