(()=>{var e,t={9189(e,t,n){"use strict";n.r(t),n.d(t,{initPage:()=>Jn});var s={};n.r(s),n.d(s,{canRawDataBeProcessed:()=>Q,getActiveAlternative:()=>de,getActiveFilter:()=>be,getActiveMode:()=>me,getActiveResolution:()=>pe,getClickVisibilityProps:()=>ie,getClicksInResolution:()=>J,getClicksPerSquare:()=>ee,getConfettiFilterOptions:()=>ae,getDisabledFilterOptions:()=>ge,getFirstDayOfWeek:()=>le,getIFrameLabels:()=>ue,getIFrameStatus:()=>oe,getIFrames:()=>xe,getIntensity:()=>he,getLoadAttempts:()=>G,getOpacity:()=>fe,getPageDimensions:()=>re,getProcessedResultStatus:()=>X,getRawClicks:()=>$,getRawResultProgress:()=>H,getRawResultStatus:()=>q,getRawScrolls:()=>z,getScrollSummary:()=>se,getScrollsInResolution:()=>te,hasProcessedResults:()=>K,isInteractive:()=>ve,isSidebarVisible:()=>_e});var a={};n.r(a),n.d(a,{makeSidebarVisible:()=>We,markResultsAsProcessing:()=>Ae,receiveRawResults:()=>ye,requestResultProcessing:()=>ke,setActiveAlternative:()=>Ne,setActiveFilter:()=>Pe,setActiveMode:()=>Ie,setActiveResolution:()=>Ce,setDisabledFilterOptions:()=>De,setFirstDayOfWeek:()=>Ee,setIFrameStatus:()=>Te,setIntensity:()=>Me,setInteractive:()=>Fe,setOpacity:()=>Ve,setPageInfo:()=>Re,setProcessedResults:()=>Se,setRawResultProgress:()=>we,setRawResultStatus:()=>je,updateLoadAttempts:()=>Oe});var i={};n.r(i),n.d(i,{loadResults:()=>Ge,processResults:()=>Qe});const r=window.ReactJSXRuntime,l=window.wp.domReady,o=n.n(l)(),c=window.wp.element;function u(e,t){t&&(c.createRoot?(0,c.createRoot)(t).render(e):(0,c.render)(e,t))}const d=window.nab.commands,b=window.nab.experimentLibrary,m=window.nab.segmentationRuleLibrary,p=window.nab.utils,g=window.wp.i18n,x=window.React;function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},h.apply(null,arguments)}const v=function(e){return x.createElement("svg",h({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 133.65 57.138"},e),x.createElement("path",{d:"M30.395 11.33c-1.34 0-2.642.15-3.894.438.084.284.175.617.293 1.038q.245.776.366 1.102l2.596 8.592c.803-.035 1.621-.074 2.285-.093a54 54 0 0 1 1.567-.06c.53-.015.932-.024 1.204-.038q.429-.021.94-.021c2.121 0 3.843.281 5.175.838q2.02.836 2.877 2.222.858 1.365.86 2.996-.002 1.265-.554 2.408-.529 1.121-1.344 1.856a5.9 5.9 0 0 1-1.673 1.119 19 19 0 0 1-2.038.715q3.24.204 5.443 1.855.574.43 1 .94a17.3 17.3 0 0 0 2.25-8.553c0-9.585-7.768-17.354-17.353-17.354zm-7.797 1.847-.106.051-3.732 10.469h6.936zm-2.272 1.37c-4.412 3.146-7.29 8.306-7.29 14.137 0 1.835.29 3.604.817 5.264.298-1.744.855-3.546 1.443-5.396.006-.02.017-.05.026-.072l.004-.035 4.558-12.6c.08-.223.238-.684.442-1.298zm14.711 9.247q-1.162 0-2.285.204v9.912h1.915c1.944 0 3.31-.451 4.098-1.362.802-.911 1.205-2.133 1.205-3.656q0-2.08-1.162-3.591-1.161-1.508-3.77-1.507M18.475 25.37c-2.198 6.605 1.994 8.626 1.506 12.426-.207 1.616-1.252 2.408-2.421 2.57a17.33 17.33 0 0 0 10.013 5.443q.168-.072.285-.17.407-.327.507-1.162c.08-.557.123-1.451.123-2.672v-6.686c-.036-1.147-.061-2.172-.532-3.936a41 41 0 0 0-.587-2.102l-1.12-3.711zm14.277 10.047v10.26q.346.02.753.06l.099.004a17.3 17.3 0 0 0 8.213-3.991c.045-.312.073-.64.073-.988a5.8 5.8 0 0 0-.553-2.447q-.53-1.226-2.06-2.064-1.508-.835-4.178-.834h-2.345zM50.46 14.055v14.513h2.405V16.477h8.432a1.26 1.26 0 0 1 1.258 1.255v10.836h2.422V16.586a2.526 2.526 0 0 0-2.532-2.531zm16.938 0v2.422h14.516v-2.422zm16.938 0v11.982a2.526 2.526 0 0 0 2.531 2.531H98.85v-2.422H88.014a1.26 1.26 0 0 1-1.256-1.255V14.055zm16.918 0v14.513h2.422V14.055zm7.357 0a2.504 2.504 0 0 0-2.511 2.511v9.489a2.506 2.506 0 0 0 2.511 2.513h9.489a2.52 2.52 0 0 0 2.513-2.513v-9.489a2.506 2.506 0 0 0-2.513-2.511zm1.149 2.404h7.176c.692 0 1.238.564 1.238 1.256v7.176c0 .692-.546 1.238-1.238 1.238h-7.176a1.23 1.23 0 0 1-1.239-1.238v-7.176c0-.692.547-1.256 1.239-1.256m-42.362 3.64v2.424h14.516V20.1zm0 6.047v2.422h14.516v-2.422z",style:{fill:"#d24633"}}),x.createElement("path",{d:"m53.3 30.166-.943.11v2.851h-2.09v.816h2.09V39.9c0 1.907.672 3.141 2.76 3.141.6 0 1.217-.2 1.834-.49l-.346-.799c-.49.236-1.033.4-1.505.4-1.526 0-1.8-.926-1.8-2.252v-5.957h3.325v-.816h-3.324zm30.786 0-.943.11v2.851h-2.088v.816h2.088V39.9c0 1.907.671 3.141 2.76 3.141.599 0 1.216-.2 1.833-.49l-.345-.799c-.49.236-1.034.4-1.506.4-1.526 0-1.8-.926-1.8-2.252v-5.957h3.325v-.816h-3.324zm7.978.021a.697.697 0 0 0-.709.709c0 .177.068.35.186.485l.006.006.004.006a.73.73 0 0 0 .513.214.7.7 0 0 0 .497-.214.7.7 0 0 0 .214-.497.68.68 0 0 0-.222-.498.7.7 0 0 0-.489-.21m-16.74 2.74c-1.14 0-2.042.246-2.676.772-.608.503-.931 1.162-.931 1.914 0 .642.167 1.18.52 1.575l.003.003.002.002a3.2 3.2 0 0 0 1.252.797h.004l.004.002q.722.227 1.855.432l-.002-.002c.696.134 1.236.269 1.612.398l.004.002h.004c.372.113.671.296.914.55l.004.003.003.004c.234.224.354.524.354.959 0 .604-.217 1.038-.682 1.38v.003c-.455.323-1.207.508-2.261.508q-1.049 0-1.948-.336h-.002q-.887-.358-1.398-.854l-.188-.182-.496.663.137.14c.401.414.956.744 1.656.998q1.056.384 2.239.383c1.186 0 2.115-.224 2.775-.709l.002-.002c.652-.492.996-1.18.996-1.992 0-.618-.17-1.134-.523-1.504a2.9 2.9 0 0 0-1.221-.783c-.458-.153-1.062-.3-1.818-.45l-.002-.001h-.002q-1.026-.184-1.631-.38a2.35 2.35 0 0 1-.957-.57c-.237-.247-.362-.576-.362-1.037 0-.567.207-.988.65-1.332.447-.348 1.144-.543 2.11-.543q.797.001 1.537.23.74.23 1.254.643l.186.149.496-.662-.17-.139c-.386-.32-.88-.565-1.479-.744a6 6 0 0 0-1.824-.287m-11.072.018c-2.76 0-4.975 2.126-4.975 5.05 0 3.122 2.215 5.028 4.975 5.046 1.562 0 3.269-.636 4.213-1.889l-.69-.562c-.726.98-2.234 1.488-3.523 1.488-2.016 0-3.777-1.325-3.977-3.63h8.809c.381-3.814-2.072-5.503-4.832-5.503m27.398.092v10.004h.83V33.037zm10.569.035c-1.362.018-2.742.58-3.487 1.924v-1.76h-.945v9.787h.234v.018h.37v-.018h.359v-5.447c0-2.015 1.416-3.542 3.432-3.56 2.124-.019 3.486 1.18 3.486 3.396v5.629h.963v-5.646c0-2.724-1.797-4.323-4.412-4.323m13.22.233c-.92 0-1.762.206-2.511.619s-1.342 1-1.768 1.748c-.427.738-.639 1.575-.639 2.496s.213 1.764.64 2.514a4.7 4.7 0 0 0 1.765 1.746l.002.002c.749.413 1.591.619 2.511.619 1.049 0 1.986-.271 2.788-.815.604-.412.95-1.032 1.3-1.648v1.752c0 1.366-.322 2.324-.927 2.918l-.002.002-.002.002c-.596.606-1.538.928-2.88.928a5.9 5.9 0 0 1-2.132-.374 4.8 4.8 0 0 1-1.676-1.056l-.162-.16-.576.576.15.164c.483.522 1.112.927 1.877 1.22h.002c.778.294 1.62.44 2.518.44 1.526 0 2.703-.38 3.484-1.174l.002-.002c.782-.783 1.154-1.978 1.154-3.539V33.36h-.83v2.381c-.35-.607-.698-1.218-1.302-1.62-.802-.543-1.738-.815-2.786-.815m-51.187.529c2.36 0 3.94 1.345 3.959 3.76h-7.936c.218-2.397 1.961-3.76 3.977-3.76m51.187.283c.79 0 1.486.175 2.102.524h.002l.002.002c.628.337 1.11.807 1.459 1.423s.523 1.312.523 2.102-.176 1.492-.525 2.121a3.7 3.7 0 0 1-1.461 1.441c-.616.337-1.311.506-2.102.506s-1.494-.17-2.123-.507h-.002a3.74 3.74 0 0 1-1.439-1.442c-.349-.628-.523-1.33-.523-2.119s.174-1.486.523-2.102a3.6 3.6 0 0 1 1.441-1.423v-.002h.002c.63-.35 1.332-.524 2.121-.524",style:{fill:"#60609f"}}))},_=()=>(0,r.jsxs)("div",{className:"nab-heatmap-no-longer-available",children:[(0,r.jsx)(v,{className:"nab-heatmap-no-longer-available__logo",title:"Nelio A/B Testing",alt:"Nelio A/B Testing"}),(0,r.jsx)("h1",{className:"nab-heatmap-no-longer-available__title",children:(0,g._x)("Heatmap not found","text","nelio-ab-testing")}),(0,r.jsx)("p",{className:"nab-heatmap-no-longer-available__explanation",children:(0,g._x)("Oops! It looks like your heatmap is no longer available. Please keep in mind that heatmap data is only stored up to two years in Nelio’s cloud.","user","nelio-ab-testing")})]}),f=window.wp.data;function y(e,t){return(0,f.useSelect)(e,t)}const j=window.nab.data,w=()=>null,O=window.lodash,S={confettiFilterOptions:{},byAlternative:{}},R=["#753966","#91628b","#5b52f3","#4a87d5","#42b0ec","#4cc3d9","#59d1b7","#7bc8a4","#bfe656","#ffc65d","#ffb039","#f17b45","#ef4444","#cb0a0a"];function A(e){return R[e%R.length]||R[0]}function k(e,t){if("other"===t)return"#ec82b6";t=`${null!=t?t:""}`;const n=isNaN(Number.parseInt(t))?-1:Number.parseInt(t);switch(e){case"country":return function(e){return{AR:"#75aadb",AU:"#008000",BR:"#2dc52d",CA:"#f71818",CN:"#ff0000",FI:"#2008ff",FR:"#0000ff",DE:"#b97575",GR:"#9292da",IS:"#9494c3",IN:"#ffa500",IT:"#007fff",JP:"#e8f48c",NL:"#ff7f00",NZ:"#993333",NO:"#00008b",PT:"#218000",RU:"#3e3e77",ES:"#ff0000",GB:"#e64444",US:"#ec7777"}[e]}(t);case"device":return function(e){return{desktop:"#11a0d2",console:"#f17b45",mobile:"#ffc65d",tablet:"#7bc8a4",smarttv:"#93648d",wearable:"#4bc0d6",embedded:"#ec82b6"}[e]}(t);case"os":return function(e){return"Mac OS X"===(e=`${e}`)?"#e6e6e6":-1!==e.indexOf("Windows 10")?"#066b96":-1!==e.indexOf("Windows Phone")?"#097cae":-1!==e.indexOf("Windows 7")?"#0a8bc3":-1!==e.indexOf("Windows Vista")?"#049cde":-1!==e.indexOf("Windows XP")?"#35afe4":-1!==e.indexOf("Windows")?"#67c5ef":{"Chromium OS":"#63c7c5","Mac OS":"#c3c3c3",Android:"#97e375",Debian:"#ff7185",Fuchsia:"#d0608a",Linux:"#5e2c80",Mint:"#7aaa65",SUSE:"#84bc91",Ubuntu:"#f28b4a",iOS:"#d6d6d6"}[e]}(t);case"browser":return function(e){return{"Opera Mini":"#ff6060","Opera Mobi":"#ff9090","Samsung Browser":"#93648d",Chrome:"#7bc8a4",Chromium:"#6cbc6d",Edge:"#024b6e",Firefox:"#f28b4a",Mozilla:"#f29f79",Opera:"#f24a4a",Safari:"#ffc65d",Vivaldi:"#ef6dd2"}[`${e}`]}(t);case"dayOfWeek":return function(e){return["#ec82b6","#f17b45","#ffc65d","#7bc8a4","#4cc3d9","#4c8ad9","#93648d","#ec82b6"][e]}(n);case"hourOfDay":return function(e){return["#003e6b","#034d71","#066b96","#64c8c6","#dbeabf","#e3e075","#faca5c","#f28b4a","#d1618b","#9a4987","#5e2c80","#15205a"][e]}(n);default:return function(e){return["#cb0a0a","#ef4444","#f17b45","#ffb039","#ffc65d","#bfe656","#7bc8a4","#59d1b7","#4cc3d9","#42b0ec","#4a87d5","#5b52f3","#91628b","#753966"][e]}(n)}}function E(e){const t={country:{},device:{},os:{},browser:{},dayOfWeek:{},hourOfDay:{},timeToClick:{},windowWidth:{}};return e.forEach(e=>{t.country[e.country]=(t.country[e.country]||0)+e.intensity,t.device[e.device]=(t.device[e.device]||0)+e.intensity,t.os[e.os]=(t.os[e.os]||0)+e.intensity,t.browser[e.browser]=(t.browser[e.browser]||0)+e.intensity,t.dayOfWeek[e.dayOfWeek]=(t.dayOfWeek[e.dayOfWeek]||0)+e.intensity,t.hourOfDay[e.hourOfDay]=(t.hourOfDay[e.hourOfDay]||0)+e.intensity,t.timeToClick[e.timeToClick]=(t.timeToClick[e.timeToClick]||0)+e.intensity,t.windowWidth[e.windowWidth]=(t.windowWidth[e.windowWidth]||0)+e.intensity}),Object.keys(t).reduce((e,n)=>Object.assign(Object.assign({},e),{[n]:T(n,t[n])}),{})}function T(e,t){switch(e){case"country":case"device":return N(e,t);case"os":return function(e){const t={"Windows 10":"Windows 01","Windows Phone":"Windows 02","Windows 7":"Windows 03","Windows Vista":"Windows 04","Windows XP":"Windows 05","Windows 98":"Windows 06","Windows 95":"Windows 07",Windows:"Windows 08"};let n=Object.values(e).map(e=>{var{key:n}=e,s=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(n[s[a]]=e[s[a]])}return n}(e,["key"]);return Object.assign(Object.assign({key:n},s),{sorting:t[n]?t[n]:n})});n=(0,O.orderBy)(n,"sorting");const s=n.map(e=>({key:e.key,color:e.color,value:e.value,label:e.label}));return(0,O.keyBy)(s,"key")}(N(e,t));case"browser":return function(e){const t=(0,O.orderBy)(Object.values(e),"key");return(0,O.keyBy)(t,"key")}(N(e,t));case"dayOfWeek":case"hourOfDay":case"timeToClick":case"windowWidth":return function(e,t){const n={dayOfWeek:[{label:(0,g._x)("Sunday","text","nelio-ab-testing")},{label:(0,g._x)("Monday","text","nelio-ab-testing")},{label:(0,g._x)("Tuesday","text","nelio-ab-testing")},{label:(0,g._x)("Wednesday","text","nelio-ab-testing")},{label:(0,g._x)("Thursday","text","nelio-ab-testing")},{label:(0,g._x)("Friday","text","nelio-ab-testing")},{label:(0,g._x)("Saturday","text","nelio-ab-testing")}],hourOfDay:[{label:(0,g._x)("12a – 2a","text","nelio-ab-testing")},{label:(0,g._x)("2a – 4a","text","nelio-ab-testing")},{label:(0,g._x)("4a – 6a","text","nelio-ab-testing")},{label:(0,g._x)("6a – 8a","text","nelio-ab-testing")},{label:(0,g._x)("8a – 10a","text","nelio-ab-testing")},{label:(0,g._x)("10a – 12p","text","nelio-ab-testing")},{label:(0,g._x)("12p – 2p","text","nelio-ab-testing")},{label:(0,g._x)("2p – 4p","text","nelio-ab-testing")},{label:(0,g._x)("4p – 6p","text","nelio-ab-testing")},{label:(0,g._x)("6p – 8p","text","nelio-ab-testing")},{label:(0,g._x)("8p – 10p","text","nelio-ab-testing")},{label:(0,g._x)("10p – 12a","text","nelio-ab-testing")}],timeToClick:[{label:(0,g._x)("0 – 2s","text","nelio-ab-testing")},{label:(0,g._x)("2 – 3s","text","nelio-ab-testing")},{label:(0,g._x)("3 – 4s","text","nelio-ab-testing")},{label:(0,g._x)("4 – 5s","text","nelio-ab-testing")},{label:(0,g._x)("5 – 10s","text","nelio-ab-testing")},{label:(0,g._x)("10 – 15s","text","nelio-ab-testing")},{label:(0,g._x)("15 – 20s","text","nelio-ab-testing")},{label:(0,g._x)("20 – 25s","text","nelio-ab-testing")},{label:(0,g._x)("25 – 30s","text","nelio-ab-testing")},{label:(0,g._x)("30 – 60s","text","nelio-ab-testing")},{label:(0,g._x)("1 – 2min","text","nelio-ab-testing")},{label:(0,g._x)("2 – 3min","text","nelio-ab-testing")},{label:(0,g._x)("3 – 5min","text","nelio-ab-testing")},{label:(0,g._x)("+5min","text","nelio-ab-testing")}],windowWidth:[{label:(0,g._x)("< 300 px","text","nelio-ab-testing")},{label:(0,g._x)("300 – 600px","text","nelio-ab-testing")},{label:(0,g._x)("600 – 900px","text","nelio-ab-testing")},{label:(0,g._x)("900 – 1200px","text","nelio-ab-testing")},{label:(0,g._x)("1200 – 1500px","text","nelio-ab-testing")},{label:(0,g._x)("1500 – 1800px","text","nelio-ab-testing")},{label:(0,g._x)("1800 – 2100px","text","nelio-ab-testing")},{label:(0,g._x)("+2100px","text","nelio-ab-testing")}]}[e].map(({label:e},n)=>({key:`${n}`,label:e,value:t[n]||0,color:""}));let s=-1;return(0,O.keyBy)(n.map(t=>Object.assign(Object.assign({},t),{color:k(e,t.key)||A(++s)})),"key")}(e,t)}}function N(e,t){const n=(0,O.orderBy)(Object.keys(t).map(e=>{var n;return{key:e,value:null!==(n=t[e])&&void 0!==n?n:0}}),"value","desc");let s=n.splice(0,14);s=(0,O.orderBy)(s,"key"),n.length&&s.push({key:"other",value:n.reduce((e,{value:t})=>e+(null!=t?t:0),0)});let a=-1;return(0,O.keyBy)(s.map(({key:t,value:n})=>({key:t,label:P(e,t),value:n,color:k(e,t)||A(++a)})),"key")}function P(e,t){var n,s;return"other"===t?(0,g._x)("Other","text","nelio-ab-testing"):"device"===e?(null!==(s=null===(n=t[0])||void 0===n?void 0:n.toUpperCase())&&void 0!==s?s:"")+t.slice(1):t}function I(e,t,n){switch(n.type){case"RECEIVE_RAW_RESULTS":return{raw:n.data,byResolution:(0,O.mapValues)(t.byResolution,e=>Object.assign(Object.assign({},e),{status:"missing"===e.status?"missing":"outdated"})),loadAttempts:t.loadAttempts};case"SET_RAW_RESULT_STATUS":return Object.assign(Object.assign({},t),{raw:Object.assign(Object.assign({},t.raw),{status:n.status})});case"SET_RAW_RESULT_PROGRESS":return Object.assign(Object.assign({},t),{raw:Object.assign(Object.assign({},t.raw),{progress:n.progress})});case"UPDATE_LOAD_ATTEMPTS":return Object.assign(Object.assign({},t),{loadAttempts:{clicks:W(t.loadAttempts.clicks,n.clicks),scrolls:W(t.loadAttempts.scrolls,n.scrolls)}});case"SET_PROCESSED_RESULTS":{if(!F(e,n.alternative))return t;const s=t.byResolution[n.resolution],a=Object.assign(Object.assign({},s),{results:n.results,status:"ready",confettiFilterOptions:E(n.results.clicks)});return Object.assign(Object.assign({},t),{byResolution:Object.assign(Object.assign({},t.byResolution),{[n.resolution]:a})})}case"MARK_RESULTS_AS_PROCESSING":{if(!M(e,n.alternative,n.resolution))return t;const s=t.byResolution[n.resolution].status;return Object.assign(Object.assign({},t),{byResolution:Object.assign(Object.assign({},t.byResolution),{[n.resolution]:Object.assign(Object.assign({},t.byResolution[n.resolution]),{status:"missing"===s?"initializing":"processing"})})})}case"REQUEST_RESULTS_PROCESSING":return M(e,n.alternative,n.resolution)?Object.assign(Object.assign({},t),{byResolution:Object.assign(Object.assign({},t.byResolution),{[n.resolution]:Object.assign(Object.assign({},t.byResolution[n.resolution]),{status:"outdated"})})}):t;case"SET_PAGE_INFO":{const e=t.byResolution[n.resolution],s="missing"===e.status?Object.assign(Object.assign({},e),{page:n.page}):Object.assign(Object.assign({},e),{page:n.page,status:"outdated"});return Object.assign(Object.assign({},t),{byResolution:Object.assign(Object.assign({},t.byResolution),{[n.resolution]:s})})}}}const C={page:{clickVisibilityProps:{},dimensions:{width:0,bodyHeight:0,iframeHeight:0}},status:"missing"},D={raw:{results:{clicks:[],scrolls:[]},status:{mode:"missing"},progress:0},byResolution:{desktop:C,smartphone:C,tablet:C},loadAttempts:{clicks:{count:0,length:0},scrolls:{count:0,length:0}}};function F(e,t){var n;const s=(null!==(n=e.byAlternative[t])&&void 0!==n?n:D).raw.status.mode;return"still-loading"===s||"canceling"===s||"ready"===s}function M(e,t,n){var s;return!!F(e,t)&&"processing"!==(null!==(s=e.byAlternative[t])&&void 0!==s?s:D).byResolution[n].status}function W(e,t){return t?t.more&&e.length===t.data.length?Object.assign(Object.assign({},e),{count:e.count+1}):{count:1,length:t.data.length}:Object.assign(Object.assign({},e),{count:1})}const V={firstDayOfWeek:0,iframeStatus:{0:"waiting-script"}},B={activeAlternative:0,activeFilter:"timeToClick",activeMode:"heatmap",activeResolution:"desktop",disabledFilterOptions:[],iframes:[],intensity:60,isInteractive:!1,isSidebarVisible:!0,opacity:70},L=(0,f.combineReducers)({data:function(e=S,t){var n;return null!==(n=function(e,t){var n,s;switch(t.type){case"RECEIVE_RAW_RESULTS":case"SET_PROCESSED_RESULTS":{const s=null!==(n=e.byAlternative[t.alternative])&&void 0!==n?n:D,a=I(e,s,t);return(0,O.isEqual)(s,a)||(e=function(e){const t=Object.values(e.byAlternative).flatMap(e=>e.raw.results.clicks),n=(0,O.mapValues)(E(t),e=>(0,O.mapValues)(e,e=>Object.assign(Object.assign({},e),{value:0})));return(0,O.isEqual)(e.confettiFilterOptions,n)||(e={confettiFilterOptions:n,byAlternative:(0,O.mapValues)(e.byAlternative,e=>{const t=Object.assign(Object.assign({},e),{byResolution:(0,O.mapValues)(e.byResolution,e=>{return e.confettiFilterOptions?Object.assign(Object.assign({},e),{confettiFilterOptions:(t=n,s=e.confettiFilterOptions,(0,O.mapValues)(t,(e,t)=>(0,O.mapValues)(e,(e,n)=>{var a,i,r;return Object.assign(Object.assign({},e),{value:null!==(r=null===(i=null===(a=s[t])||void 0===a?void 0:a[n])||void 0===i?void 0:i.value)&&void 0!==r?r:0})})))}):e;var t,s})});return(0,O.isEqual)(e,t)?e:t})}),e}(e=Object.assign(Object.assign({},e),{byAlternative:Object.assign(Object.assign({},e.byAlternative),{[t.alternative]:a})}))),e}case"UPDATE_LOAD_ATTEMPTS":case"SET_RAW_RESULT_STATUS":case"SET_RAW_RESULT_PROGRESS":case"MARK_RESULTS_AS_PROCESSING":case"REQUEST_RESULTS_PROCESSING":case"SET_PAGE_INFO":{const n=null!==(s=e.byAlternative[t.alternative])&&void 0!==s?s:D,a=I(e,n,t);return(0,O.isEqual)(n,a)?e:Object.assign(Object.assign({},e),{byAlternative:Object.assign(Object.assign({},e.byAlternative),{[t.alternative]:a})})}}}(e,t))&&void 0!==n?n:e},misc:function(e=V,t){var n;return null!==(n=function(e,t){switch(t.type){case"SET_FIRST_DAY_OF_WEEK":return Object.assign(Object.assign({},e),{firstDayOfWeek:t.day});case"SET_IFRAME_STATUS":return Object.assign(Object.assign({},e),{iframeStatus:Object.assign(Object.assign({},e.iframeStatus),{[t.alternative]:t.status})})}}(e,t))&&void 0!==n?n:e},ui:function(e=B,t){var n;return null!==(n=function(e,t){switch(t.type){case"SET_ACTIVE_ALTERNATIVE":{const n=(0,O.uniq)([...e.iframes,t.alternative]);return Object.assign(Object.assign({},e),{activeAlternative:t.alternative,iframes:(0,O.isEqual)(e.iframes,n)?e.iframes:n})}case"SET_ACTIVE_FILTER":return Object.assign(Object.assign({},e),{activeFilter:t.filter});case"SET_ACTIVE_MODE":return Object.assign(Object.assign({},e),{activeMode:t.mode});case"SET_ACTIVE_RESOLUTION":return Object.assign(Object.assign({},e),{activeResolution:t.resolution});case"SET_DISABLED_FILTER_OPTIONS":return Object.assign(Object.assign({},e),{disabledFilterOptions:(0,O.isEqual)(e.disabledFilterOptions,t.disabledFilterOptions)?e.disabledFilterOptions:t.disabledFilterOptions});case"SET_INTERACTIVE":return Object.assign(Object.assign({},e),{isInteractive:t.isInteractive});case"SET_INTENSITY":return Object.assign(Object.assign({},e),{intensity:t.intensity});case"MAKE_SIDEBAR_VISIBLE":return Object.assign(Object.assign({},e),{isSidebarVisible:t.isSidebarVisible});case"SET_OPACITY":return Object.assign(Object.assign({},e),{opacity:t.opacity})}}(e,t))&&void 0!==n?n:e}}),U={mode:"missing"};function q(e,t){var n,s;return null!==(s=null===(n=e.data.byAlternative[t])||void 0===n?void 0:n.raw.status)&&void 0!==s?s:U}function H(e,t){var n,s;return null!==(s=null===(n=e.data.byAlternative[t])||void 0===n?void 0:n.raw.progress)&&void 0!==s?s:0}function $(e,t){var n,s;return null!==(s=null===(n=e.data.byAlternative[t])||void 0===n?void 0:n.raw.results.clicks)&&void 0!==s?s:p.EMPTY_ARRAY}function z(e,t){var n,s;return null!==(s=null===(n=e.data.byAlternative[t])||void 0===n?void 0:n.raw.results.scrolls)&&void 0!==s?s:p.EMPTY_ARRAY}const Y={clicks:{count:0,length:0},scrolls:{count:0,length:0}};function G(e,t){var n,s;return null!==(s=null===(n=e.data.byAlternative[t])||void 0===n?void 0:n.loadAttempts)&&void 0!==s?s:Y}function Q(e,t){var n;const s=null===(n=e.data.byAlternative[t])||void 0===n?void 0:n.raw.status.mode;return"still-loading"===s||"ready"===s||"canceling"===s}function K(e,t,n){var s;return!!(null===(s=e.data.byAlternative[t])||void 0===s?void 0:s.byResolution[n].results)}function X(e,t,n){var s,a;return null!==(a=null===(s=e.data.byAlternative[t])||void 0===s?void 0:s.byResolution[n].status)&&void 0!==a?a:"missing"}function J(e,t,n){var s,a,i;return null!==(i=null===(a=null===(s=e.data.byAlternative[t])||void 0===s?void 0:s.byResolution[n].results)||void 0===a?void 0:a.clicks)&&void 0!==i?i:p.EMPTY_ARRAY}const Z={rows:1,max:1,value:[1],columns:1};function ee(e,t,n){var s,a,i;return null!==(i=null===(a=null===(s=e.data.byAlternative[t])||void 0===s?void 0:s.byResolution[n].results)||void 0===a?void 0:a.clicksPerSquare)&&void 0!==i?i:Z}function te(e,t,n){var s,a,i;return null!==(i=null===(a=null===(s=e.data.byAlternative[t])||void 0===s?void 0:s.byResolution[n].results)||void 0===a?void 0:a.scrolls)&&void 0!==i?i:p.EMPTY_ARRAY}const ne={rows:p.EMPTY_ARRAY,maxHits:0,averageFold:0};function se(e,t,n){var s,a,i;return null!==(i=null===(a=null===(s=e.data.byAlternative[t])||void 0===s?void 0:s.byResolution[n].results)||void 0===a?void 0:a.scrollSummary)&&void 0!==i?i:ne}function ae(e,t,n){var s,a;return null!==(a=null===(s=e.data.byAlternative[t])||void 0===s?void 0:s.byResolution[n].confettiFilterOptions)&&void 0!==a?a:e.data.confettiFilterOptions}function ie(e,t,n){var s;return null===(s=e.data.byAlternative[t])||void 0===s?void 0:s.byResolution[n].page.clickVisibilityProps}function re(e,t,n){var s;return null===(s=e.data.byAlternative[t])||void 0===s?void 0:s.byResolution[n].page.dimensions}function le(e){return e.misc.firstDayOfWeek}function oe(e,t){var n;return null!==(n=e.misc.iframeStatus[t])&&void 0!==n?n:"waiting-script"}const ce={averageFold:(0,g._x)("Average Fold:","text","nelio-ab-testing"),clicksAbove:(0,g._x)("Clicks above:","text","nelio-ab-testing"),popularity:(0,g._x)("Popularity:","text","nelio-ab-testing"),unknown:(0,g._x)("unknown","text","nelio-ab-testing")};function ue(e){return ce}function de(e){return e.ui.activeAlternative}function be(e){return e.ui.activeFilter}function me(e){return e.ui.activeMode}function pe(e){return e.ui.activeResolution}function ge(e){return e.ui.disabledFilterOptions}function xe(e){return e.ui.iframes}function he(e){return e.ui.intensity}function ve(e){return e.ui.isInteractive}function _e(e){return e.ui.isSidebarVisible}function fe(e){return e.ui.opacity}function ye(e,t){return{type:"RECEIVE_RAW_RESULTS",alternative:e,data:t}}function je(e,t){return{type:"SET_RAW_RESULT_STATUS",alternative:e,status:t}}function we(e,t){return{type:"SET_RAW_RESULT_PROGRESS",alternative:e,progress:t}}function Oe(e,t,n){return{type:"UPDATE_LOAD_ATTEMPTS",alternative:e,clicks:t,scrolls:n}}function Se(e,t,n){return{type:"SET_PROCESSED_RESULTS",alternative:e,resolution:t,results:n}}function Re(e,t,n){return{type:"SET_PAGE_INFO",alternative:e,resolution:t,page:n}}function Ae(e,t){return{type:"MARK_RESULTS_AS_PROCESSING",alternative:e,resolution:t}}function ke(e,t){return{type:"REQUEST_RESULTS_PROCESSING",alternative:e,resolution:t}}function Ee(e){return{type:"SET_FIRST_DAY_OF_WEEK",day:e}}function Te(e,t){return{type:"SET_IFRAME_STATUS",alternative:e,status:t}}function Ne(e){return{type:"SET_ACTIVE_ALTERNATIVE",alternative:e}}function Pe(e){return{type:"SET_ACTIVE_FILTER",filter:e}}function Ie(e){return{type:"SET_ACTIVE_MODE",mode:e}}function Ce(e){return{type:"SET_ACTIVE_RESOLUTION",resolution:e}}function De(e){return{type:"SET_DISABLED_FILTER_OPTIONS",disabledFilterOptions:e}}function Fe(e){return{type:"SET_INTERACTIVE",isInteractive:e}}function Me(e){return{type:"SET_INTENSITY",intensity:e}}function We(e){return{type:"MAKE_SIDEBAR_VISIBLE",isSidebarVisible:e}}function Ve(e){return{type:"SET_OPACITY",opacity:e}}const Be=window.wp.apiFetch;var Le=n.n(Be);const Ue=window.wp.date,qe=window.wp.url,He=e=>{var t,n;return!!(null===(t=e.url)||void 0===t?void 0:t.includes("/wp-json/"))||!!(null===(n=e.url)||void 0===n?void 0:n.includes("rest_route"))||!!Object.keys(e).includes("rest_route")},$e=100;var ze=function(e,t,n,s){return new(n||(n=Promise))(function(a,i){function r(e){try{o(s.next(e))}catch(e){i(e)}}function l(e){try{o(s.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,t||[])).next())})};const Ye={desktop:{width:1600,height:900},tablet:{width:1024,height:576},smartphone:{width:460,height:818}};function Ge(e,t){return ze(this,void 0,void 0,function*(){if("missing"!==(0,f.select)(ct).getRawResultStatus(t).mode)return;const{setRawResultStatus:n}=(0,f.dispatch)(ct);yield n(t,{mode:"loading"});try{yield Ze("clicks-and-scrolls",e,t)}catch(e){const s=function(e){if(e&&"object"==typeof e){if("code"in e&&"string"==typeof e.code&&e.code)return e.code;if("message"in e&&"string"==typeof e.message&&e.message)return e.message}return"string"==typeof e?e:"unknown"}(e),a=(0,f.select)(ct).getRawClicks(t);switch(s){case"fetch_error":case"fetch-error":return void(yield n(t,{mode:"error",rationale:"unreachable-servers"}));case"stuck-attempt-count":return void(yield n(t,a.length?{mode:"ready",partialError:"stuck-results"}:{mode:"error",rationale:"stuck-empty-results"}));case"heatmap-data-not-available":return void(yield n(t,{mode:"error",rationale:"heatmap-data-not-available"}));default:yield n(t,a.length?{mode:"ready",partialError:"unknown"}:{mode:"error",rationale:"unknown"})}}})}function Qe(e,t){return ze(this,void 0,void 0,function*(){if(!(0,f.select)(ct).canRawDataBeProcessed(e))return;const n=(0,f.select)(ct).getClickVisibilityProps(e,t);if(!n)return;if("processing"===(0,f.select)(ct).getProcessedResultStatus(e,t))return;yield(0,f.dispatch)(ct).markResultsAsProcessing(e,t);const s=(new Date).getTime(),a=!(0,f.select)(ct).hasProcessedResults(e,t),i=(0,f.select)(ct).getRawClicks(e).filter(Ke(t)).map(Je(n)).filter(p.isDefined),r=(0,f.select)(ct).getRawScrolls(e).filter(Xe(t)),l=function(e,t,n){const s=(0,f.select)(ct).getPageDimensions(e,t);if(!s)return{columns:1,value:[n.length],max:n.length,rows:1};const{width:a,bodyHeight:i}=s,r=Math.ceil(a/$e),l=Math.ceil(i/$e),o=new Array(l*r).fill(0).map(()=>0);return n.forEach(e=>{const{x:t,y:n}=e.realCoordinates,s=Math.floor(t/$e),a=Math.floor(n/$e)*r+s;a<0&&o.length<=a||(o[a]=(o[a]||0)+e.intensity)}),{columns:r,value:o,max:Math.max(1,o.reduce((e,t)=>Math.max(e,t||0))),rows:l}}(e,t,i),o=function(e,t,n){const s=(0,f.select)(ct).getPageDimensions(e,t);if(!s)return{rows:[0],maxHits:0,averageFold:250};const{bodyHeight:a,iframeHeight:i}=s,r=Math.ceil(i/50),l=new Array(r).fill(0);let o=0;return n.forEach(({firstFold:e,maxScroll:t,sweetSpot:n,documentHeight:s})=>{var i,c;o+=e,t=Math.round(t/s*a),n=Math.round(n/s*a);const u=Math.ceil(t/50),d=Math.min(u,r-1);for(let e=0;e<=d;++e)l[e]=1+(null!==(i=l[e])&&void 0!==i?i:0);const b=Math.floor((n-e/2)/50),m=Math.ceil((n+e/2)/50),p=Math.min(m,r-1);for(let e=Math.max(0,b);e<=p;++e)l[e]=1+(null!==(c=l[e])&&void 0!==c?c:0)}),{rows:l,maxHits:l.reduce((e,t)=>e>t?e:t,0),averageFold:!!n.length&&Math.ceil(o/n.length)}}(e,t,r);if(a){const e=(new Date).getTime()-s,t=Math.max(0,1e3-e);yield new Promise(e=>setTimeout(e,t))}yield(0,f.dispatch)(ct).setProcessedResults(e,t,{clicks:i,scrolls:r,scrollSummary:o,clicksPerSquare:l})})}const Ke=e=>{const{min:t,max:n}=lt(e);return({windowWidthInPx:e})=>t<=e&&e<=n},Xe=e=>{const{min:t,max:n}=lt(e);return({windowWidth:e})=>t<=e&&e<=n},Je=e=>t=>{const n=e[t.id];if(n&&"missing"!==n.status)return Object.assign(Object.assign({},t),{realCoordinates:Object.assign(Object.assign({},t.realCoordinates),n.coords),visibility:"visible"===n.status?"visible":"hidden"})};function Ze(e,t,n){return ze(this,void 0,void 0,function*(){if("none"===e)return;if(0===t.id)return void(yield(0,f.dispatch)(ct).setRawResultStatus(n,{mode:"ready"}));const s=e.includes("clicks"),a=e.includes("scrolls"),[i,r]=yield Promise.all([s&&et("clicks",t,n),a&&et("scrolls",t,n)]);yield(0,f.dispatch)(ct).updateLoadAttempts(n,i||void 0,r||void 0);const l=(0,f.select)(ct).getRawClicks(n),o=(0,f.select)(ct).getRawScrolls(n),c={clicks:i&&i.data.length!==l.length?tt(i.data):l,scrolls:r&&r.data.length!==o.length?r.data:o},u=(0,f.select)(ct).getLoadAttempts(n);if(u.clicks.count>=5||u.scrolls.count>=5)throw new Error("stuck-attempt-count");const d=!!c.clicks.length,b=!i||!i.more,m=!r||!r.more,p=b&&m,g=b&&!d?"error":p?"ready":d?"still-loading":"loading";return yield(0,f.dispatch)(ct).receiveRawResults(n,{results:c,status:"error"===g?{mode:"error",rationale:"no-heatmap-data"}:{mode:g},progress:p?100:nt(t,n,c.clicks)}),new Promise((e,s)=>{setTimeout(()=>{Ze(b&&!d?"none":b||m?b?m?"none":"scrolls":"clicks":"clicks-and-scrolls",t,n).then(e).catch(s)},5e3)})})}function et(e,t,n){return ze(this,void 0,void 0,function*(){const s=(0,g.sprintf)("/nab/v1/experiment/%1$s/heatmap/%2$s/%3$d",t.id,e,n),a=yield(e=>{const{url:t,path:n}=e,s=(0,Ue.format)("YmjHi").substring(0,11)+"0";return Le()(Object.assign(Object.assign(Object.assign(Object.assign({},e),t&&{url:He(e)?(0,qe.addQueryArgs)(t,{nabts:s}):t}),n&&{path:(0,qe.addQueryArgs)(n,{nabts:s})}),{parse:!0}))})({path:s});if(!a.url)return{more:a.more,data:[]};const i=yield fetch(a.url),r=(yield i.text()).replaceAll("}{","}\n{").split("\n"),l=Array.from(new Set(r)).filter(e=>!!e).map(it).filter(e=>!!e);return{more:a.more,data:l}})}function tt(e){const t=(0,g._x)("Unknown","text","nelio-ab-testing");return e.map(e=>{return Object.assign(Object.assign({},e),{browser:e.browser||t,country:e.country||t,dayOfWeek:(s=e.dayOfWeek,`${s}`),device:e.device||t,hourOfDay:(n=e.hourOfDay,"string"==typeof n&&(n=Number.parseInt(n),isNaN(n)&&(n=0)),`${Math.floor(n/2)}`),intensity:e.intensity||1,os:e.os||t,timeToClick:st(e.timeToClick),windowWidth:at(e.windowWidth),windowWidthInPx:"number"==typeof e.windowWidth?e.windowWidth:Number.parseInt(e.windowWidth)||0,realCoordinates:{x:-1,y:-1}});var n,s})}function nt(e,t,n){if(!e.startDate)return 0;const s=(new Date).toISOString(),a=rt(e.startDate,"finished"===e.status&&e.endDate||s);if(a<10)return 100;const i=(0,O.first)(n),r=(0,O.last)(n);if(!(null==i?void 0:i.timestamp)||!(null==r?void 0:r.timestamp))return 0;const l=100*rt(i.timestamp,r.timestamp)/a,o=Math.max(1,Math.floor(l)),c=(0,f.select)(ct).getRawResultProgress(t);return Math.max(o,c)}function st(e){"string"==typeof e&&(e=Number.parseInt(e));const t=[2,3,4,5,10,15,20,25,30,60,120,180,300];for(let n=0;n<t.length;++n){const s=t[n];if(s&&e<=s)return`${n}`}return`${t.length}`}function at(e){"string"==typeof e&&(e=Number.parseInt(e));const t=[300,600,900,1200,1500,1800,2100];for(let n=0;n<t.length;++n){const s=t[n];if(s&&e<s)return`${n}`}return`${t.length}`}function it(e){try{return JSON.parse(e)}catch(e){return!1}}const rt=(e,t)=>Math.ceil(Math.abs(new Date(e).getTime()-new Date(t).getTime())/36e5);function lt(e){const t=Ye[e].width,n=Object.values(Ye).map(({width:e})=>e),s=n.reduce((e,n)=>n<t?Math.max(n,e):e,-1);let a=n.reduce((e,n)=>t<n?Math.min(n,e):e,Number.POSITIVE_INFINITY);return Number.POSITIVE_INFINITY!==a&&(a=t),{min:s+1,max:a}}const ot=Object.assign(Object.assign({},a),i),ct=(0,f.createReduxStore)("nab/heatmap",{reducer:L,controls:f.controls,actions:ot,selectors:s});!function(e){(0,f.register)(e)}(ct);const ut=()=>y(e=>{const{getPageAttribute:t,getExperiment:n}=e(j.store),s=t("editor/activeExperiment");return n(null!=s?s:0)},[]),dt=()=>[y(e=>e(ct).getActiveAlternative(),[]),(0,f.useDispatch)(ct).setActiveAlternative],bt=()=>{const[e]=dt(),{setRawResultStatus:t}=(0,f.useDispatch)(ct);return[y(t=>t(ct).getRawResultStatus(e),[e]),n=>t(e,n)]},mt=()=>{const[e]=dt(),[t]=_t();return y(n=>n(ct).getProcessedResultStatus(e,t),[e,t])},pt=()=>"processing"===mt(),gt=()=>{const[e,t]=xt(),n=y(e=>e(ct).getActiveFilter(),[]),{setActiveFilter:s}=(0,f.useDispatch)(ct);return[n,e=>{e!==n&&(t([]),s(e))}]},xt=()=>[y(e=>e(ct).getDisabledFilterOptions(),[]),(0,f.useDispatch)(ct).setDisabledFilterOptions],ht=()=>[y(e=>e(ct).getActiveMode(),[]),(0,f.useDispatch)(ct).setActiveMode],vt=()=>[y(e=>e(ct).isSidebarVisible(),[]),(0,f.useDispatch)(ct).makeSidebarVisible],_t=()=>[y(e=>e(ct).getActiveResolution(),[]),(0,f.useDispatch)(ct).setActiveResolution],ft=()=>[y(e=>e(ct).getIntensity(),[]),(0,f.useDispatch)(ct).setIntensity],yt=()=>[y(e=>e(ct).isInteractive(),[]),(0,f.useDispatch)(ct).setInteractive],jt=()=>[y(e=>e(ct).getOpacity(),[]),(0,f.useDispatch)(ct).setOpacity],wt=()=>{const[e]=(0,j.usePageAttribute)("isLocked",!1),[t]=(0,j.usePageAttribute)("editor/isExperimentBeingStopped",!1),n=bt()[0].mode,s=mt();return e||t||"missing"===n||"loading"===n||"missing"===s||"processing"===s},Ot=e=>{const{experimentId:t}=e,n=y(e=>e(j.store).getExperiment(t),[t]),s=y(e=>e(ct).getActiveAlternative(),[]);if(St(e),Rt(t,s),At(),!n)return null;const{children:a}=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)(w,{}),a]})},St=e=>{const{setPageAttribute:t}=(0,f.useDispatch)(j.store),{setActiveAlternative:n,setFirstDayOfWeek:s}=(0,f.useDispatch)(ct);y(t=>t(j.store).getExperimentResults(e.experimentId),[e.experimentId]);const{experimentId:a,experimentType:i,alternativeIndex:r,firstDayOfWeek:l,isPublicView:o,isReadOnlyActive:u}=e;(0,c.useEffect)(()=>{t("editor/activeExperiment",a),t("editor/activeExperimentType",i),t("results/isPublicView",o),t("results/isReadOnlyActive",u),n(r),s(l%7)},[a,i,r,l,o,u,t,n,s])},Rt=(e,t)=>{const n=y(t=>t(j.store).getExperiment(e),[e]),s=y(t=>!t(j.store).hasFinishedResolution("getExperiment",[e])&&!t(j.store).hasResolutionFailed("getExperiment",[e]),[e]),{loadResults:a,setRawResultStatus:i}=(0,f.useDispatch)(ct);(0,c.useEffect)(()=>{s||(n?a(n,t):i(t,{mode:"error",rationale:"experiment-not-found"}))},[n,t,s,a,i])},At=()=>{const{requestResultProcessing:e}=(0,f.useDispatch)(ct),t=ut(),[n]=dt(),s=y(e=>e(ct).getActiveResolution(),[]),{clicks:a,scrolls:i,processedStatus:r,rawStatus:l}=y(e=>{var t;return{mode:e(ct).getActiveMode(),clicks:e(ct).getRawClicks(n),scrolls:e(ct).getRawScrolls(n),processedStatus:e(ct).getProcessedResultStatus(n,s),rawStatus:null===(t=e(ct).getRawResultStatus(n))||void 0===t?void 0:t.mode}},[n,s]);(0,c.useEffect)(()=>{t&&"missing"!==l&&"loading"!==l&&"error"!==l&&"ready"!==r&&"processing"!==r&&e(n,s)},[t,n,s,a,i,r,l,e])};function kt(e){var t,n,s="";if("string"==typeof e||"number"==typeof e)s+=e;else if("object"==typeof e)if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(n=kt(e[t]))&&(s&&(s+=" "),s+=n)}else for(n in e)e[n]&&(s&&(s+=" "),s+=n);return s}const Et=function(){for(var e,t,n=0,s="",a=arguments.length;n<a;n++)(e=arguments[n])&&(t=kt(e))&&(s&&(s+=" "),s+=t);return s},Tt=window.wp.components,Nt=Object.assign(e=>(0,r.jsx)(Tt.BaseControl,Object.assign({__nextHasNoMarginBottom:!0},e)),Tt.BaseControl),Pt=Object.assign(e=>(0,r.jsx)(Tt.CheckboxControl,Object.assign({__nextHasNoMarginBottom:!0},e)),Tt.CheckboxControl),It=(Object.assign(e=>(0,r.jsx)(Tt.FormTokenField,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),Tt.FormTokenField),Object.assign(e=>(0,r.jsx)(Tt.RangeControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),Tt.RangeControl)),Ct=e=>(0,r.jsx)(Tt.SelectControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),Dt=(Object.assign(e=>(0,r.jsx)(Tt.TextControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),Tt.TextControl),Object.assign(e=>(0,r.jsx)(Tt.TextareaControl,Object.assign({__nextHasNoMarginBottom:!0},e)),Tt.TextareaControl),Object.assign(e=>(0,r.jsx)(Tt.ToggleControl,Object.assign({__nextHasNoMarginBottom:!0},e)),Tt.ToggleControl)),Ft=(Object.assign(e=>(0,r.jsx)(Tt.__experimentalToggleGroupControl,Object.assign({__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0},e)),Tt.__experimentalToggleGroupControl),()=>{const[e,t]=Mt(),n=Wt(),s=Vt();if(!e||!n.length)return null;const a=n.map((e,t)=>({value:e,label:(0,g.sprintf)(/* translators: %s: Variant letter. */ /* translators: %s: Variant letter. */
(0,g._x)("Variant %s","text","nelio-ab-testing"),(0,p.getLetter)(t))}));return(0,r.jsx)("div",{className:"nab-heatmap-results-header__variant",children:(0,r.jsx)(Ct,{disabled:s,value:e,options:a,onChange:t})})}),Mt=()=>{const e=y(e=>e(ct).getActiveAlternative(),[]),t=Wt(),n=t[e],{setActiveAlternative:s}=(0,f.useDispatch)(ct);return[n,e=>{const n=(0,O.indexOf)(t,e);s(n);const a=(0,qe.addQueryArgs)(document.location.href,{heatmap:n});window.history.replaceState({},"",a)}]},Wt=()=>{const e=ut();return"nab/heatmap"===(null==e?void 0:e.type)?[]:(0,O.map)(null==e?void 0:e.alternatives,"id")},Vt=()=>{const[e]=(0,j.usePageAttribute)("isLocked",!1),[t]=(0,j.usePageAttribute)("editor/isExperimentBeingStopped",!1),n=bt()[0].mode,s=mt();return e||t||"missing"===n||"loading"===n||"processing"===s},Bt=()=>{const e=qt(),t=Ht(),[n]=bt(),s=n.mode,[a]=(()=>{const[e]=dt(),{setRawResultProgress:t}=(0,f.useDispatch)(ct);return[y(t=>t(ct).getRawResultProgress(e),[e]),n=>t(e,n)]})(),[i,l]=(()=>{const[e]=dt(),[t]=bt(),{setRawResultStatus:n}=(0,f.useDispatch)(ct);return["canceling"===t.mode,()=>{switch(t.mode){case"canceling":case"ready":case"error":case"missing":return;case"loading":case"still-loading":return void n(e,{mode:"canceling"})}}]})(),{stopExperiment:o}=(0,f.useDispatch)(j.store);return"loading"===s||"error"===s||"missing"===s?(0,r.jsxs)("div",{className:"nab-heatmap-results-sidebar__header-actions",children:[(0,r.jsx)(Lt,{}),!e&&(0,r.jsx)("div",{className:"nab-heatmap-results-sidebar__alt-switcher",children:(0,r.jsx)(Ft,{})})]}):"still-loading"===s||"canceling"===s?(0,r.jsxs)("div",{className:"nab-heatmap-results-sidebar__header-actions",children:[(0,r.jsx)(Lt,{}),(0,r.jsxs)("div",{className:"nab-heatmap-results-sidebar__running-actions",children:[a?(0,r.jsx)("span",{className:"nab-heatmap-results-sidebar__progress",children:(0,g.sprintf)(/* translators: %d: Percentage. */ /* translators: %d: Percentage. */
(0,g._x)("Fetching more data… (%d%%)","text","nelio-ab-testing"),Math.min(a,99))}):(0,r.jsx)(Tt.Spinner,{}),"canceling"!==s&&(0,r.jsx)(Tt.Button,{variant:"link",onClick:l,children:(0,g._x)("Cancel","command","nelio-ab-testing")})]})]}):(0,r.jsxs)("div",{className:"nab-heatmap-results-sidebar__header-actions",children:[(0,r.jsx)(Lt,{}),e&&t&&(0,r.jsx)("div",{className:"nab-heatmap-results-sidebar__running-actions",children:(0,r.jsx)(Tt.Button,{variant:"primary",onClick:()=>{o()},disabled:i,isBusy:i,children:i?(0,g._x)("Stopping…","text","nelio-ab-testing"):(0,g._x)("Stop","command","nelio-ab-testing")})}),!e&&(0,r.jsx)("div",{className:"nab-heatmap-results-sidebar__alt-switcher",children:(0,r.jsx)(Ft,{})})]})},Lt=()=>{const[e]=(0,j.usePageAttribute)("results/isPublicView",!1),t=Ut();return e?null:(0,r.jsx)("div",{className:"nab-heatmap-results-sidebar__back",children:(0,r.jsx)("a",{className:"nab-heatmap-results-sidebar__back-link",href:t,title:(0,g._x)("Back…","command","nelio-ab-testing"),children:(0,r.jsx)(Tt.Dashicon,{icon:"arrow-left-alt2"})})})},Ut=()=>{const e=(0,j.useAdminUrl)("edit.php",{post_type:"nab_experiment"}),t=ut();if(t)return"nab/heatmap"===t.type?e:t.links.edit},qt=()=>{var e;return"nab/heatmap"===(null===(e=ut())||void 0===e?void 0:e.type)},Ht=()=>{var e;return"running"===(null===(e=ut())||void 0===e?void 0:e.status)},$t=()=>{const[e,t]=vt(),n=wt(),[s,a]=_t();return(0,r.jsxs)("div",{className:"nab-heatmap-results-sidebar__footer-actions",children:[(0,r.jsx)("div",{className:Et({"nab-heatmap-results-sidebar__visibility-toggle":!0,"nab-heatmap-results-sidebar__visibility-toggle--hide":!!e,"nab-heatmap-results-sidebar__visibility-toggle--show":!e}),children:(0,r.jsx)(Tt.Button,{variant:"link",onClick:()=>t(!e),children:e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Tt.Dashicon,{icon:"admin-collapse"}),(0,r.jsx)("span",{className:"nab-heatmap-results-sidebar__visibility-toggle-label",children:(0,g._x)("Hide Controls","command","nelio-ab-testing")})]}):(0,r.jsx)(Tt.Dashicon,{icon:"admin-collapse"})})}),(0,r.jsxs)("div",{className:"nab-heatmap-results-sidebar__resolutions",children:[(0,r.jsx)("div",{className:Et({"nab-heatmap-results-sidebar__resolution":!0,"nab-heatmap-results-sidebar__resolution--is-active":"desktop"===s}),children:(0,r.jsxs)(Tt.Button,{variant:"link",onClick:()=>a("desktop"),disabled:n,children:[(0,r.jsx)(Tt.Dashicon,{icon:"desktop"}),(0,r.jsx)("span",{className:"screen-reader-text",children:(0,g._x)("Enter desktop preview mode","command","nelio-ab-testing")})]})}),(0,r.jsx)("div",{className:Et({"nab-heatmap-results-sidebar__resolution":!0,"nab-heatmap-results-sidebar__resolution--is-active":"tablet"===s}),children:(0,r.jsxs)(Tt.Button,{variant:"link",onClick:()=>a("tablet"),disabled:n,children:[(0,r.jsx)(Tt.Dashicon,{icon:"tablet"}),(0,r.jsx)("span",{className:"screen-reader-text",children:(0,g._x)("Enter tablet preview mode","command","nelio-ab-testing")})]})}),(0,r.jsx)("div",{className:Et({"nab-heatmap-results-sidebar__resolution":!0,"nab-heatmap-results-sidebar__resolution--is-active":"smartphone"===s}),children:(0,r.jsxs)(Tt.Button,{variant:"link",onClick:()=>a("smartphone"),disabled:n,children:[(0,r.jsx)(Tt.Dashicon,{icon:"smartphone"}),(0,r.jsx)("span",{className:"screen-reader-text",children:(0,g._x)("Enter mobile preview mode","command","nelio-ab-testing")})]})})]})]})},zt=window.nab.i18n,Yt=({clicks:e,views:t})=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(Tt.PanelRow,{className:"nab-experiment-summary__pageviews",children:[(0,r.jsx)("span",{children:(0,g._x)("Page Views","text","nelio-ab-testing")}),(0,r.jsx)("span",{children:void 0!==t?(0,zt.compactInteger)(t):"-"})]}),(0,r.jsxs)(Tt.PanelRow,{className:"nab-experiment-summary__clicks",children:[(0,r.jsx)("span",{children:(0,g._x)("Total Click Count","text","nelio-ab-testing")}),(0,r.jsx)("span",{children:void 0!==e?(0,zt.compactInteger)(e):"-"})]})]}),Gt=({status:e})=>(0,r.jsxs)(Tt.PanelRow,{className:"nab-experiment-summary__status",children:[(0,r.jsx)("span",{children:(0,g._x)("Status","text","nelio-ab-testing")}),(0,r.jsx)("strong",{children:Qt(e)})]});function Qt(e){switch(e){case"paused":return(0,g._x)("Paused","text (experiment status)","nelio-ab-testing");case"finished":return(0,g._x)("Finished","text (experiment status)","nelio-ab-testing");default:return(0,g._x)("Running","text (experiment status)","nelio-ab-testing")}}const Kt=window.nab.date,Xt=({start:e,end:t,endMode:n,endValue:s})=>e&&n?(t=t||"",(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(Tt.PanelRow,{className:"nab-experiment-summary__start",children:[(0,r.jsx)("span",{children:(0,g._x)("Duration","text","nelio-ab-testing")}),(0,r.jsx)("span",{children:Jt(e,t)})]}),(0,r.jsxs)(Tt.PanelRow,{className:"nab-experiment-summary__start",children:[(0,r.jsx)("span",{children:(0,g._x)("Start","text","nelio-ab-testing")}),(0,r.jsx)("span",{children:(0,Kt.formatI18nDate)(e)})]}),t?(0,r.jsxs)(Tt.PanelRow,{className:"nab-experiment-summary__end",children:[(0,r.jsx)("span",{children:(0,g._x)("End","text","nelio-ab-testing")}),(0,r.jsx)("span",{children:(0,Kt.formatI18nDate)(t)})]}):(0,r.jsxs)(Tt.PanelRow,{className:"nab-experiment-summary__end-mode",children:[(0,r.jsx)("span",{children:(0,g._x)("End","text","nelio-ab-testing")}),(0,r.jsx)("span",{children:en(n,s)})]})]})):null;function Jt(e,t){const n=(0,p.computeDuration)(e,t),s=[n.years,n.months,n.days,n.hours,n.minutes],{years:a,months:i,days:r,hours:l,minutes:o}=n,c=[(0,g.sprintf)(/* translators: %d: Number of years. */ /* translators: %d: Number of years. */
(0,g._n)("%d year","%d years",a,"nelio-ab-testing"),a),(0,g.sprintf)(/* translators: %d: Number of months. */ /* translators: %d: Number of months. */
(0,g._n)("%d month","%d months",i,"nelio-ab-testing"),i),/* translators: %d: Number of days. */ /* translators: %d: Number of days. */
(0,g.sprintf)((0,g._n)("%d day","%d days",r,"nelio-ab-testing"),r),(0,g.sprintf)(/* translators: %d: Number of hours. */ /* translators: %d: Number of hours. */
(0,g._n)("%d hour","%d hours",l,"nelio-ab-testing"),l),(0,g.sprintf)(/* translators: %d: Number of minutes. */ /* translators: %d: Number of minutes. */
(0,g._n)("%d minute","%d minutes",o,"nelio-ab-testing"),o)];for(let e=0;e<s.length-1;++e){if(s[e]&&s[e+1])return Zt(c[e],c[e+1]);if(s[e])return c[e]}return s[s.length-1]?c[s.length-1]:(0,g._x)("Less than a minute","text","nelio-ab-testing")}function Zt(e,t){return e||t?e&&t?`${e} ${(0,g._x)("and","text","nelio-ab-testing")} ${t}`:e||t:""}function en(e,t){switch(t=null!=t?t:0,e){case"duration":return(0,g.sprintf)(/* translators: %s: Number of days. */ /* translators: %s: Number of days. */
(0,g._n)("After %s day","After %s days",t,"nelio-ab-testing"),(0,zt.numberFormat)(t));case"page-views":return(0,g.sprintf)(/* translators: %s: Number. */ /* translators: %s: Number. */
(0,g._n)("After %s page view","After %s page views",t,"nelio-ab-testing"),(0,zt.numberFormat)(t));case"confidence":return(0,g.sprintf)(/* translators: %s: Percentage number, such as “95”. */ /* translators: %s: Percentage number, such as “95”. */
(0,g._x)("At %s%% confidence","text","nelio-ab-testing"),(0,zt.numberFormat)(t));default:return(0,g._x)("Manual","text","nelio-ab-testing")}}const tn=()=>{const e=(0,j.useExperimentAttribute)("status","running"),t=sn(),n=nn(),s={start:(0,j.useExperimentAttribute)("startDate",""),end:(0,j.useExperimentAttribute)("endDate",!1),endMode:(0,j.useExperimentAttribute)("endMode","manual"),endValue:(0,j.useExperimentAttribute)("endValue",0)};return(0,r.jsxs)(Tt.PanelBody,{className:"nab-experiment-summary",title:(0,g._x)("Summary","text (experiment)","nelio-ab-testing"),children:[(0,r.jsx)(Gt,{status:e}),(0,r.jsx)(Yt,{views:t,clicks:n}),(0,r.jsx)(Xt,Object.assign({},s))]})},nn=()=>y(e=>{const t=e(ct).getActiveAlternative(),n=e(ct).getActiveResolution();return e(ct).getClicksInResolution(t,n).length},[]),sn=()=>{const e=ut(),[t]=dt(),n=null==e?void 0:e.alternatives[t];return y(t=>(null==e?void 0:e.id)&&(null==n?void 0:n.id)?t(j.store).getAlternativePageViews(e.id,n.id):0,[null==e?void 0:e.id,null==n?void 0:n.id])},an=()=>{const e=function(e){const t=y(e=>e(j.store).getPageAttribute("editor/activeExperiment"),[]);return y(n=>t?n(j.store).getExperimentAttribute(t,e):void 0,[t,e])}("description");return(0,r.jsx)(Tt.PanelBody,{className:"nab-experiment-description",title:(0,g._x)("Description","text","nelio-ab-testing"),children:e||(0,g._x)("None","text (description)","nelio-ab-testing")})},rn=()=>{const e=wt(),[t,n]=jt();return(0,r.jsx)(It,{disabled:e,className:"nab-heatmap-opacity",label:(0,g._x)("Opacity","text","nelio-ab-testing"),value:t,onChange:e=>n(null!=e?e:25),min:25,max:75})},ln=()=>{const e=wt(),[t,n]=ft();return(0,r.jsx)(It,{disabled:e,className:"nab-heatmap-intensity",label:(0,g._x)("Heat Intensity","text","nelio-ab-testing"),value:t,onChange:e=>n(e||40),min:40,max:100})},on=()=>(0,r.jsx)(Nt,{id:"nab-scrollmap-legend",className:"nab-scrollmap-legend",label:(0,g._x)("Scrollmap Legend","text","nelio-ab-testing"),children:(0,r.jsxs)("div",{className:"nab-scrollmap-legend__container",children:[(0,r.jsxs)("div",{className:"nab-scrollmap-legend__scale",children:[(0,r.jsx)("div",{className:"nab-scrollmap-legend__percent nab-scrollmap-legend__percent--0"}),(0,r.jsx)("div",{className:"nab-scrollmap-legend__percent nab-scrollmap-legend__percent--25"}),(0,r.jsx)("div",{className:"nab-scrollmap-legend__percent nab-scrollmap-legend__percent--50"}),(0,r.jsx)("div",{className:"nab-scrollmap-legend__percent nab-scrollmap-legend__percent--75"}),(0,r.jsx)("div",{className:"nab-scrollmap-legend__percent nab-scrollmap-legend__percent--100"})]}),(0,r.jsxs)("div",{className:"nab-scrollmap-legend__text",children:[(0,r.jsx)("span",{children:(0,g._x)("Less popular","text","nelio-ab-testing")}),(0,r.jsx)("span",{children:(0,g._x)("More popular","text","nelio-ab-testing")})]})]})}),cn=window.wp.compose,un=({label:e,className:t,heading:n,checked:s,onChange:a,color:i,disabled:l})=>{const o=`inspector-checkbox-control-${(0,cn.useInstanceId)(un)}`,c=i?{borderColor:i,backgroundColor:i,opacity:s?1:.5}:{};return(0,r.jsxs)(Nt,{label:n,id:o,className:t,children:[(0,r.jsxs)("span",{className:"components-checkbox-control__input-container",children:[(0,r.jsx)("input",{id:o,style:c,className:"components-checkbox-control__input",type:"checkbox",value:"1",onChange:e=>a(!!e.target.checked),checked:s,disabled:l}),s?(0,r.jsx)(Tt.Dashicon,{icon:"yes",className:"components-checkbox-control__checked",role:"presentation"}):null]}),(0,r.jsx)("label",{className:"components-checkbox-control__label",htmlFor:o,children:e})]})},dn=()=>{const e=wt(),t=bn(),n=mn(),s=pn();if(!t)return null;const a=(0,O.sum)((0,O.map)(t,"value"));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Pt,{className:"nab-filter-option nab-filter-option--header",label:(0,r.jsxs)("span",{className:"nab-filter-option-label__container",children:[(0,r.jsx)("span",{className:"nab-filter-option-label__name",children:(0,g._x)("Name","text","nelio-ab-testing")}),(0,r.jsx)("span",{className:"nab-filter-option-label__amount",children:(0,g._x)("Amount","text","nelio-ab-testing")})]}),checked:!n.length,onChange:e=>s("all",e),disabled:e}),t.map(({key:t,label:i,value:l,color:o})=>(0,r.jsx)(un,{color:o,disabled:e,className:Et("nab-filter-option",{"nab-filter-option--deactivated":n.includes(t)}),label:(0,r.jsxs)("span",{className:"nab-filter-option-label__container",children:[(0,r.jsx)("span",{className:"nab-filter-option-label__name",title:i,children:i}),(0,r.jsxs)("span",{className:"nab-filter-option-label__amount-container",children:[(0,r.jsx)("span",{className:"nab-filter-option-label__value",children:"number"==typeof l?(0,zt.compactInteger)(l):l}),(0,r.jsx)("span",{className:"nab-bar__container",children:(0,r.jsx)("span",{className:"nab-bar__value",style:{width:l?`${(l/a*100).toFixed(2)}%`:"0px"}})})]})]}),checked:!n.includes(t),onChange:e=>s(t,e)},t))]})},bn=()=>{const{activeFilter:e,filterOptions:t,firstDayOfWeek:n}=y(e=>({activeFilter:e(ct).getActiveFilter(),filterOptions:e(ct).getConfettiFilterOptions(e(ct).getActiveAlternative(),e(ct).getActiveResolution()),firstDayOfWeek:e(ct).getFirstDayOfWeek()}),[]);let s=(0,O.values)(t[e]);return"dayOfWeek"===e&&(s=[...[...s].splice(n),...[...s].splice(0,n)]),"country"===e&&(s=s.map(e=>Object.assign(Object.assign({},e),{label:"other"===e.key?(0,g._x)("Other","text","nelio-ab-testing"):(0,p.getCountryName)(e.key)})),s=gn(s)),s},mn=()=>y(e=>e(ct).getDisabledFilterOptions(),[]),pn=()=>{const{setDisabledFilterOptions:e}=(0,f.useDispatch)(ct),t=bn(),n=mn();return y(e=>e(ct).getActiveFilter(),[])&&t.length?(s,a)=>{e("all"!==s?a?(0,O.without)(n,s):(0,O.uniq)([...n,s]):a?[]:(0,O.map)(t,"key"))}:O.noop},gn=e=>(0,O.sortBy)([...e],["label"]),xn=({kind:e})=>"confetti"===e?(0,r.jsx)(hn,{}):null,hn=()=>{const e=wt(),[t,n]=gt(),s=vn();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Ct,{className:"nab-confetti-filter",disabled:e,label:(0,g._x)("Filter","text","nelio-ab-testing"),value:t,onChange:e=>n(e),options:s}),(0,r.jsx)(dn,{})]})},vn=()=>fn,fn=(0,O.sortBy)([{value:"country",label:(0,g._x)("Country","text","nelio-ab-testing")},{value:"device",label:(0,g._x)("Device Type","text","nelio-ab-testing")},{value:"os",label:(0,g._x)("Operating System","text","nelio-ab-testing")},{value:"browser",label:(0,g._x)("Browser","text","nelio-ab-testing")},{value:"dayOfWeek",label:(0,g._x)("Day of Week","text","nelio-ab-testing")},{value:"hourOfDay",label:(0,g._x)("Time of Day","text","nelio-ab-testing")},{value:"timeToClick",label:(0,g._x)("Time to Click","text","nelio-ab-testing")},{value:"windowWidth",label:(0,g._x)("Window Width","text","nelio-ab-testing")}],"label"),yn=window.nab.components,jn=()=>{const[e,t]=ht(),[n,s]=yt(),a=wt(),i=On(),[l]=(0,j.usePageAttribute)("results/isPublicView",!1),[o,c]=(0,j.usePageAttribute)("results/isReadOnlyActive",!1),[u]=(0,j.usePageAttribute)("editor/activeExperiment",0),[d]=(0,j.usePageAttribute)("editor/activeExperimentType",""),{setPublicResultStatus:b}=(0,f.useDispatch)(j.store),m=(0,qe.addQueryArgs)(i,{"nab-result":!0,experiment:u,preview:""});return(0,r.jsx)(wn,{className:Et("nab-heatmap-kind-selector",{"nab-heatmap-kind-selector--locked":a}),activeClass:"nab-heatmap-kind-selector__tab--active",orientation:"horizontal",tabs:Sn,activeTab:e,onSelect:t,children:e=>(0,r.jsxs)(Tt.PanelBody,{className:"nab-heatmap-settings",title:(0,g._x)("Settings","text","nelio-ab-testing"),children:[(0,r.jsx)(rn,{}),"heatmap"===e.name&&(0,r.jsx)(ln,{}),("heatmap"===e.name||"confetti"===e.name)&&(0,r.jsx)(Dt,{className:"nab-heatmap-settings__interactive-option",checked:n,onChange:s,label:"heatmap"===e.name?(0,g._x)("Interactive heatmap","text","nelio-ab-testing"):(0,g._x)("Interactive confetti","text","nelio-ab-testing")}),(0,r.jsx)(xn,{kind:e.name}),"scrollmap"===e.name&&(0,r.jsx)(on,{}),"heatmap"===e.name&&"nab/heatmap"===d&&!l&&(0,r.jsxs)(Tt.PanelRow,{className:"nab-heatmap-settings__public-selector",children:[(0,r.jsx)(Dt,{label:(0,g._x)("Public results","text","nelio-ab-testing"),disabled:a,checked:o,onChange:e=>{b(e),c(e)}}),!!o&&(0,r.jsx)("div",{className:"nab-heatmap-settings__public-result",children:(0,r.jsxs)("div",{className:"nab-heatmap-settings__public-result-url",children:[(0,r.jsx)("input",{className:"nab-heatmap-settings__public-result-url-input",type:"text",value:m,readOnly:!0}),(0,r.jsx)(yn.ClipboardButton,{text:m})]})})]})]})})},wn=({className:e,activeClass:t,orientation:n,onSelect:s,children:a,activeTab:i,tabs:l})=>(0,r.jsxs)("div",{className:e,children:[(0,r.jsx)("div",{role:"tablist","aria-orientation":n,className:"components-tab-panel__tabs",children:l.map(e=>(0,r.jsx)("button",{type:"button",role:"tab",tabIndex:e.name===i?-1:void 0,"aria-selected":"false",id:`tab-panel-1-${e.name}`,"aria-controls":`tab-panel-1-${e.name}-view`,className:Et({"components-button components-tab-panel__tabs-item":!0,[e.className]:!0,[t]:e.name===i}),onClick:()=>s(e.name),children:e.title},e.name))}),(0,r.jsx)("div",{"aria-labelledby":`tab-panel-1-${i||l[0].name}`,role:"tabpanel",id:`tab-panel-1-${i||l[0].name}-view`,className:"components-tab-panel__tab-content",children:a(l.find(e=>e.name===i)||l[0])})]}),On=()=>y(e=>e(j.store).getPluginSetting("homeUrl"),[]),Sn=[{name:"heatmap",title:(0,g._x)("Heatmap","text","nelio-ab-testing"),className:"nab-heatmap-kind-selector__tab"},{name:"scrollmap",title:(0,g._x)("Scrollmap","text","nelio-ab-testing"),className:"nab-heatmap-kind-selector__tab"},{name:"confetti",title:(0,g._x)("Confetti","text","nelio-ab-testing"),className:"nab-heatmap-kind-selector__tab"}],Rn=()=>{const e=wt(),t="nab/heatmap"===(null===(n=ut())||void 0===n?void 0:n.type);var n;const s=An(),a=kn(),i=(()=>{const[e]=dt();return y(t=>t(ct).getRawClicks(e),[e])})(),l=En(t?`${s}`:`${s}-${a}`,i);return(0,r.jsxs)(Tt.PanelBody,{initialOpen:!1,className:"nab-export",title:(0,g._x)("Export","text","nelio-ab-testing"),children:[(0,r.jsx)("p",{children:(0,g._x)("Export all the clicks of the heatmap:","user","nelio-ab-testing")}),(0,r.jsx)(Tt.Button,{className:"nab-export__button",disabled:e,variant:"secondary",onClick:l,children:(0,g._x)("Download CSV","command","nelio-ab-testing")})]})},An=()=>y(e=>e(j.store).getPageAttribute("editor/activeExperiment"),[]),kn=()=>y(e=>e(ct).getActiveAlternative(),[]),En=(e,t)=>()=>{const n=[{accessor:e=>e.xpath||e.cssPath||"unknown",name:(0,g._x)("Element","text","nelio-ab-testing")},{accessor:e=>e.x,name:(0,g._x)("X coordinate","text","nelio-ab-testing")},{accessor:e=>e.y,name:(0,g._x)("Y coordinate","text","nelio-ab-testing")},{accessor:e=>e.browser,name:(0,g._x)("Browser","text","nelio-ab-testing")},{accessor:e=>e.country,name:(0,g._x)("Country","text","nelio-ab-testing")},{accessor:e=>e.os,name:(0,g._x)("OS","text","nelio-ab-testing")},{accessor:e=>e.device,name:(0,g._x)("Device","text","nelio-ab-testing")},{accessor:e=>e.windowWidthInPx,name:(0,g._x)("Window Width","text","nelio-ab-testing")},{accessor:e=>e.dayOfWeek,name:(0,g._x)("Day of Week","text","nelio-ab-testing")},{accessor:e=>e.hourOfDay,name:(0,g._x)("Hour of Day","text","nelio-ab-testing")},{accessor:e=>e.timeToClick,name:(0,g._x)("Time to Click","text","nelio-ab-testing")},{accessor:e=>e.timestamp,name:(0,g._x)("Timestamp","text","nelio-ab-testing")}];(0,p.downloadAsCsv)([n.map(e=>e.name),...t.map(e=>n.map(t=>t.accessor(e)))],(0,g.sprintf)(/* translators: %s: Unique identifier. */ /* translators: %s: Unique identifier. */
(0,g._x)("heatmap-clicks-%s.csv","text","nelio-ab-testing"),e))},Tn=()=>{const e=wt(),t=Nn(),n=Pn(),s=pt();return t?(0,r.jsxs)(Tt.PanelBody,{initialOpen:!1,className:"nab-advanced",title:(0,g._x)("Advanced","text","nelio-ab-testing"),children:[(0,r.jsx)("p",{children:(0,g._x)("Under some circumstances, when your page loads content dynamically, the results may be shifted from their correct position. Refresh the view to re-render the results properly:","user","nelio-ab-testing")}),(0,r.jsx)(Tt.Button,{className:"nab-advanced__reposition-button",disabled:e,isBusy:s,variant:"secondary",onClick:n,children:s?(0,g._x)("Refreshing View…","command","nelio-ab-testing"):(0,g._x)("Refresh View","command","nelio-ab-testing")})]}):null},Nn=()=>"scrollmap"!==ht()[0],Pn=()=>{const[e]=dt(),[t]=_t(),{requestResultProcessing:n}=(0,f.useDispatch)(ct);return()=>n(e,t)},In=()=>{const[e,t]=bt(),n=function(e){if("ready"!==e.mode)return"";switch(e.partialError){case"unknown":return(0,g._x)("Something went wrong and results couldn’t be fully loaded","text","nelio-ab-testing");case"stuck-results":return(0,g._x)("Results are still being computed in Nelio’s cloud","text","nelio-ab-testing");case void 0:return""}}(e);return n?(0,r.jsxs)("div",{className:"nab-heatmap-results-sidebar__error-message",children:[(0,r.jsx)("div",{children:n}),(0,r.jsx)("div",{children:(0,r.jsx)(Tt.Button,{icon:"no",onClick:()=>t({mode:"ready"}),label:(0,g._x)("Dismiss","command","nelio-ab-testing")})})]}):null},Cn=()=>{const e=ut(),t=Dn(e)?e.participationConditions:[],{setPageAttribute:n}=(0,f.useDispatch)(j.store);return(0,c.useEffect)(()=>{n("editor/activeSegment","default")},[n]),t.length?(0,r.jsxs)(Tt.PanelBody,{initialOpen:!1,className:"nab-participation-conditions",title:(0,g._x)("Participation","text","nelio-ab-testing"),children:[(0,r.jsx)("p",{children:(0,g._x)("Only visitors who met all the following criteria contributed to this heatmap:","text","nelio-ab-testing")}),t.map(e=>(0,r.jsx)(yn.SegmentationRule,{rule:e},e.id))]}):null},Dn=e=>!!e&&"participationConditions"in e,Fn=()=>{var e;const t=y(e=>e(j.store).getQuota(),[]),n=null===(e=ut())||void 0===e?void 0:e.status;return!t||t.availableQuota||"running"!==n?null:(0,r.jsxs)("div",{className:"nab-heatmap-results-sidebar__no-quota-warning",children:[(0,r.jsx)(Tt.Dashicon,{icon:"warning"}),(0,r.jsx)("span",{children:(0,g._x)("Event tracking has stopped because there’s no more quota available at the moment.","text","nelio-ab-testing")})]})},Mn=({className:e})=>(0,r.jsxs)("div",{className:Et(["nab-heatmap-results-sidebar",e]),children:[(0,r.jsx)(Bt,{}),(0,r.jsx)(Fn,{}),(0,r.jsxs)("div",{className:"nab-heatmap-results-sidebar__wrapper",children:[(0,r.jsx)(jn,{}),(0,r.jsx)(tn,{}),(0,r.jsx)(an,{}),(0,r.jsx)(Cn,{}),(0,r.jsx)(Rn,{}),(0,r.jsx)(Tn,{})]}),(0,r.jsx)(In,{}),(0,r.jsx)($t,{})]}),Wn=({className:e,alternative:t,contentUrl:n})=>{const[s]=dt();Ln(t),Un(t),qn(t),Hn(t),$n(t);const[a]=_t(),i=Bn(t),l=t!==s;return(0,r.jsxs)("div",{className:e,children:[(0,r.jsx)(Vn,{}),(0,r.jsx)("iframe",{id:`nab-heatmap-results__iframe-${t}`,className:Et({"nab-heatmap-results__iframe":!0,[`nab-heatmap-results__iframe--${a}`]:!0,"nab-heatmap-results__iframe--is-hidden":l}),title:(0,g._x)("Content of the heatmap","text","nelio-ab-testing"),src:n,onLoad:()=>i()})]})},Vn=()=>{const e=pt(),t=(()=>{const[e]=dt(),[t]=_t();return y(n=>n(ct).hasProcessedResults(e,t),[e,t])})(),[n]=bt();return"still-loading"===n.mode||"canceling"===n.mode||"ready"===n.mode?!e||t?null:(0,r.jsx)("div",{className:"nab-heatmap-results__loader",children:(0,r.jsx)(yn.LoadingAnimation,{text:(0,g._x)("Processing results…","text","nelio-ab-testing")})}):"error"===n.mode?(0,r.jsxs)("div",{className:"nab-heatmap-results__loader",children:[(0,r.jsx)(yn.BigMessage,{icon:Gn(n.rationale),text:Yn(n.rationale)}),"unreachable-servers"===n.rationale&&(0,r.jsx)("div",{className:"nab-heatmap-results__adblock-explanation",children:(0,g._x)("If you’re using an adblocker on your browser, please disable it as it’s probably blocking Nelio A/B Testing’s requests, thus preventing the plugin from pulling your heatmap data.","user","nelio-ab-testing")})]}):(0,r.jsx)("div",{className:"nab-heatmap-results__loader",children:(0,r.jsx)(yn.LoadingAnimation,{text:"loading"===n.mode?(0,g._x)("Fetching results…","text","nelio-ab-testing"):(0,g._x)("Loading page…","text","nelio-ab-testing")})})},Bn=e=>{const{setIFrameStatus:t}=(0,f.useDispatch)(ct);return()=>{setTimeout(()=>{const{getIFrameStatus:n}=(0,f.select)(ct);"waiting-script"===n(e)&&t(e,"script-not-found")},3e4)}},Ln=e=>{const t=zn(e),[n]=dt(),[s]=ht(),a=mt();(0,c.useEffect)(()=>{n===e&&"outdated"===a&&t({plugin:"nelio-ab-testing",type:"process-results",mode:s})},[n,e,a,s,t])},Un=e=>{const[t]=dt(),n=zn(e),[s]=gt(),[a]=ht(),[i]=_t(),[r]=xt(),l=mt();(0,c.useEffect)(()=>{t===e&&("ready"!==l&&"outdated"!==l||n({plugin:"nelio-ab-testing",type:"render-results",mode:a}))},[t,e,r,s,a,i,l,n])},qn=e=>{const t=zn(e),[n]=ht(),[s]=jt(),[a]=dt();(0,c.useEffect)(()=>{a===e&&t({plugin:"nelio-ab-testing",type:"update-opacity",mode:n,value:s})},[a,e,n,s,t])},Hn=e=>{const t=zn(e),[n]=ft(),[s]=dt(),[a]=ht();(0,c.useEffect)(()=>{"heatmap"===a&&s===e&&t({plugin:"nelio-ab-testing",type:"update-intensity",mode:a,value:n})},[s,e,n,a,t])},$n=e=>{const t=zn(e),[n]=yt(),[s]=dt(),[a]=ht();(0,c.useEffect)(()=>{"heatmap"!==a&&"confetti"!==a||s===e&&t({plugin:"nelio-ab-testing",type:"make-interactive",mode:a,value:n})},[s,e,n,a,t])},zn=e=>(0,c.useCallback)(t=>{var n;const s=`nab-heatmap-results__iframe-${e}`,a=document.getElementById(s);(null===(n=null==a?void 0:a.contentWindow)||void 0===n?void 0:n.postMessage)&&a.contentWindow.postMessage(t)},[e]);function Yn(e){switch(e){case"no-script":return(0,g._x)("Unable to render heatmap","text","nelio-ab-testing");case"experiment-not-found":return(0,g._x)("Experiment not found","text","nelio-ab-testing");case"alternative-not-found":return(0,g._x)("Page not found","text","nelio-ab-testing");case"unreachable-servers":return(0,g._x)("There was an error while retrieving data from the cloud","text","nelio-ab-testing");case"stuck-empty-results":case"heatmap-data-not-available":return(0,g._x)("Heatmap data is currently unavailable","text","nelio-ab-testing");case"no-heatmap-data":return(0,g._x)("No heatmap data","text","nelio-ab-testing");case"unknown":return(0,g._x)("Something went wrong","text","nelio-ab-testing")}}function Gn(e){switch(e){case"no-script":case"experiment-not-found":case"alternative-not-found":case"unreachable-servers":case"unknown":return"crash";case"stuck-empty-results":case"heatmap-data-not-available":case"no-heatmap-data":return"info"}}const Qn=()=>{const[e]=vt(),t=Kn();return(0,r.jsxs)("div",{className:"nab-heatmap-results",children:[(0,r.jsx)(Mn,{className:Et({"nab-heatmap-results__sidebar":!0,"nab-heatmap-results__sidebar--is-collapsed":!e})}),t.map(({alternative:t,url:n})=>(0,r.jsx)(Wn,{className:Et({"nab-heatmap-results__content":!0,"nab-heatmap-results__content--is-fullscreen":!e}),alternative:t,contentUrl:n},`nab-heatmap-results__content--alternative-${t}`))]})},Kn=()=>{const e=ut(),t=y(e=>e(ct).getIFrames(),[]);return e?Xn(e)?[{alternative:0,url:e.links.heatmap}]:e.alternatives.map((e,t)=>({alternative:t,url:e.links.heatmap})).filter((e,n)=>t.includes(n)):[]},Xn=e=>"nab/heatmap"===e.type;function Jn(e,t){const n=document.getElementById(e);if((0,p.isExperimentTooOldToHaveHeatmaps)(t.endDate||""))return u((0,r.jsx)(c.StrictMode,{children:(0,r.jsx)(_,{})}),n);const{experimentId:s,experimentType:a,alternativeIndex:i,isPublicView:l,isReadOnlyActive:g,staging:x,firstDayOfWeek:h}=t;(0,p.createStagingNotice)(x),(0,b.registerCoreExperiments)(),(0,m.registerCoreSegmentationRules)(),o(()=>(0,d.registerCommands)()),u((0,r.jsx)(c.StrictMode,{children:(0,r.jsx)(Ot,{experimentId:s,experimentType:a,alternativeIndex:i,firstDayOfWeek:h,isPublicView:l,isReadOnlyActive:g,children:(0,r.jsx)(Qn,{})})}),n)}}},n={};function s(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,s),i.exports}e=[],s.O=(t,n,a,i)=>{if(!n){var r=1/0;for(u=0;u<e.length;u++){for(var[n,a,i]=e[u],l=!0,o=0;o<n.length;o++)(!1&i||r>=i)&&Object.keys(s.O).every(e=>s.O[e](n[o]))?n.splice(o--,1):(l=!1,i<r&&(r=i));if(l){e.splice(u--,1);var c=a();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[n,a,i]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a=s.O(void 0,[1877],()=>s(9189));a=s.O(a);var i=nab="undefined"==typeof nab?{}:nab;for(var r in a)i[r]=a[r];a.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();